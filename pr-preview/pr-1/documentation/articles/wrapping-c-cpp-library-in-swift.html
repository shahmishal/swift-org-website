<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="utf-8" />
  <title>Swift.org - Wrapping C/C++ Library in Swift</title>
  
  <meta name="robots" content="noindex" />
  
  <meta name="author" content="Apple Inc." />
  <meta name="viewport" content="width=device-width initial-scale=1" />
  
  <link rel="license" href="/swift-org-website/pr-preview/pr-1/LICENSE.txt" />
  <link rel="stylesheet" media="all" href="/swift-org-website/pr-preview/pr-1/assets/stylesheets/application.css" />
  <link rel="shortcut icon" sizes="16x16 24x24 32x32 48x48 64x64" type="image/vnd.microsoft.icon" href="/swift-org-website/pr-preview/pr-1/favicon.ico" />
  <link rel="apple-touch-icon" href="/swift-org-website/pr-preview/pr-1/apple-touch-icon.png" />
  <link rel="apple-touch-icon" sizes="57x57" href="/swift-org-website/pr-preview/pr-1/apple-touch-icon-57x57.png" />
  <link rel="apple-touch-icon" sizes="72x72" href="/swift-org-website/pr-preview/pr-1/apple-touch-icon-72x72.png" />
  <link rel="apple-touch-icon" sizes="76x76" href="/swift-org-website/pr-preview/pr-1/apple-touch-icon-76x76.png" />
  <link rel="apple-touch-icon" sizes="114x114" href="/swift-org-website/pr-preview/pr-1/apple-touch-icon-114x114.png" />
  <link rel="apple-touch-icon" sizes="120x120" href="/swift-org-website/pr-preview/pr-1/apple-touch-icon-120x120.png" />
  <link rel="apple-touch-icon" sizes="144x144" href="/swift-org-website/pr-preview/pr-1/apple-touch-icon-144x144.png" />
  <link rel="apple-touch-icon" sizes="152x152" href="/swift-org-website/pr-preview/pr-1/apple-touch-icon-152x152.png" />
  <link rel="apple-touch-icon" sizes="180x180" href="/swift-org-website/pr-preview/pr-1/apple-touch-icon-180x180.png" />
  <link rel="mask-icon" href="/swift-org-website/pr-preview/pr-1/assets/images/icon-swift.svg" color="#F05339" />
  

  
  <link rel="canonical" href="https://shahmishal.github.io/swift-org-website/pr-preview/pr-1/documentation/articles/wrapping-c-cpp-library-in-swift.html" />
  

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:site" content="@SwiftLang" />
  
  <meta name="twitter:title" content="Swift.org" />
  <meta name="twitter:description" content="Swift is a general-purpose programming language built using a modern approach to safety, performance, and software design patterns." />
  

  <meta property="og:site_name" content="Swift.org" />
  <meta property="og:image" content="https://shahmishal.github.io/apple-touch-icon-180x180.png" />
  
  
  <meta property="og:title" content="Swift.org" />
  <meta property="og:url" content="https://shahmishal.github.io" />
  <meta property="og:description" content="Swift is a general-purpose programming language built using a modern approach to safety, performance, and software design patterns." />
  
</head>

<body>

<p class="stage">
  ⚠️ STAGING WEBSITE ⚠️<br>
    Visit <a href="https://www.swift.org">swift.org</a> for production website.
  </a>
</p>

<script src="/swift-org-website/pr-preview/pr-1/assets/javascripts/color-scheme-toggle.js"></script>
<header class="site-navigation">
  <div class="wrapper">
    <h1 id="logo">
      <a href="/" title="Swift.org">
        <svg xmlns="http://www.w3.org/2000/svg" xml:space="preserve" viewBox="0 0 191.186 59.391"><path fill="#F05138" d="M59.387 16.45a82.463 82.463 0 0 0-.027-1.792c-.035-1.301-.112-2.614-.343-3.9-.234-1.307-.618-2.523-1.222-3.71a12.464 12.464 0 0 0-5.453-5.452C51.156.992 49.941.609 48.635.374c-1.288-.232-2.6-.308-3.902-.343a85.714 85.714 0 0 0-1.792-.027C42.23 0 41.52 0 40.813 0H18.578c-.71 0-1.419 0-2.128.004-.597.004-1.195.01-1.792.027-.325.009-.651.02-.978.036-.978.047-1.959.133-2.924.307-.98.176-1.908.436-2.811.81A12.503 12.503 0 0 0 3.89 3.89a12.46 12.46 0 0 0-2.294 3.158C.992 8.235.61 9.45.374 10.758c-.231 1.286-.308 2.599-.343 3.9a85.767 85.767 0 0 0-.027 1.792C-.001 17.16 0 17.869 0 18.578v22.235c0 .71 0 1.418.004 2.128.004.597.01 1.194.027 1.791.035 1.302.112 2.615.343 3.901.235 1.307.618 2.523 1.222 3.71a12.457 12.457 0 0 0 5.453 5.453c1.186.603 2.401.986 3.707 1.22 1.287.232 2.6.31 3.902.344.597.016 1.195.023 1.793.027.709.005 1.417.004 2.127.004h22.235c.709 0 1.418 0 2.128-.004.597-.004 1.194-.011 1.792-.027 1.302-.035 2.614-.112 3.902-.343 1.306-.235 2.521-.618 3.707-1.222a12.461 12.461 0 0 0 5.453-5.452c.604-1.187.987-2.403 1.222-3.71.231-1.286.308-2.6.343-3.9.016-.598.023-1.194.027-1.792.004-.71.004-1.419.004-2.129V18.578c0-.71 0-1.419-.004-2.128z"/><path fill="#FFF" d="m47.06 36.66-.004-.004c.066-.224.134-.446.191-.675 2.465-9.821-3.55-21.432-13.731-27.546 4.461 6.048 6.434 13.374 4.681 19.78-.156.571-.344 1.12-.552 1.653-.225-.148-.51-.316-.89-.527 0 0-10.127-6.252-21.103-17.312-.288-.29 5.852 8.777 12.822 16.14-3.284-1.843-12.434-8.5-18.227-13.802.712 1.187 1.558 2.33 2.489 3.43C17.573 23.932 23.882 31.5 31.44 37.314c-5.31 3.25-12.814 3.502-20.285.003a30.646 30.646 0 0 1-5.193-3.098c3.162 5.058 8.033 9.423 13.96 11.97 7.07 3.039 14.1 2.833 19.336.05l-.004.007c.024-.016.055-.032.08-.047.214-.116.428-.234.636-.358 2.516-1.306 7.485-2.63 10.152 2.559.654 1.27 2.041-5.46-3.061-11.74z"/><path id="logotype" d="M81.93 38.542c.465 4.12 4.394 6.822 9.852 6.822 5.185 0 8.924-2.701 8.924-6.44 0-3.22-2.265-5.185-7.478-6.495l-5.048-1.282c-7.26-1.801-10.534-5.077-10.534-10.48 0-6.658 5.813-11.27 14.082-11.27 8.022 0 13.726 4.639 13.917 11.325h-5.32c-.41-4.093-3.74-6.604-8.734-6.604-4.94 0-8.378 2.538-8.378 6.249 0 2.892 2.13 4.612 7.369 5.95l4.202 1.09c8.133 1.993 11.462 5.159 11.462 10.863 0 7.259-5.759 11.816-14.928 11.816-8.514 0-14.327-4.53-14.763-11.543h5.376zM140.049 49.43h-5.35l-6.249-21.776h-.109L122.12 49.43h-5.348l-7.914-28.518h5.184l5.513 22.896h.11l6.221-22.896h5.021l6.277 22.896h.11l5.512-22.896h5.13L140.05 49.43zM151.39 13.244c0-1.718 1.419-3.11 3.138-3.11 1.746 0 3.165 1.392 3.165 3.11 0 1.72-1.419 3.139-3.165 3.139a3.157 3.157 0 0 1-3.139-3.139zm.545 7.669h5.213V49.43h-5.213V20.913zM191.186 25.116v-4.204h-5.513v-6.821h-5.185v6.821h-9.964v-2.51c.027-2.538 1.01-3.603 3.357-3.603.764 0 1.528.083 2.156.192v-4.094a18.193 18.193 0 0 0-2.756-.218c-5.568 0-7.915 2.32-7.915 7.642v2.591h-3.983v4.204h3.983V49.43h5.185V25.116H180.488v16.838c0 5.512 2.101 7.64 7.559 7.64 1.174 0 2.51-.082 3.111-.218v-4.257c-.355.055-1.392.137-1.965.137-2.428 0-3.52-1.147-3.52-3.712V25.116h5.513z"/></svg>

      </a>
    </h1>

    <nav role="navigation">
      <ul class="navigation-links">
        
          <li class="nav-item">
            
              <span class="">
                
                  <a href="/getting-started/" data-text="Get Started">Get Started</a>
                
                
              </span>
            
            
          </li>
        
          <li class="nav-item">
            
              <span class="">
                
                  <a href="/blog/" data-text="Blog">Blog</a>
                
                
              </span>
            
            
          </li>
        
          <li class="nav-item">
            
              <span class="">
                
                  <a href="/documentation/" data-text="Documentation">Documentation</a>
                
                
              </span>
            
            
          </li>
        
          <li class="nav-item">
            
              <span class="">
                
                  <a href="/packages/" data-text="Packages">Packages</a>
                
                
              </span>
            
            
          </li>
        
          <li class="nav-item">
            
              <span class="">
                
                  <a href="/tools/" data-text="Tools">Tools</a>
                
                
              </span>
            
            
          </li>
        
          <li class="nav-item">
            
              <span class="">
                
                  <a href="/community/" data-text="Community">Community</a>
                
                
                  <i>&#9663;</i>
                
              </span>
            
            
              <ul class="nav-submenu" role="menu">
                
                  
                    
                    <li role="presentation">
                    
                      <a href="/community/" role="menuitem">Overview</a>
                    </li>
                  
                
                  
                    
                    <li role="presentation">
                    
                      <a href="/swift-evolution/" role="menuitem">Swift Evolution</a>
                    </li>
                  
                
                  
                    
                    <li role="presentation">
                    
                      <a href="/diversity/" role="menuitem">Diversity</a>
                    </li>
                  
                
                  
                    
                    <li role="presentation">
                    
                      <a href="/mentorship/" role="menuitem">Mentorship</a>
                    </li>
                  
                
                  
                    
                    <li role="presentation">
                    
                      <a href="/contributing/" role="menuitem">Contributing</a>
                    </li>
                  
                
                  
                  <li class="nav-section">Steering Groups</li>
                  
                
                  
                    
                    <li role="presentation">
                    
                      <a href="/language-steering-group/" role="menuitem">Language</a>
                    </li>
                  
                
                  
                    
                    <li role="presentation">
                    
                      <a href="/platform-steering-group/" role="menuitem">Platform</a>
                    </li>
                  
                
                  
                  <li class="nav-section">Workgroups</li>
                  
                
                  
                    
                    <li role="presentation">
                    
                      <a href="/contributor-experience-workgroup/" role="menuitem">Contributor Experience</a>
                    </li>
                  
                
                  
                    
                    <li role="presentation">
                    
                      <a href="/sswg/" role="menuitem">Server</a>
                    </li>
                  
                
                  
                    
                    <li role="presentation">
                    
                      <a href="/website/" role="menuitem">Website</a>
                    </li>
                  
                
                  
                    
                    <li role="presentation">
                    
                      <a href="/cxx-interop-workgroup/" role="menuitem">C++ Interoperability</a>
                    </li>
                  
                
                  
                    
                    <li role="presentation">
                    
                      <a href="/documentation-workgroup/" role="menuitem">Documentation</a>
                    </li>
                  
                
                  
                    
                    <li role="presentation">
                    
                      <a href="/foundation-workgroup/" role="menuitem">Foundation</a>
                    </li>
                  
                
                  
                  <li class="nav-section">Governance</li>
                  
                
                  
                    
                    <li role="presentation">
                    
                      <a href="/code-of-conduct/" role="menuitem">Code of Conduct</a>
                    </li>
                  
                
                  
                    
                    <li role="presentation">
                    
                      <a href="/legal/license.html" role="menuitem">License</a>
                    </li>
                  
                
                  
                    
                    <li role="presentation">
                    
                      <a href="/support/security.html" role="menuitem">Security</a>
                    </li>
                  
                
              </ul>
            
          </li>
        
          <li class="nav-item nav-cta">
            
              <a href="/install/" data-text="Install">Install</a>
            
            
          </li>
        
      </ul>
      <button id="menu-toggle" class="menu-item menu-toggle open" aria-expanded="false" aria-label="Toggle Navigation Menu"></button>
    </nav>
  </div>

  <nav class="mobile-navigation" role="navigation">
    <ul class="mobile-navigation-links">
      
        <li class="nav-item">
          <div class="link-container">
            
              <a href="/getting-started/">Get Started</a>
              

            
          </div>
          
        </li>
      
        <li class="nav-item">
          <div class="link-container">
            
              <a href="/blog/">Blog</a>
              

            
          </div>
          
        </li>
      
        <li class="nav-item">
          <div class="link-container">
            
              <a href="/documentation/">Documentation</a>
              

            
          </div>
          
        </li>
      
        <li class="nav-item">
          <div class="link-container">
            
              <a href="/packages/">Packages</a>
              

            
          </div>
          
        </li>
      
        <li class="nav-item">
          <div class="link-container">
            
              <a href="/tools/">Tools</a>
              

            
          </div>
          
        </li>
      
        <li class="nav-item">
          <div class="link-container">
            
              <a href="/community/">Community</a>
              

            
              <button class="section-toggle" aria-expanded="false" aria-label="Toggle Community Section">
                &#9663;
              </button>
            
          </div>
          
            <ul class="section-menu">
              
                
                  
                    <li>
                  
                    <a href="/community/">Overview</a>
                  </li>
                
              
                
                  
                    <li>
                  
                    <a href="/swift-evolution/">Swift Evolution</a>
                  </li>
                
              
                
                  
                    <li>
                  
                    <a href="/diversity/">Diversity</a>
                  </li>
                
              
                
                  
                    <li>
                  
                    <a href="/mentorship/">Mentorship</a>
                  </li>
                
              
                
                  
                    <li>
                  
                    <a href="/contributing/">Contributing</a>
                  </li>
                
              
                
                  <li class="nav-section">Steering Groups</li>
                
              
                
                  
                    <li>
                  
                    <a href="/language-steering-group/">Language</a>
                  </li>
                
              
                
                  
                    <li>
                  
                    <a href="/platform-steering-group/">Platform</a>
                  </li>
                
              
                
                  <li class="nav-section">Workgroups</li>
                
              
                
                  
                    <li>
                  
                    <a href="/contributor-experience-workgroup/">Contributor Experience</a>
                  </li>
                
              
                
                  
                    <li>
                  
                    <a href="/sswg/">Server</a>
                  </li>
                
              
                
                  
                    <li>
                  
                    <a href="/website/">Website</a>
                  </li>
                
              
                
                  
                    <li>
                  
                    <a href="/cxx-interop-workgroup/">C++ Interoperability</a>
                  </li>
                
              
                
                  
                    <li>
                  
                    <a href="/documentation-workgroup/">Documentation</a>
                  </li>
                
              
                
                  
                    <li>
                  
                    <a href="/foundation-workgroup/">Foundation</a>
                  </li>
                
              
                
                  <li class="nav-section">Governance</li>
                
              
                
                  
                    <li>
                  
                    <a href="/code-of-conduct/">Code of Conduct</a>
                  </li>
                
              
                
                  
                    <li>
                  
                    <a href="/legal/license.html">License</a>
                  </li>
                
              
                
                  
                    <li>
                  
                    <a href="/support/security.html">Security</a>
                  </li>
                
              
            </ul>
          
        </li>
      
        <li class="nav-item">
          <div class="link-container">
            
              <a href="/install/">Install</a>
              

            
          </div>
          
        </li>
      
    </ul>
  </nav>
 </header>

<main role="main">
  <article class="page">
  
    
      <header>
        <h1>Wrapping C/C++ Library in Swift</h1>
      </header>
    
  

  <p>There are many great libraries out there that are written in C/C++. It is possible to
make use of these libraries in your Swift code without having to rewrite any of them
in Swift. This article will explain a couple of ways to acheive this and best practices
when working with C/C++ in Swift.</p>

<h2 id="package" class="header-with-anchor">Package <a title="Permalink for Package section" href="#package">
            <?xml version="1.0" encoding="utf-8"?> <svg width="24px" height="24px" viewBox="0 0 14 14" role="img" focusable="false" aria-hidden="true" xmlns="http://www.w3.org/2000/svg"><path d="m 11.58824,9.823529 q 0,-0.294117 -0.20589,-0.499999 L 9.85294,7.794118 q -0.20588,-0.205883 -0.5,-0.205883 -0.30882,0 -0.52941,0.235295 0.0221,0.02206 0.13971,0.136029 0.11764,0.113971 0.15808,0.158088 0.0404,0.04412 0.1103,0.139706 0.0698,0.09559 0.0956,0.1875 0.0257,0.09191 0.0257,0.202206 0,0.294117 -0.20588,0.5 -0.20588,0.205882 -0.5,0.205882 -0.1103,0 -0.20221,-0.02573 Q 8.35293,9.301471 8.25733,9.231621 8.16173,9.161771 8.11763,9.121327 8.07353,9.080887 7.95954,8.963238 7.84557,8.845591 7.82351,8.823533 7.58086,9.051474 7.58086,9.360297 q 0,0.294118 0.20588,0.5 l 1.51471,1.522059 q 0.19853,0.19853 0.5,0.19853 0.29412,0 0.5,-0.191177 l 1.08088,-1.073529 q 0.20589,-0.205883 0.20589,-0.492648 z M 6.41912,4.639706 q 0,-0.294118 -0.20588,-0.5 L 4.69853,2.617647 q -0.20588,-0.205882 -0.5,-0.205882 -0.28677,0 -0.5,0.198529 L 2.61765,3.683823 q -0.20589,0.205883 -0.20589,0.492648 0,0.294117 0.20589,0.499999 l 1.52941,1.529412 q 0.19853,0.19853 0.5,0.19853 0.30882,0 0.52941,-0.227942 Q 5.15437,6.15441 5.03676,6.040441 4.91912,5.92647 4.87868,5.882353 4.83828,5.838233 4.76838,5.742647 q -0.0698,-0.09559 -0.0956,-0.1875 -0.0257,-0.09191 -0.0257,-0.202206 0,-0.294117 0.20588,-0.5 0.20588,-0.205882 0.5,-0.205882 0.1103,0 0.20221,0.02573 0.0919,0.02573 0.1875,0.09559 0.0956,0.06985 0.1397,0.110294 0.0441,0.04044 0.15809,0.158089 Q 6.15443,5.154409 6.17649,5.176467 6.41914,4.948526 6.41914,4.639703 z M 13,9.823529 q 0,0.882353 -0.625,1.492647 l -1.08088,1.07353 Q 10.68382,13 9.80147,13 q -0.88971,0 -1.5,-0.625 L 6.78676,10.852941 Q 6.17647,10.242647 6.17647,9.360294 q 0,-0.904412 0.64706,-1.536764 L 6.17647,7.176471 Q 5.54412,7.82353 4.64706,7.82353 q -0.88235,0 -1.5,-0.617648 L 1.617647,5.676471 Q 1,5.058824 1,4.176471 1,3.294118 1.625,2.683824 L 2.70588,1.610294 Q 3.31618,1 4.19853,1 q 0.88971,0 1.5,0.625 l 1.51471,1.522059 q 0.61029,0.610294 0.61029,1.492647 0,0.904412 -0.64706,1.536764 L 7.82353,6.823529 Q 8.45588,6.17647 9.35294,6.17647 q 0.88235,0 1.5,0.617648 l 1.52941,1.529411 Q 13,8.941176 13,9.823529 z"/></svg>
          </a></h2>

<ol>
  <li>If needed, create a new Swift package with <code class="language-plaintext highlighter-rouge">Package.swift</code>, <code class="language-plaintext highlighter-rouge">Sources</code> directory, etc.</li>
  <li>Create a new module/directory under <code class="language-plaintext highlighter-rouge">Sources</code> for the C/C++ library. Let’s suppose it’s named <code class="language-plaintext highlighter-rouge">CMyLib</code> in the rest of this section.
    <ul>
      <li>One convention is to prefix the module name with <code class="language-plaintext highlighter-rouge">C</code>. For example, <code class="language-plaintext highlighter-rouge">CDataStaxDriver</code>.</li>
    </ul>
  </li>
  <li>Add the C/C++ library’s source code directory as Git submodule under <code class="language-plaintext highlighter-rouge">Sources/CMyLib</code>.
    <ul>
      <li>If set up properly, there should be a <code class="language-plaintext highlighter-rouge">.gitmodules</code> file in the Swift package’s root directory with contents like this:</li>
    </ul>

    <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code> [submodule "my-lib"]
     	path = Sources/CMyLib/my-lib
     	url = https://github.com/examples/my-lib.git
</code></pre></div>    </div>
  </li>
  <li>
    <p>Modify <code class="language-plaintext highlighter-rouge">Package.swift</code> to add <code class="language-plaintext highlighter-rouge">CMyLib</code> as a target, and specify locations for source and header files.</p>

    <div class="language-swift highlighter-rouge"><div class="highlight"><pre class="highlight"><code> <span class="o">.</span><span class="nf">target</span><span class="p">(</span>
   <span class="nv">name</span><span class="p">:</span> <span class="s">"CMyLib"</span><span class="p">,</span>
   <span class="nv">dependencies</span><span class="p">:</span> <span class="p">[],</span>
   <span class="nv">exclude</span><span class="p">:</span> <span class="p">[</span>
       <span class="c1">// Relative paths under 'CMyLib' of the files</span>
       <span class="c1">// and/or directories to exclude. For example:</span>
       <span class="c1">// "./my-lib/src/CMakeLists.txt",</span>
       <span class="c1">// "./my-lib/tests",</span>
   <span class="p">],</span>
   <span class="nv">sources</span><span class="p">:</span> <span class="p">[</span>
       <span class="c1">// Relative paths under 'CMyLib' of the source</span>
       <span class="c1">// files and/or directories. For example:</span>
       <span class="c1">// "./my-lib/src/foo.c",</span>
       <span class="c1">// "./my-lib/src/baz",</span>
   <span class="p">],</span>
   <span class="nv">cSettings</span><span class="p">:</span> <span class="p">[</span>
       <span class="c1">// .headerSearchPath("./my-lib/src"),</span>
   <span class="p">]</span>
 <span class="p">),</span>
</code></pre></div>    </div>

    <p>For C++ library, use <code class="language-plaintext highlighter-rouge">cxxSettings</code> instead of <code class="language-plaintext highlighter-rouge">cSettings</code>. Additional options and parameters are available for a target definition. See SwiftPM API documentation for details.</p>
  </li>
  <li>Try compiling the Swift package with <code class="language-plaintext highlighter-rouge">swift build</code>. Adjust <code class="language-plaintext highlighter-rouge">Package.swift</code> as needed.</li>
</ol>

<h3 id="module-map" class="header-with-anchor">Module map <a title="Permalink for Module map section" href="#module-map">
            <?xml version="1.0" encoding="utf-8"?> <svg width="24px" height="24px" viewBox="0 0 14 14" role="img" focusable="false" aria-hidden="true" xmlns="http://www.w3.org/2000/svg"><path d="m 11.58824,9.823529 q 0,-0.294117 -0.20589,-0.499999 L 9.85294,7.794118 q -0.20588,-0.205883 -0.5,-0.205883 -0.30882,0 -0.52941,0.235295 0.0221,0.02206 0.13971,0.136029 0.11764,0.113971 0.15808,0.158088 0.0404,0.04412 0.1103,0.139706 0.0698,0.09559 0.0956,0.1875 0.0257,0.09191 0.0257,0.202206 0,0.294117 -0.20588,0.5 -0.20588,0.205882 -0.5,0.205882 -0.1103,0 -0.20221,-0.02573 Q 8.35293,9.301471 8.25733,9.231621 8.16173,9.161771 8.11763,9.121327 8.07353,9.080887 7.95954,8.963238 7.84557,8.845591 7.82351,8.823533 7.58086,9.051474 7.58086,9.360297 q 0,0.294118 0.20588,0.5 l 1.51471,1.522059 q 0.19853,0.19853 0.5,0.19853 0.29412,0 0.5,-0.191177 l 1.08088,-1.073529 q 0.20589,-0.205883 0.20589,-0.492648 z M 6.41912,4.639706 q 0,-0.294118 -0.20588,-0.5 L 4.69853,2.617647 q -0.20588,-0.205882 -0.5,-0.205882 -0.28677,0 -0.5,0.198529 L 2.61765,3.683823 q -0.20589,0.205883 -0.20589,0.492648 0,0.294117 0.20589,0.499999 l 1.52941,1.529412 q 0.19853,0.19853 0.5,0.19853 0.30882,0 0.52941,-0.227942 Q 5.15437,6.15441 5.03676,6.040441 4.91912,5.92647 4.87868,5.882353 4.83828,5.838233 4.76838,5.742647 q -0.0698,-0.09559 -0.0956,-0.1875 -0.0257,-0.09191 -0.0257,-0.202206 0,-0.294117 0.20588,-0.5 0.20588,-0.205882 0.5,-0.205882 0.1103,0 0.20221,0.02573 0.0919,0.02573 0.1875,0.09559 0.0956,0.06985 0.1397,0.110294 0.0441,0.04044 0.15809,0.158089 Q 6.15443,5.154409 6.17649,5.176467 6.41914,4.948526 6.41914,4.639703 z M 13,9.823529 q 0,0.882353 -0.625,1.492647 l -1.08088,1.07353 Q 10.68382,13 9.80147,13 q -0.88971,0 -1.5,-0.625 L 6.78676,10.852941 Q 6.17647,10.242647 6.17647,9.360294 q 0,-0.904412 0.64706,-1.536764 L 6.17647,7.176471 Q 5.54412,7.82353 4.64706,7.82353 q -0.88235,0 -1.5,-0.617648 L 1.617647,5.676471 Q 1,5.058824 1,4.176471 1,3.294118 1.625,2.683824 L 2.70588,1.610294 Q 3.31618,1 4.19853,1 q 0.88971,0 1.5,0.625 l 1.51471,1.522059 q 0.61029,0.610294 0.61029,1.492647 0,0.904412 -0.64706,1.536764 L 7.82353,6.823529 Q 8.45588,6.17647 9.35294,6.17647 q 0.88235,0 1.5,0.617648 l 1.52941,1.529411 Q 13,8.941176 13,9.823529 z"/></svg>
          </a></h3>

<p>A module map is generated automatically for Clang targets (e.g., <code class="language-plaintext highlighter-rouge">CMyLib</code>) unless a custom one is present. (i.e., <code class="language-plaintext highlighter-rouge">module.modulemap</code> file exists in the header directory)</p>

<p>The rules for module map generation can be found <a href="https://github.com/swiftlang/swift-package-manager/blob/main/Sources/PackageLoading/ModuleMapGenerator.swift">here</a>.</p>

<h3 id="include-files-generated-by-cc-library-build" class="header-with-anchor">Include files generated by C/C++ library build <a title="Permalink for Include files generated by C/C++ library build section" href="#include-files-generated-by-cc-library-build">
            <?xml version="1.0" encoding="utf-8"?> <svg width="24px" height="24px" viewBox="0 0 14 14" role="img" focusable="false" aria-hidden="true" xmlns="http://www.w3.org/2000/svg"><path d="m 11.58824,9.823529 q 0,-0.294117 -0.20589,-0.499999 L 9.85294,7.794118 q -0.20588,-0.205883 -0.5,-0.205883 -0.30882,0 -0.52941,0.235295 0.0221,0.02206 0.13971,0.136029 0.11764,0.113971 0.15808,0.158088 0.0404,0.04412 0.1103,0.139706 0.0698,0.09559 0.0956,0.1875 0.0257,0.09191 0.0257,0.202206 0,0.294117 -0.20588,0.5 -0.20588,0.205882 -0.5,0.205882 -0.1103,0 -0.20221,-0.02573 Q 8.35293,9.301471 8.25733,9.231621 8.16173,9.161771 8.11763,9.121327 8.07353,9.080887 7.95954,8.963238 7.84557,8.845591 7.82351,8.823533 7.58086,9.051474 7.58086,9.360297 q 0,0.294118 0.20588,0.5 l 1.51471,1.522059 q 0.19853,0.19853 0.5,0.19853 0.29412,0 0.5,-0.191177 l 1.08088,-1.073529 q 0.20589,-0.205883 0.20589,-0.492648 z M 6.41912,4.639706 q 0,-0.294118 -0.20588,-0.5 L 4.69853,2.617647 q -0.20588,-0.205882 -0.5,-0.205882 -0.28677,0 -0.5,0.198529 L 2.61765,3.683823 q -0.20589,0.205883 -0.20589,0.492648 0,0.294117 0.20589,0.499999 l 1.52941,1.529412 q 0.19853,0.19853 0.5,0.19853 0.30882,0 0.52941,-0.227942 Q 5.15437,6.15441 5.03676,6.040441 4.91912,5.92647 4.87868,5.882353 4.83828,5.838233 4.76838,5.742647 q -0.0698,-0.09559 -0.0956,-0.1875 -0.0257,-0.09191 -0.0257,-0.202206 0,-0.294117 0.20588,-0.5 0.20588,-0.205882 0.5,-0.205882 0.1103,0 0.20221,0.02573 0.0919,0.02573 0.1875,0.09559 0.0956,0.06985 0.1397,0.110294 0.0441,0.04044 0.15809,0.158089 Q 6.15443,5.154409 6.17649,5.176467 6.41914,4.948526 6.41914,4.639703 z M 13,9.823529 q 0,0.882353 -0.625,1.492647 l -1.08088,1.07353 Q 10.68382,13 9.80147,13 q -0.88971,0 -1.5,-0.625 L 6.78676,10.852941 Q 6.17647,10.242647 6.17647,9.360294 q 0,-0.904412 0.64706,-1.536764 L 6.17647,7.176471 Q 5.54412,7.82353 4.64706,7.82353 q -0.88235,0 -1.5,-0.617648 L 1.617647,5.676471 Q 1,5.058824 1,4.176471 1,3.294118 1.625,2.683824 L 2.70588,1.610294 Q 3.31618,1 4.19853,1 q 0.88971,0 1.5,0.625 l 1.51471,1.522059 q 0.61029,0.610294 0.61029,1.492647 0,0.904412 -0.64706,1.536764 L 7.82353,6.823529 Q 8.45588,6.17647 9.35294,6.17647 q 0.88235,0 1.5,0.617648 l 1.52941,1.529411 Q 13,8.941176 13,9.823529 z"/></svg>
          </a></h3>

<p>Some C/C++ libraries generate additional, required file(s) in their build (e.g., configuration file). To include these files in the Swift package:</p>

<ol>
  <li><code class="language-plaintext highlighter-rouge">cd</code> into the C/C++ library’s root directory (e.g., <code class="language-plaintext highlighter-rouge">Sources/CMyLib/my-lib</code>) then build it.
    <ul>
      <li>Recall from step 3 above that this is the directory for the Git submodule. <u>No modifications are supposed to be made in this directory.</u> Output files/directories generated by the C/C++ library build should be added to <code class="language-plaintext highlighter-rouge">.gitignore</code>.</li>
    </ul>
  </li>
  <li>Create a directory under <code class="language-plaintext highlighter-rouge">Sources/CMyLib/</code> to house the required file(s). (e.g., <code class="language-plaintext highlighter-rouge">Sources/CMyLib/extra</code>)</li>
  <li>Copy the generated, required file(s) from C/C++ build outputs to the directory created in the previous step.</li>
  <li>Update <code class="language-plaintext highlighter-rouge">Package.swift</code> by adding path of the directory created in step 2 (i.e., <code class="language-plaintext highlighter-rouge">extra</code>) or individual file path(s) (e.g., <code class="language-plaintext highlighter-rouge">./extra/config.h</code>) to either the target’s (i.e., <code class="language-plaintext highlighter-rouge">CMyLib</code>) <code class="language-plaintext highlighter-rouge">sources</code> array for source file(s), or as <code class="language-plaintext highlighter-rouge">.headerSearchPath</code> for header(s).</li>
</ol>

<h3 id="overwrite-files-in-cc-library" class="header-with-anchor">Overwrite files in C/C++ library <a title="Permalink for Overwrite files in C/C++ library section" href="#overwrite-files-in-cc-library">
            <?xml version="1.0" encoding="utf-8"?> <svg width="24px" height="24px" viewBox="0 0 14 14" role="img" focusable="false" aria-hidden="true" xmlns="http://www.w3.org/2000/svg"><path d="m 11.58824,9.823529 q 0,-0.294117 -0.20589,-0.499999 L 9.85294,7.794118 q -0.20588,-0.205883 -0.5,-0.205883 -0.30882,0 -0.52941,0.235295 0.0221,0.02206 0.13971,0.136029 0.11764,0.113971 0.15808,0.158088 0.0404,0.04412 0.1103,0.139706 0.0698,0.09559 0.0956,0.1875 0.0257,0.09191 0.0257,0.202206 0,0.294117 -0.20588,0.5 -0.20588,0.205882 -0.5,0.205882 -0.1103,0 -0.20221,-0.02573 Q 8.35293,9.301471 8.25733,9.231621 8.16173,9.161771 8.11763,9.121327 8.07353,9.080887 7.95954,8.963238 7.84557,8.845591 7.82351,8.823533 7.58086,9.051474 7.58086,9.360297 q 0,0.294118 0.20588,0.5 l 1.51471,1.522059 q 0.19853,0.19853 0.5,0.19853 0.29412,0 0.5,-0.191177 l 1.08088,-1.073529 q 0.20589,-0.205883 0.20589,-0.492648 z M 6.41912,4.639706 q 0,-0.294118 -0.20588,-0.5 L 4.69853,2.617647 q -0.20588,-0.205882 -0.5,-0.205882 -0.28677,0 -0.5,0.198529 L 2.61765,3.683823 q -0.20589,0.205883 -0.20589,0.492648 0,0.294117 0.20589,0.499999 l 1.52941,1.529412 q 0.19853,0.19853 0.5,0.19853 0.30882,0 0.52941,-0.227942 Q 5.15437,6.15441 5.03676,6.040441 4.91912,5.92647 4.87868,5.882353 4.83828,5.838233 4.76838,5.742647 q -0.0698,-0.09559 -0.0956,-0.1875 -0.0257,-0.09191 -0.0257,-0.202206 0,-0.294117 0.20588,-0.5 0.20588,-0.205882 0.5,-0.205882 0.1103,0 0.20221,0.02573 0.0919,0.02573 0.1875,0.09559 0.0956,0.06985 0.1397,0.110294 0.0441,0.04044 0.15809,0.158089 Q 6.15443,5.154409 6.17649,5.176467 6.41914,4.948526 6.41914,4.639703 z M 13,9.823529 q 0,0.882353 -0.625,1.492647 l -1.08088,1.07353 Q 10.68382,13 9.80147,13 q -0.88971,0 -1.5,-0.625 L 6.78676,10.852941 Q 6.17647,10.242647 6.17647,9.360294 q 0,-0.904412 0.64706,-1.536764 L 6.17647,7.176471 Q 5.54412,7.82353 4.64706,7.82353 q -0.88235,0 -1.5,-0.617648 L 1.617647,5.676471 Q 1,5.058824 1,4.176471 1,3.294118 1.625,2.683824 L 2.70588,1.610294 Q 3.31618,1 4.19853,1 q 0.88971,0 1.5,0.625 l 1.51471,1.522059 q 0.61029,0.610294 0.61029,1.492647 0,0.904412 -0.64706,1.536764 L 7.82353,6.823529 Q 8.45588,6.17647 9.35294,6.17647 q 0.88235,0 1.5,0.617648 l 1.52941,1.529411 Q 13,8.941176 13,9.823529 z"/></svg>
          </a></h3>

<p>To use custom implementation instead of what comes with the C/C++ library:</p>

<ol>
  <li>Create a directory under <code class="language-plaintext highlighter-rouge">Sources/CMyLib</code> to house the custom code file(s). (e.g., <code class="language-plaintext highlighter-rouge">Sources/CMyLib/custom</code>)</li>
  <li>Add the custom code files to the directory created in the previous step.
    <ul>
      <li>If needed, create separate sub-directories for source and header files.</li>
    </ul>
  </li>
  <li>Update <code class="language-plaintext highlighter-rouge">Package.swift</code>:
    <ul>
      <li>Add path of the directory created in step 1 (i.e., <code class="language-plaintext highlighter-rouge">custom</code>) or individual file path(s) (e.g., <code class="language-plaintext highlighter-rouge">./custom/my_impl.c</code>) to either the target’s (i.e., <code class="language-plaintext highlighter-rouge">CMyLib</code>) <code class="language-plaintext highlighter-rouge">sources</code> array for source file(s), or as <code class="language-plaintext highlighter-rouge">.headerSearchPath</code> for header(s).</li>
      <li>Add file path(s) of the C/C++ library to the target’s (i.e., <code class="language-plaintext highlighter-rouge">CMyLib</code>) exclude array. (e.g., <code class="language-plaintext highlighter-rouge">./my-lib/impl.c</code>)</li>
    </ul>
  </li>
</ol>

<h2 id="cmake" class="header-with-anchor">CMake <a title="Permalink for CMake section" href="#cmake">
            <?xml version="1.0" encoding="utf-8"?> <svg width="24px" height="24px" viewBox="0 0 14 14" role="img" focusable="false" aria-hidden="true" xmlns="http://www.w3.org/2000/svg"><path d="m 11.58824,9.823529 q 0,-0.294117 -0.20589,-0.499999 L 9.85294,7.794118 q -0.20588,-0.205883 -0.5,-0.205883 -0.30882,0 -0.52941,0.235295 0.0221,0.02206 0.13971,0.136029 0.11764,0.113971 0.15808,0.158088 0.0404,0.04412 0.1103,0.139706 0.0698,0.09559 0.0956,0.1875 0.0257,0.09191 0.0257,0.202206 0,0.294117 -0.20588,0.5 -0.20588,0.205882 -0.5,0.205882 -0.1103,0 -0.20221,-0.02573 Q 8.35293,9.301471 8.25733,9.231621 8.16173,9.161771 8.11763,9.121327 8.07353,9.080887 7.95954,8.963238 7.84557,8.845591 7.82351,8.823533 7.58086,9.051474 7.58086,9.360297 q 0,0.294118 0.20588,0.5 l 1.51471,1.522059 q 0.19853,0.19853 0.5,0.19853 0.29412,0 0.5,-0.191177 l 1.08088,-1.073529 q 0.20589,-0.205883 0.20589,-0.492648 z M 6.41912,4.639706 q 0,-0.294118 -0.20588,-0.5 L 4.69853,2.617647 q -0.20588,-0.205882 -0.5,-0.205882 -0.28677,0 -0.5,0.198529 L 2.61765,3.683823 q -0.20589,0.205883 -0.20589,0.492648 0,0.294117 0.20589,0.499999 l 1.52941,1.529412 q 0.19853,0.19853 0.5,0.19853 0.30882,0 0.52941,-0.227942 Q 5.15437,6.15441 5.03676,6.040441 4.91912,5.92647 4.87868,5.882353 4.83828,5.838233 4.76838,5.742647 q -0.0698,-0.09559 -0.0956,-0.1875 -0.0257,-0.09191 -0.0257,-0.202206 0,-0.294117 0.20588,-0.5 0.20588,-0.205882 0.5,-0.205882 0.1103,0 0.20221,0.02573 0.0919,0.02573 0.1875,0.09559 0.0956,0.06985 0.1397,0.110294 0.0441,0.04044 0.15809,0.158089 Q 6.15443,5.154409 6.17649,5.176467 6.41914,4.948526 6.41914,4.639703 z M 13,9.823529 q 0,0.882353 -0.625,1.492647 l -1.08088,1.07353 Q 10.68382,13 9.80147,13 q -0.88971,0 -1.5,-0.625 L 6.78676,10.852941 Q 6.17647,10.242647 6.17647,9.360294 q 0,-0.904412 0.64706,-1.536764 L 6.17647,7.176471 Q 5.54412,7.82353 4.64706,7.82353 q -0.88235,0 -1.5,-0.617648 L 1.617647,5.676471 Q 1,5.058824 1,4.176471 1,3.294118 1.625,2.683824 L 2.70588,1.610294 Q 3.31618,1 4.19853,1 q 0.88971,0 1.5,0.625 l 1.51471,1.522059 q 0.61029,0.610294 0.61029,1.492647 0,0.904412 -0.64706,1.536764 L 7.82353,6.823529 Q 8.45588,6.17647 9.35294,6.17647 q 0.88235,0 1.5,0.617648 l 1.52941,1.529411 Q 13,8.941176 13,9.823529 z"/></svg>
          </a></h2>

<p>This example is geared toward importing a C library into Swift. You’ll need to obtain the library, provide a modulemap so that Swift can import it, and then link against it. The mechanics are largely the same for C++, and an example of how to bi-directionally interop with a C++ library built as part of a single project is available in the bidirectional cxx interop project in the <a href="https://github.com/apple/swift-cmake-examples/tree/main/3_bidirectional_cxx_interop">Swift-CMake examples repository</a>.</p>

<h3 id="obtaining-the-library" class="header-with-anchor">Obtaining the library <a title="Permalink for Obtaining the library section" href="#obtaining-the-library">
            <?xml version="1.0" encoding="utf-8"?> <svg width="24px" height="24px" viewBox="0 0 14 14" role="img" focusable="false" aria-hidden="true" xmlns="http://www.w3.org/2000/svg"><path d="m 11.58824,9.823529 q 0,-0.294117 -0.20589,-0.499999 L 9.85294,7.794118 q -0.20588,-0.205883 -0.5,-0.205883 -0.30882,0 -0.52941,0.235295 0.0221,0.02206 0.13971,0.136029 0.11764,0.113971 0.15808,0.158088 0.0404,0.04412 0.1103,0.139706 0.0698,0.09559 0.0956,0.1875 0.0257,0.09191 0.0257,0.202206 0,0.294117 -0.20588,0.5 -0.20588,0.205882 -0.5,0.205882 -0.1103,0 -0.20221,-0.02573 Q 8.35293,9.301471 8.25733,9.231621 8.16173,9.161771 8.11763,9.121327 8.07353,9.080887 7.95954,8.963238 7.84557,8.845591 7.82351,8.823533 7.58086,9.051474 7.58086,9.360297 q 0,0.294118 0.20588,0.5 l 1.51471,1.522059 q 0.19853,0.19853 0.5,0.19853 0.29412,0 0.5,-0.191177 l 1.08088,-1.073529 q 0.20589,-0.205883 0.20589,-0.492648 z M 6.41912,4.639706 q 0,-0.294118 -0.20588,-0.5 L 4.69853,2.617647 q -0.20588,-0.205882 -0.5,-0.205882 -0.28677,0 -0.5,0.198529 L 2.61765,3.683823 q -0.20589,0.205883 -0.20589,0.492648 0,0.294117 0.20589,0.499999 l 1.52941,1.529412 q 0.19853,0.19853 0.5,0.19853 0.30882,0 0.52941,-0.227942 Q 5.15437,6.15441 5.03676,6.040441 4.91912,5.92647 4.87868,5.882353 4.83828,5.838233 4.76838,5.742647 q -0.0698,-0.09559 -0.0956,-0.1875 -0.0257,-0.09191 -0.0257,-0.202206 0,-0.294117 0.20588,-0.5 0.20588,-0.205882 0.5,-0.205882 0.1103,0 0.20221,0.02573 0.0919,0.02573 0.1875,0.09559 0.0956,0.06985 0.1397,0.110294 0.0441,0.04044 0.15809,0.158089 Q 6.15443,5.154409 6.17649,5.176467 6.41914,4.948526 6.41914,4.639703 z M 13,9.823529 q 0,0.882353 -0.625,1.492647 l -1.08088,1.07353 Q 10.68382,13 9.80147,13 q -0.88971,0 -1.5,-0.625 L 6.78676,10.852941 Q 6.17647,10.242647 6.17647,9.360294 q 0,-0.904412 0.64706,-1.536764 L 6.17647,7.176471 Q 5.54412,7.82353 4.64706,7.82353 q -0.88235,0 -1.5,-0.617648 L 1.617647,5.676471 Q 1,5.058824 1,4.176471 1,3.294118 1.625,2.683824 L 2.70588,1.610294 Q 3.31618,1 4.19853,1 q 0.88971,0 1.5,0.625 l 1.51471,1.522059 q 0.61029,0.610294 0.61029,1.492647 0,0.904412 -0.64706,1.536764 L 7.82353,6.823529 Q 8.45588,6.17647 9.35294,6.17647 q 0.88235,0 1.5,0.617648 l 1.52941,1.529411 Q 13,8.941176 13,9.823529 z"/></svg>
          </a></h3>

<p>If you’re not building a C library alongside your Swift library, you’ll need to somehow obtain a copy of the library.</p>

<ul>
  <li>ExternalProject
    <ul>
      <li>Runs at build-time and has most limited configurability, but also isolates the build of the C/C++ library from your build.</li>
      <li>This is good when coupling between your project and the dependency is low, and the library is unlikely to be installed where your project is expected to run, or when you need some level of configurability over the dependency build.</li>
      <li>More details are available at <a href="https://cmake.org/cmake/help/latest/module/ExternalProject.html">External Project</a>.</li>
    </ul>
  </li>
</ul>

<div class="language-cmake highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">include</span><span class="p">(</span>ExternalProject<span class="p">)</span>
<span class="nf">ExternalProject_Add</span><span class="p">(</span>ZLIB
    GIT_REPOSITORY <span class="s2">"https://www.github.com/madler/zlib.git"</span>
    GIT_TAG <span class="s2">"09155eaa2f9270dc4ed1fa13e2b4b2613e6e4851"</span> <span class="c1"># v1.3</span>
    GIT_SHALLOW TRUE

    UPDATE_COMMAND <span class="s2">""</span>

    CMAKE_ARGS
      -DCMAKE_INSTALL_PREFIX:PATH=&lt;INSTALL_DIR&gt;
<span class="p">)</span>
<span class="nf">ExternalProject_Get_Property</span><span class="p">(</span>ZLIB INSTALL_DIR<span class="p">)</span>
<span class="nb">add_library</span><span class="p">(</span>zlib STATIC IMPORTED GLOBAL<span class="p">)</span>
<span class="nb">set_target_properties</span><span class="p">(</span>zlib PROPERTIES
  INTERFACE_INCLUDE_DIRECTORIES <span class="s2">"</span><span class="si">${</span><span class="nv">INSTALL_DIR</span><span class="si">}</span><span class="s2">/include"</span>
  IMPORTED_LOCATION <span class="s2">"</span><span class="si">${</span><span class="nv">INSTALL_DIR</span><span class="si">}</span><span class="s2">/lib/libz.a"</span>
<span class="p">)</span>

<span class="nb">add_executable</span><span class="p">(</span>example example.c<span class="p">)</span>
<span class="nb">target_link_libraries</span><span class="p">(</span>example PRIVATE zlib<span class="p">)</span>
</code></pre></div></div>

<p>This example downloads zlib v1.3 from GitHub, and builds it. Since we have set a pinned tag, we don’t need CMake to attempt to update it, the contents of the commit hash will never change. The <code class="language-plaintext highlighter-rouge">ZLIB</code> target created by the External Project is a CMake “utility” library, so we can’t link against it directly. Instead, we could use <code class="language-plaintext highlighter-rouge">find_package</code> after setting the <code class="language-plaintext highlighter-rouge">ZLIB_DIR</code> to the build directory to find it, or since we already know where it exists, we can create an imported static library. Setting the <code class="language-plaintext highlighter-rouge">INTERFACE_INCLUDE_DIRECTORIES</code> to the location where we installed the zlib headers and the <code class="language-plaintext highlighter-rouge">IMPORTED_LOCATION</code> to the static archive results in a target that we can link code against. CMake will then tell the compiler where to look for the headers and to link the static archive for any target that links against the imported <code class="language-plaintext highlighter-rouge">zlib</code> target.</p>

<ul>
  <li><code class="language-plaintext highlighter-rouge">FetchContent</code>
    <ul>
      <li>Runs at configuration time and results in a merged build graph. This is best for pulling in external pieces that are implementation details of your library. Note that because the build graph is merged, variable names and targets need to be namespaced appropriately or they will collide and things may not build as expected.</li>
      <li>This is good when there is tight coupling between your project and the dependency. Since the build graphs are merged, your project can depend on individual build targets in the dependency, instead of on the project as a whole, which can improve build performance.</li>
      <li>More details are available at <a href="https://cmake.org/cmake/help/latest/module/FetchContent.html">FetchContent</a>.</li>
    </ul>
  </li>
  <li><code class="language-plaintext highlighter-rouge">find_package</code>
    <ul>
      <li>Finds the library and header from the sysroot. By default, CMake will look at the root of your OS as the sysroot, but can be isolated to other sysroots for cross-compilation.</li>
      <li>This option is good for picking up system dependencies from the base system or sysroot, or giving the distributor of your project the option of using a prebuilt project with the use of <code class="language-plaintext highlighter-rouge">&lt;PackageName&gt;_ROOT</code>.</li>
      <li>More details are available at <a href="https://cmake.org/cmake/help/latest/command/find_package.html">find_package</a>.</li>
    </ul>
  </li>
</ul>

<p>The example of wrapping an existing C library in Swift using CMake will use <code class="language-plaintext highlighter-rouge">find_package</code>, a custom module-map file, and a Virtual Filesystem (VFS) overlay, as well as a helper layer to migrate parts of the SQLite codebase to something that Swift can import.</p>

<h3 id="getting-started" class="header-with-anchor">Getting started <a title="Permalink for Getting started section" href="#getting-started">
            <?xml version="1.0" encoding="utf-8"?> <svg width="24px" height="24px" viewBox="0 0 14 14" role="img" focusable="false" aria-hidden="true" xmlns="http://www.w3.org/2000/svg"><path d="m 11.58824,9.823529 q 0,-0.294117 -0.20589,-0.499999 L 9.85294,7.794118 q -0.20588,-0.205883 -0.5,-0.205883 -0.30882,0 -0.52941,0.235295 0.0221,0.02206 0.13971,0.136029 0.11764,0.113971 0.15808,0.158088 0.0404,0.04412 0.1103,0.139706 0.0698,0.09559 0.0956,0.1875 0.0257,0.09191 0.0257,0.202206 0,0.294117 -0.20588,0.5 -0.20588,0.205882 -0.5,0.205882 -0.1103,0 -0.20221,-0.02573 Q 8.35293,9.301471 8.25733,9.231621 8.16173,9.161771 8.11763,9.121327 8.07353,9.080887 7.95954,8.963238 7.84557,8.845591 7.82351,8.823533 7.58086,9.051474 7.58086,9.360297 q 0,0.294118 0.20588,0.5 l 1.51471,1.522059 q 0.19853,0.19853 0.5,0.19853 0.29412,0 0.5,-0.191177 l 1.08088,-1.073529 q 0.20589,-0.205883 0.20589,-0.492648 z M 6.41912,4.639706 q 0,-0.294118 -0.20588,-0.5 L 4.69853,2.617647 q -0.20588,-0.205882 -0.5,-0.205882 -0.28677,0 -0.5,0.198529 L 2.61765,3.683823 q -0.20589,0.205883 -0.20589,0.492648 0,0.294117 0.20589,0.499999 l 1.52941,1.529412 q 0.19853,0.19853 0.5,0.19853 0.30882,0 0.52941,-0.227942 Q 5.15437,6.15441 5.03676,6.040441 4.91912,5.92647 4.87868,5.882353 4.83828,5.838233 4.76838,5.742647 q -0.0698,-0.09559 -0.0956,-0.1875 -0.0257,-0.09191 -0.0257,-0.202206 0,-0.294117 0.20588,-0.5 0.20588,-0.205882 0.5,-0.205882 0.1103,0 0.20221,0.02573 0.0919,0.02573 0.1875,0.09559 0.0956,0.06985 0.1397,0.110294 0.0441,0.04044 0.15809,0.158089 Q 6.15443,5.154409 6.17649,5.176467 6.41914,4.948526 6.41914,4.639703 z M 13,9.823529 q 0,0.882353 -0.625,1.492647 l -1.08088,1.07353 Q 10.68382,13 9.80147,13 q -0.88971,0 -1.5,-0.625 L 6.78676,10.852941 Q 6.17647,10.242647 6.17647,9.360294 q 0,-0.904412 0.64706,-1.536764 L 6.17647,7.176471 Q 5.54412,7.82353 4.64706,7.82353 q -0.88235,0 -1.5,-0.617648 L 1.617647,5.676471 Q 1,5.058824 1,4.176471 1,3.294118 1.625,2.683824 L 2.70588,1.610294 Q 3.31618,1 4.19853,1 q 0.88971,0 1.5,0.625 l 1.51471,1.522059 q 0.61029,0.610294 0.61029,1.492647 0,0.904412 -0.64706,1.536764 L 7.82353,6.823529 Q 8.45588,6.17647 9.35294,6.17647 q 0.88235,0 1.5,0.617648 l 1.52941,1.529411 Q 13,8.941176 13,9.823529 z"/></svg>
          </a></h3>

<p>Start with a basic CMake setup:</p>

<div class="language-cmake highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">cmake_minimum_required</span><span class="p">(</span>VERSION 3.26<span class="p">)</span>
<span class="nb">project</span><span class="p">(</span>SQLiteImportExample LANGUAGES Swift C<span class="p">)</span>
</code></pre></div></div>

<p>This creates a CMake project called “SQLiteImportExample” that uses Swift and C, and requires CMake version 3.26 or newer.</p>

<p>We’re not going to build SQLite in this example, we’re going to pull it from the system, or from a provided sysroot.</p>

<div class="language-cmake highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">find_package</span><span class="p">(</span>SQLite3 REQUIRED<span class="p">)</span>
</code></pre></div></div>

<p>This tells CMake to go find SQLite3 according to the <code class="language-plaintext highlighter-rouge">FindSQLite3.cmake</code> package file. Since we’ve marked it as a required dependency, CMake will stop the configuration of the build if it can’t find parts of the package.</p>

<p>Once found, CMake defines the following variables:</p>
<ul>
  <li><code class="language-plaintext highlighter-rouge">SQLite3_INCLUDE_DIRS</code> — The file path where <code class="language-plaintext highlighter-rouge">sqlite3.h</code> is found</li>
  <li><code class="language-plaintext highlighter-rouge">SQLite3_LIBRARIES</code> — The libraries consumers of sqlite will need to link against</li>
  <li><code class="language-plaintext highlighter-rouge">SQLite3_VERSION</code> — The version of sqlite3 found</li>
  <li><code class="language-plaintext highlighter-rouge">SQLite3_FOUND</code> — Used to tell <code class="language-plaintext highlighter-rouge">find_package</code> that SQLite was found. Note that if we did not mark it as a <code class="language-plaintext highlighter-rouge">REQUIRED</code> package, we could later check this variable to see if it was found, and fall back on <code class="language-plaintext highlighter-rouge">ExternalProject</code> to build it separately if it was not.</li>
</ul>

<p>CMake will also define the <code class="language-plaintext highlighter-rouge">SQLite::SQLite3</code> build target, which we will use later to make it easier to propagate dependency and search location information through our build graph. Documentation on the SQLite3 package is available here: <a href="https://cmake.org/cmake/help/latest/module/FindSQLite3.html">FindSQLite3</a>.</p>

<h3 id="importing-sqlite-into-swift" class="header-with-anchor">Importing SQLite into Swift <a title="Permalink for Importing SQLite into Swift section" href="#importing-sqlite-into-swift">
            <?xml version="1.0" encoding="utf-8"?> <svg width="24px" height="24px" viewBox="0 0 14 14" role="img" focusable="false" aria-hidden="true" xmlns="http://www.w3.org/2000/svg"><path d="m 11.58824,9.823529 q 0,-0.294117 -0.20589,-0.499999 L 9.85294,7.794118 q -0.20588,-0.205883 -0.5,-0.205883 -0.30882,0 -0.52941,0.235295 0.0221,0.02206 0.13971,0.136029 0.11764,0.113971 0.15808,0.158088 0.0404,0.04412 0.1103,0.139706 0.0698,0.09559 0.0956,0.1875 0.0257,0.09191 0.0257,0.202206 0,0.294117 -0.20588,0.5 -0.20588,0.205882 -0.5,0.205882 -0.1103,0 -0.20221,-0.02573 Q 8.35293,9.301471 8.25733,9.231621 8.16173,9.161771 8.11763,9.121327 8.07353,9.080887 7.95954,8.963238 7.84557,8.845591 7.82351,8.823533 7.58086,9.051474 7.58086,9.360297 q 0,0.294118 0.20588,0.5 l 1.51471,1.522059 q 0.19853,0.19853 0.5,0.19853 0.29412,0 0.5,-0.191177 l 1.08088,-1.073529 q 0.20589,-0.205883 0.20589,-0.492648 z M 6.41912,4.639706 q 0,-0.294118 -0.20588,-0.5 L 4.69853,2.617647 q -0.20588,-0.205882 -0.5,-0.205882 -0.28677,0 -0.5,0.198529 L 2.61765,3.683823 q -0.20589,0.205883 -0.20589,0.492648 0,0.294117 0.20589,0.499999 l 1.52941,1.529412 q 0.19853,0.19853 0.5,0.19853 0.30882,0 0.52941,-0.227942 Q 5.15437,6.15441 5.03676,6.040441 4.91912,5.92647 4.87868,5.882353 4.83828,5.838233 4.76838,5.742647 q -0.0698,-0.09559 -0.0956,-0.1875 -0.0257,-0.09191 -0.0257,-0.202206 0,-0.294117 0.20588,-0.5 0.20588,-0.205882 0.5,-0.205882 0.1103,0 0.20221,0.02573 0.0919,0.02573 0.1875,0.09559 0.0956,0.06985 0.1397,0.110294 0.0441,0.04044 0.15809,0.158089 Q 6.15443,5.154409 6.17649,5.176467 6.41914,4.948526 6.41914,4.639703 z M 13,9.823529 q 0,0.882353 -0.625,1.492647 l -1.08088,1.07353 Q 10.68382,13 9.80147,13 q -0.88971,0 -1.5,-0.625 L 6.78676,10.852941 Q 6.17647,10.242647 6.17647,9.360294 q 0,-0.904412 0.64706,-1.536764 L 6.17647,7.176471 Q 5.54412,7.82353 4.64706,7.82353 q -0.88235,0 -1.5,-0.617648 L 1.617647,5.676471 Q 1,5.058824 1,4.176471 1,3.294118 1.625,2.683824 L 2.70588,1.610294 Q 3.31618,1 4.19853,1 q 0.88971,0 1.5,0.625 l 1.51471,1.522059 q 0.61029,0.610294 0.61029,1.492647 0,0.904412 -0.64706,1.536764 L 7.82353,6.823529 Q 8.45588,6.17647 9.35294,6.17647 q 0.88235,0 1.5,0.617648 l 1.52941,1.529411 Q 13,8.941176 13,9.823529 z"/></svg>
          </a></h3>

<p>Swift can’t import header files directly. Some tools like SwiftPM and Xcode can sometimes generate a modulemap for a bridging header, but others, like CMake, do not. Manually writing modulemaps can give you a bit more control over how a C library is imported into Swift. Details on how to write a module map file are available on the <a href="https://clang.llvm.org/docs/Modules.html#module-map-language">Module Map Language</a> specification.</p>

<p>For our example, we only need to expose the <code class="language-plaintext highlighter-rouge">sqlite3.h</code> header file to Swift.</p>

<p>The contents of our <code class="language-plaintext highlighter-rouge">sqlite3.modulemap</code> file are as follows:</p>

<div class="language-c highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">module</span> <span class="n">CSQLite</span> <span class="p">{</span>
  <span class="n">header</span> <span class="s">"sqlite3.h"</span>
<span class="p">}</span>
</code></pre></div></div>

<p>The module name represents the name that we use to import this module into Swift. For our example, the corresponding Swift import statement will be <code class="language-plaintext highlighter-rouge">import CSQLite</code>.</p>

<p>We can include additional directives, like <code class="language-plaintext highlighter-rouge">link "sqlite3"</code> to indicate to the autolink mechanism that it should automatically link against the sqlite3 library, but this is unnecessary for our purposes as CMake will do this for us automatically when we tell our program to link against the sqlite library.</p>

<p>Now, we need to place the modulemap file in the right location. We expect the modulemap file to live next to the <code class="language-plaintext highlighter-rouge">sqlite.h</code> file, but depending on where <code class="language-plaintext highlighter-rouge">sqlite.h</code> lives, this may not be accessible to us. This is where virtual-filesystems come in. The virtual filesystem (or VFS) is the view of the filesystem from the perspective of the compiler. A VFS overlay file allows us to override that view so we can change filenames and place files anywhere in the filesystem from the view of the compiler, without actually placing them there on the physical drive.</p>

<p>The input format for a VFS overlay is YAML (note that JSON is a subset of YAML, so you can represent this as a JSON object if you prefer). The downside is that this file expects absolute paths to the roots, or the location that you’re overriding. Depending on where you’re writing to, that location may not be portable, so hard-coding these files may not work. We can, however, use CMake to generate the overlay that works for our system dynamically. We’ll add the following template to our project and call it <code class="language-plaintext highlighter-rouge">sqlite-vfs-overlay.yaml</code>.</p>

<div class="language-yaml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nn">---</span>
<span class="na">version</span><span class="pi">:</span> <span class="m">0</span>
<span class="na">case-sensitive</span><span class="pi">:</span> <span class="kc">false</span>
<span class="na">use-external-names</span><span class="pi">:</span> <span class="kc">false</span>
<span class="na">roots</span><span class="pi">:</span>
  <span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s2">"</span><span class="s">@SQLite3_INCLUDE_DIR@"</span>
    <span class="na">type</span><span class="pi">:</span> <span class="s">directory</span>
    <span class="na">contents</span><span class="pi">:</span>
      <span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s">module.modulemap</span>
        <span class="na">type</span><span class="pi">:</span> <span class="s">file</span>
        <span class="na">external-contents</span><span class="pi">:</span> <span class="s2">"</span><span class="s">@SQLite3_MODULEMAP_FILE@"</span>
</code></pre></div></div>

<p>The file is incomplete though. We will pair the overlay template with the following CMake emit the final overlay file that matches our environment.</p>

<div class="language-cmake highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># Setup the VFS-overlay to inject the custom modulemap to import SQLite into Swift</span>
<span class="nb">set</span><span class="p">(</span>SQLite3_MODULEMAP_FILE <span class="s2">"</span><span class="si">${</span><span class="nv">CMAKE_CURRENT_SOURCE_DIR</span><span class="si">}</span><span class="s2">/sqlite3.modulemap"</span><span class="p">)</span>
<span class="nb">configure_file</span><span class="p">(</span>sqlite-vfs-overlay.yaml <span class="s2">"</span><span class="si">${</span><span class="nv">CMAKE_CURRENT_BINARY_DIR</span><span class="si">}</span><span class="s2">/sqlite3-overlay.yaml"</span><span class="p">)</span>

<span class="nb">target_compile_options</span><span class="p">(</span>SQLite::SQLite3 INTERFACE
  <span class="s2">"$&lt;$&lt;COMPILE_LANGUAGE:Swift&gt;:SHELL:-vfsoverlay </span><span class="si">${</span><span class="nv">CMAKE_CURRENT_BINARY_DIR</span><span class="si">}</span><span class="s2">/sqlite3-overlay.yaml&gt;"</span>
<span class="p">)</span>
</code></pre></div></div>

<p>The result is a VFS overlay file that injects the custom modulemap file into the directory where <code class="language-plaintext highlighter-rouge">sqlite.h</code> lives, while renaming <code class="language-plaintext highlighter-rouge">sqlite.3.modulemap</code> to <code class="language-plaintext highlighter-rouge">module.modulemap</code>. All Swift programs that use the SQLite3 library will need to use the associated VFS overlay file in order to find the modulemap. We use <code class="language-plaintext highlighter-rouge">target_compile_options</code> to add it. Since <code class="language-plaintext highlighter-rouge">SQLite::SQLite3</code> is an imported library, it can’t affect building SQLite itself, so we add it as an <code class="language-plaintext highlighter-rouge">INTERFACE</code> option, ensuring that it gets propagated to all targets that depend on it.</p>

<p>Running CMake on this project now should either report that you’re missing SQLite, in which case you will need to install it in order to use it, or emit <code class="language-plaintext highlighter-rouge">sqlite3-overlay.yaml</code> into the top of your build directory.</p>

<div class="language-yaml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nn">---</span>
<span class="na">version</span><span class="pi">:</span> <span class="m">0</span>
<span class="na">case-sensitive</span><span class="pi">:</span> <span class="kc">false</span>
<span class="na">use-external-names</span><span class="pi">:</span> <span class="kc">false</span>
<span class="na">roots</span><span class="pi">:</span>
  <span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s2">"</span><span class="s">/usr/include"</span>
    <span class="na">type</span><span class="pi">:</span> <span class="s">directory</span>
    <span class="na">contents</span><span class="pi">:</span>
      <span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s">module.modulemap</span>
        <span class="na">type</span><span class="pi">:</span> <span class="s">file</span>
        <span class="na">external-contents</span><span class="pi">:</span> <span class="s2">"</span><span class="s">/home/ewilde/sqlite-import-example/sqlite3.modulemap"</span>
</code></pre></div></div>

<p>This is what is emitted on my Linux system, where <code class="language-plaintext highlighter-rouge">sqlite3.h</code> is located at <code class="language-plaintext highlighter-rouge">/usr/include</code> and the project sources are in a directory in my home directory.</p>

<p>This should be sufficient to get things imported. Wrapping up, we have a total of four files in our project:</p>

<ul>
  <li><code class="language-plaintext highlighter-rouge">sqlite3.modulemap</code> tells Swift which C header files are associated with which imported module.</li>
  <li><code class="language-plaintext highlighter-rouge">sqlite-vfs-overlay.yaml</code> tells Swift to inject the sqlite3 modulemap file into the right place for importing without needing to change the actual system.</li>
  <li><code class="language-plaintext highlighter-rouge">CMakeLists.txt</code> organizes configuring the VFS overlay, and then building the project.</li>
  <li><code class="language-plaintext highlighter-rouge">hello.swift</code> calls into the C SQLite library.</li>
</ul>

<div class="language-c highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">// sqlite3.modulemap</span>
<span class="n">module</span> <span class="n">CSQLite</span> <span class="p">{</span>
  <span class="n">header</span> <span class="s">"sqlite3.h"</span>
<span class="p">}</span>
</code></pre></div></div>

<div class="language-yaml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># sqlite-vfs-overlay.yaml</span>
<span class="nn">---</span>
<span class="na">version</span><span class="pi">:</span> <span class="m">0</span>
<span class="na">case-sensitive</span><span class="pi">:</span> <span class="kc">false</span>
<span class="na">use-external-names</span><span class="pi">:</span> <span class="kc">false</span>
<span class="na">roots</span><span class="pi">:</span>
  <span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s2">"</span><span class="s">@SQLite3_INCLUDE_DIR@"</span>
    <span class="na">type</span><span class="pi">:</span> <span class="s">directory</span>
    <span class="na">contents</span><span class="pi">:</span>
      <span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s">module.modulemap</span>
        <span class="na">type</span><span class="pi">:</span> <span class="s">file</span>
        <span class="na">external-contents</span><span class="pi">:</span> <span class="s2">"</span><span class="s">@SQLite3_MODULEMAP_FILE@"</span>
</code></pre></div></div>

<div class="language-cmake highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># CMakeLists.txt</span>
<span class="nb">cmake_minimum_required</span><span class="p">(</span>VERSION 3.26<span class="p">)</span>
<span class="nb">project</span><span class="p">(</span>SQLiteImportExample LANGUAGES Swift C<span class="p">)</span>

<span class="nb">find_package</span><span class="p">(</span>SQLite3 REQUIRED<span class="p">)</span>

<span class="c1"># Setup the VFS-overlay to inject the custom modulemap file</span>
<span class="nb">set</span><span class="p">(</span>SQLite3_MODULEMAP_FILE <span class="s2">"</span><span class="si">${</span><span class="nv">CMAKE_CURRENT_SOURCE_DIR</span><span class="si">}</span><span class="s2">/sqlite3.modulemap"</span><span class="p">)</span>
<span class="nb">configure_file</span><span class="p">(</span>sqlite-vfs-overlay.yaml
               <span class="s2">"</span><span class="si">${</span><span class="nv">CMAKE_CURRENT_BINARY_DIR</span><span class="si">}</span><span class="s2">/sqlite3-overlay.yaml"</span><span class="p">)</span>
<span class="nb">target_compile_options</span><span class="p">(</span>SQLite::SQLite3 INTERFACE
  <span class="s2">"$&lt;$&lt;COMPILE_LANGUAGE:Swift&gt;:SHELL:-vfsoverlay </span><span class="si">${</span><span class="nv">CMAKE_CURRENT_BINARY_DIR</span><span class="si">}</span><span class="s2">/sqlite3-overlay.yaml&gt;"</span><span class="p">)</span>

<span class="nb">add_executable</span><span class="p">(</span>Hello hello.swift<span class="p">)</span>
<span class="nb">target_link_libraries</span><span class="p">(</span>Hello PRIVATE SQLite::SQLite3<span class="p">)</span>
</code></pre></div></div>

<div class="language-swift highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">// hello.swift</span>
<span class="kd">import</span> <span class="kt">CSQLite</span>

<span class="kd">public</span> <span class="kd">class</span> <span class="kt">Database</span> <span class="p">{</span>
    <span class="k">var</span> <span class="nv">dbCon</span><span class="p">:</span> <span class="kt">OpaquePointer</span><span class="o">!</span>

    <span class="kd">public</span> <span class="kd">struct</span> <span class="kt">Flags</span><span class="p">:</span> <span class="kt">OptionSet</span> <span class="p">{</span>
        <span class="kd">public</span> <span class="k">let</span> <span class="nv">rawValue</span><span class="p">:</span> <span class="kt">Int32</span>

        <span class="kd">public</span> <span class="nf">init</span><span class="p">(</span><span class="nv">rawValue</span><span class="p">:</span> <span class="kt">Int32</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">self</span><span class="o">.</span><span class="n">rawValue</span> <span class="o">=</span> <span class="n">rawValue</span>
        <span class="p">}</span>

        <span class="kd">public</span> <span class="kd">static</span> <span class="k">let</span> <span class="nv">readonly</span> <span class="o">=</span> <span class="kt">Flags</span><span class="p">(</span><span class="nv">rawValue</span><span class="p">:</span> <span class="kt">SQLITE_OPEN_READONLY</span><span class="p">)</span>
        <span class="kd">public</span> <span class="kd">static</span> <span class="k">let</span> <span class="nv">readwrite</span> <span class="o">=</span> <span class="kt">Flags</span><span class="p">(</span><span class="nv">rawValue</span><span class="p">:</span> <span class="kt">SQLITE_OPEN_READWRITE</span><span class="p">)</span>
        <span class="kd">public</span> <span class="kd">static</span> <span class="k">let</span> <span class="nv">create</span> <span class="o">=</span> <span class="kt">Flags</span><span class="p">(</span><span class="nv">rawValue</span><span class="p">:</span> <span class="kt">SQLITE_OPEN_CREATE</span><span class="p">)</span>
        <span class="kd">public</span> <span class="kd">static</span> <span class="k">let</span> <span class="nv">deleteOnClose</span> <span class="o">=</span> <span class="kt">Flags</span><span class="p">(</span><span class="nv">rawValue</span><span class="p">:</span> <span class="kt">SQLITE_OPEN_DELETEONCLOSE</span><span class="p">)</span>
    <span class="p">}</span>

    <span class="kd">public</span> <span class="nf">init</span><span class="p">?(</span><span class="nv">filename</span><span class="p">:</span> <span class="kt">String</span><span class="p">,</span> <span class="nv">flags</span><span class="p">:</span> <span class="kt">Flags</span> <span class="o">=</span> <span class="p">[</span><span class="o">.</span><span class="n">create</span><span class="p">,</span> <span class="o">.</span><span class="n">readwrite</span><span class="p">])</span> <span class="p">{</span>
        <span class="k">guard</span> <span class="nf">sqlite3_open_v2</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">dbCon</span><span class="p">,</span> <span class="n">flags</span><span class="o">.</span><span class="n">rawValue</span><span class="p">,</span> <span class="kc">nil</span><span class="p">)</span> <span class="o">==</span> <span class="kt">SQLITE_OK</span><span class="p">,</span>
              <span class="n">dbCon</span> <span class="o">!=</span> <span class="kc">nil</span> <span class="k">else</span> <span class="p">{</span>
            <span class="k">return</span> <span class="kc">nil</span>
        <span class="p">}</span>
    <span class="p">}</span>

    <span class="kd">deinit</span> <span class="p">{</span>
        <span class="nf">sqlite3_close_v2</span><span class="p">(</span><span class="n">dbCon</span><span class="p">)</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="k">guard</span> <span class="k">let</span> <span class="nv">database</span> <span class="o">=</span> <span class="kt">Database</span><span class="p">(</span><span class="nv">filename</span><span class="p">:</span> <span class="s">":memory:"</span><span class="p">)</span> <span class="k">else</span> <span class="p">{</span>
    <span class="nf">fatalError</span><span class="p">(</span><span class="s">"Failed to load database for some reason"</span><span class="p">)</span>
<span class="p">}</span>
</code></pre></div></div>

<h2 id="working-with-cc" class="header-with-anchor">Working with C/C++ <a title="Permalink for Working with C/C++ section" href="#working-with-cc">
            <?xml version="1.0" encoding="utf-8"?> <svg width="24px" height="24px" viewBox="0 0 14 14" role="img" focusable="false" aria-hidden="true" xmlns="http://www.w3.org/2000/svg"><path d="m 11.58824,9.823529 q 0,-0.294117 -0.20589,-0.499999 L 9.85294,7.794118 q -0.20588,-0.205883 -0.5,-0.205883 -0.30882,0 -0.52941,0.235295 0.0221,0.02206 0.13971,0.136029 0.11764,0.113971 0.15808,0.158088 0.0404,0.04412 0.1103,0.139706 0.0698,0.09559 0.0956,0.1875 0.0257,0.09191 0.0257,0.202206 0,0.294117 -0.20588,0.5 -0.20588,0.205882 -0.5,0.205882 -0.1103,0 -0.20221,-0.02573 Q 8.35293,9.301471 8.25733,9.231621 8.16173,9.161771 8.11763,9.121327 8.07353,9.080887 7.95954,8.963238 7.84557,8.845591 7.82351,8.823533 7.58086,9.051474 7.58086,9.360297 q 0,0.294118 0.20588,0.5 l 1.51471,1.522059 q 0.19853,0.19853 0.5,0.19853 0.29412,0 0.5,-0.191177 l 1.08088,-1.073529 q 0.20589,-0.205883 0.20589,-0.492648 z M 6.41912,4.639706 q 0,-0.294118 -0.20588,-0.5 L 4.69853,2.617647 q -0.20588,-0.205882 -0.5,-0.205882 -0.28677,0 -0.5,0.198529 L 2.61765,3.683823 q -0.20589,0.205883 -0.20589,0.492648 0,0.294117 0.20589,0.499999 l 1.52941,1.529412 q 0.19853,0.19853 0.5,0.19853 0.30882,0 0.52941,-0.227942 Q 5.15437,6.15441 5.03676,6.040441 4.91912,5.92647 4.87868,5.882353 4.83828,5.838233 4.76838,5.742647 q -0.0698,-0.09559 -0.0956,-0.1875 -0.0257,-0.09191 -0.0257,-0.202206 0,-0.294117 0.20588,-0.5 0.20588,-0.205882 0.5,-0.205882 0.1103,0 0.20221,0.02573 0.0919,0.02573 0.1875,0.09559 0.0956,0.06985 0.1397,0.110294 0.0441,0.04044 0.15809,0.158089 Q 6.15443,5.154409 6.17649,5.176467 6.41914,4.948526 6.41914,4.639703 z M 13,9.823529 q 0,0.882353 -0.625,1.492647 l -1.08088,1.07353 Q 10.68382,13 9.80147,13 q -0.88971,0 -1.5,-0.625 L 6.78676,10.852941 Q 6.17647,10.242647 6.17647,9.360294 q 0,-0.904412 0.64706,-1.536764 L 6.17647,7.176471 Q 5.54412,7.82353 4.64706,7.82353 q -0.88235,0 -1.5,-0.617648 L 1.617647,5.676471 Q 1,5.058824 1,4.176471 1,3.294118 1.625,2.683824 L 2.70588,1.610294 Q 3.31618,1 4.19853,1 q 0.88971,0 1.5,0.625 l 1.51471,1.522059 q 0.61029,0.610294 0.61029,1.492647 0,0.904412 -0.64706,1.536764 L 7.82353,6.823529 Q 8.45588,6.17647 9.35294,6.17647 q 0.88235,0 1.5,0.617648 l 1.52941,1.529411 Q 13,8.941176 13,9.823529 z"/></svg>
          </a></h2>

<h3 id="managing-a-wrapped-cc-types-lifetime" class="header-with-anchor">Managing a wrapped C/C++ type’s lifetime <a title="Permalink for Managing a wrapped C/C++ type’s lifetime section" href="#managing-a-wrapped-cc-types-lifetime">
            <?xml version="1.0" encoding="utf-8"?> <svg width="24px" height="24px" viewBox="0 0 14 14" role="img" focusable="false" aria-hidden="true" xmlns="http://www.w3.org/2000/svg"><path d="m 11.58824,9.823529 q 0,-0.294117 -0.20589,-0.499999 L 9.85294,7.794118 q -0.20588,-0.205883 -0.5,-0.205883 -0.30882,0 -0.52941,0.235295 0.0221,0.02206 0.13971,0.136029 0.11764,0.113971 0.15808,0.158088 0.0404,0.04412 0.1103,0.139706 0.0698,0.09559 0.0956,0.1875 0.0257,0.09191 0.0257,0.202206 0,0.294117 -0.20588,0.5 -0.20588,0.205882 -0.5,0.205882 -0.1103,0 -0.20221,-0.02573 Q 8.35293,9.301471 8.25733,9.231621 8.16173,9.161771 8.11763,9.121327 8.07353,9.080887 7.95954,8.963238 7.84557,8.845591 7.82351,8.823533 7.58086,9.051474 7.58086,9.360297 q 0,0.294118 0.20588,0.5 l 1.51471,1.522059 q 0.19853,0.19853 0.5,0.19853 0.29412,0 0.5,-0.191177 l 1.08088,-1.073529 q 0.20589,-0.205883 0.20589,-0.492648 z M 6.41912,4.639706 q 0,-0.294118 -0.20588,-0.5 L 4.69853,2.617647 q -0.20588,-0.205882 -0.5,-0.205882 -0.28677,0 -0.5,0.198529 L 2.61765,3.683823 q -0.20589,0.205883 -0.20589,0.492648 0,0.294117 0.20589,0.499999 l 1.52941,1.529412 q 0.19853,0.19853 0.5,0.19853 0.30882,0 0.52941,-0.227942 Q 5.15437,6.15441 5.03676,6.040441 4.91912,5.92647 4.87868,5.882353 4.83828,5.838233 4.76838,5.742647 q -0.0698,-0.09559 -0.0956,-0.1875 -0.0257,-0.09191 -0.0257,-0.202206 0,-0.294117 0.20588,-0.5 0.20588,-0.205882 0.5,-0.205882 0.1103,0 0.20221,0.02573 0.0919,0.02573 0.1875,0.09559 0.0956,0.06985 0.1397,0.110294 0.0441,0.04044 0.15809,0.158089 Q 6.15443,5.154409 6.17649,5.176467 6.41914,4.948526 6.41914,4.639703 z M 13,9.823529 q 0,0.882353 -0.625,1.492647 l -1.08088,1.07353 Q 10.68382,13 9.80147,13 q -0.88971,0 -1.5,-0.625 L 6.78676,10.852941 Q 6.17647,10.242647 6.17647,9.360294 q 0,-0.904412 0.64706,-1.536764 L 6.17647,7.176471 Q 5.54412,7.82353 4.64706,7.82353 q -0.88235,0 -1.5,-0.617648 L 1.617647,5.676471 Q 1,5.058824 1,4.176471 1,3.294118 1.625,2.683824 L 2.70588,1.610294 Q 3.31618,1 4.19853,1 q 0.88971,0 1.5,0.625 l 1.51471,1.522059 q 0.61029,0.610294 0.61029,1.492647 0,0.904412 -0.64706,1.536764 L 7.82353,6.823529 Q 8.45588,6.17647 9.35294,6.17647 q 0.88235,0 1.5,0.617648 l 1.52941,1.529411 Q 13,8.941176 13,9.823529 z"/></svg>
          </a></h3>

<p>When wrapping a C/C++ type that has a specified lifetime such as outlined by some initialization and later on a “destroy” call of some form, there are two ways to approach this in Swift. This situation is especially common when wrapping C types which have some <code class="language-plaintext highlighter-rouge">resource_init()</code> and <code class="language-plaintext highlighter-rouge">resource_destroy(the_resource)</code> APIs.</p>

<p>The first approach is to use a Swift class to wrap the resource and manage its lifetime by the class’s <code class="language-plaintext highlighter-rouge">init</code>/<code class="language-plaintext highlighter-rouge">deinit</code>. Here is an example wrapping a C managed settings object from RocksDB:</p>

<div class="language-swift highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">public</span> <span class="kd">final</span> <span class="kd">class</span> <span class="kt">WriteOptions</span> <span class="p">{</span>
    <span class="k">let</span> <span class="nv">underlying</span><span class="p">:</span> <span class="kt">OpaquePointer</span><span class="o">!</span>

    <span class="kd">public</span> <span class="nf">init</span><span class="p">()</span> <span class="p">{</span>
        <span class="n">underlying</span> <span class="o">=</span> <span class="nf">rocksdb_writeoptions_create</span><span class="p">()</span>
    <span class="p">}</span>

    <span class="kd">deinit</span> <span class="p">{</span>
        <span class="nf">rocksdb_writeoptions_destroy</span><span class="p">(</span><span class="n">underlying</span><span class="p">)</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div>

<p>The second approach is to use “non-copyable” types (which you may know as move-only types from other languages). To declare a similar <code class="language-plaintext highlighter-rouge">WriteOptions</code> wrapper using a noncopyable type you can do the following:</p>

<div class="language-swift highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">public</span> <span class="kd">struct</span> <span class="kt">WriteOptions</span><span class="p">:</span> <span class="kt">~Copyable</span> <span class="p">{</span>
    <span class="k">let</span> <span class="nv">underlying</span><span class="p">:</span> <span class="kt">OpaquePointer</span><span class="o">!</span>

    <span class="kd">public</span> <span class="nf">init</span><span class="p">()</span> <span class="p">{</span>
        <span class="n">underlying</span> <span class="o">=</span> <span class="nf">rocksdb_writeoptions_create</span><span class="p">()</span>
    <span class="p">}</span>

    <span class="kd">deinit</span> <span class="p">{</span>
        <span class="nf">rocksdb_writeoptions_destroy</span><span class="p">(</span><span class="n">underlying</span><span class="p">)</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div>

<p>The downside of non-copyable types is that currently they cannot be used in all contexts. For example in Swift 5.9 it is not possible to store a non-copyable type as a field, or pass them through closures (as the closure could be used many times, which would break the uniqueness that a non-copyable type needs to guarantee). The upside is that, unlike classes, no reference counting is performed on non-copyable types.</p>



  
    <footer>
      <p>Contributed by</p>
      <div class="authors">
  
    
    
      <div class="author">
        <div class="byline">
          <img
            
              src="https://www.github.com/etcwilde.png?size=64"
            
            alt="Evan Wilde"
            title=""
            />
          <span class="author">
            
              <a href="https://github.com/etcwilde/" rel="nofollow" title="Evan Wilde (@etcwilde) on GitHub">Evan Wilde</a>
            
          </span>
        </div>
        
          
          
        
      </div>
    
  
    
    
      <div class="author">
        <div class="byline">
          <img
            
              src="https://www.gravatar.com/avatar/03cb20b97f6a14701c24c4e088b6af87?s=64&d=mp"
            
            alt="Konrad ‘ktoso’ Malawski"
            title=""
            />
          <span class="author">
            
              <a href="https://github.com/ktoso/" rel="nofollow" title="Konrad ‘ktoso’ Malawski (@ktoso) on GitHub">Konrad ‘ktoso’ Malawski</a>
            
          </span>
        </div>
        
          
          
            <div class="about">Konrad Malawski is a member of a team developing foundational server-side Swift libraries at Apple, with focus on distributed systems and concurrency.</div>
          
        
      </div>
    
  
    
    
      <div class="author">
        <div class="byline">
          <img
            
              src="https://www.gravatar.com/avatar/6c6eb474fd49bcafa7a8ba7d91ad06e0?s=64&d=mp"
            
            alt="Yim Lee"
            title=""
            />
          <span class="author">
            
              <a href="https://github.com/yim-lee/" rel="nofollow" title="Yim Lee (@yim-lee) on GitHub">Yim Lee</a>
            
          </span>
        </div>
        
          
          
            <div class="about">Yim Lee is an engineer on the Swift team at Apple, developing foundational server-side technologies with focus on distributed systems.</div>
          
        
      </div>
    
  
</div>
    </footer>
  
</article>

</main>

<footer role="contentinfo">
  <div class="footer-content">
    
    <p class="copyright">Copyright © 2025 Apple Inc. All rights reserved.</p>
    <p class="trademark">Swift and the Swift logo are trademarks of Apple Inc.</p>
    <p class="privacy">
      <a href="//www.apple.com/privacy/privacy-policy/">Privacy Policy</a>
      <a href="//www.apple.com/legal/privacy/en-ww/cookies/">Cookies</a>
      <a href="/openapi">API</a>
    </p>
  </div>
  <div class="footer-other">
    <form
      class="color-scheme-toggle"
      role="radiogroup"
      tabindex="0"
      id="color-scheme-toggle"
    >
      <legend class="visuallyhidden">Color scheme preference</legend>
      <label for="scheme-light">
        <input id="scheme-light" type="radio" name="color-scheme-preference" value="light">
        <span class="color-scheme-toggle-label">Light</span>
      </label>
      <label for="scheme-dark">
        <input id="scheme-dark" type="radio" name="color-scheme-preference" value="dark">
        <span class="color-scheme-toggle-label">Dark</span>
      </label>
      <label for="scheme-auto" id="scheme-auto-wrapper">
        <input id="scheme-auto" type="radio" name="color-scheme-preference" value="auto">
        <span class="color-scheme-toggle-label">Auto</span>
      </label>
    </form>
    <aside>
      <a href="https://x.com/swiftlang" rel="me" title="Follow @SwiftLang on X"><i class="x"></i></a>
      <a href="https://bsky.app/profile/swift.org" rel="me" title="Follow @swift.org on Bluesky"><i class="bluesky"></i></a>
      <a href="https://mastodon.social/@swiftlang" rel="me" title="Follow @swiftLang on Mastodon"><i class="mastodon"></i></a>
      <a href="/atom.xml" title="Subscribe to Site Updates"><i class="feed"></i></a>
    </aside>
  </div>
</footer>


<script src="/swift-org-website/pr-preview/pr-1/assets/javascripts/application.js"></script>
<!-- metrics -->
<script>
    /* RSID: */
    var s_account="awdswiftorg"
</script>

<script src="https://developer.apple.com/assets/metrics/scripts/analytics.js"></script>
<script>
    s.pageName= AC && AC.Tracking && AC.Tracking.pageName();

    /************* DO NOT ALTER ANYTHING BELOW THIS LINE ! **************/
    var s_code=s.t();if(s_code)document.write(s_code)
</script>

<!-- /metrics -->
</body>
</html>
