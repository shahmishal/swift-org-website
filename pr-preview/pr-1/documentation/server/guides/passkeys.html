<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="utf-8" />
  <title>Swift.org - Going passwordless with Passkeys</title>
  
  <meta name="author" content="Apple Inc." />
  <meta name="viewport" content="width=device-width initial-scale=1" />
  
  <link rel="license" href="/swift-org-website/pr-preview/pr-1/LICENSE.txt" />
  <link rel="stylesheet" media="all" href="/swift-org-website/pr-preview/pr-1/assets/stylesheets/application.css" />
  <link rel="shortcut icon" sizes="16x16 24x24 32x32 48x48 64x64" type="image/vnd.microsoft.icon" href="/swift-org-website/pr-preview/pr-1/favicon.ico" />
  <link rel="apple-touch-icon" href="/swift-org-website/pr-preview/pr-1/apple-touch-icon.png" />
  <link rel="apple-touch-icon" sizes="57x57" href="/swift-org-website/pr-preview/pr-1/apple-touch-icon-57x57.png" />
  <link rel="apple-touch-icon" sizes="72x72" href="/swift-org-website/pr-preview/pr-1/apple-touch-icon-72x72.png" />
  <link rel="apple-touch-icon" sizes="76x76" href="/swift-org-website/pr-preview/pr-1/apple-touch-icon-76x76.png" />
  <link rel="apple-touch-icon" sizes="114x114" href="/swift-org-website/pr-preview/pr-1/apple-touch-icon-114x114.png" />
  <link rel="apple-touch-icon" sizes="120x120" href="/swift-org-website/pr-preview/pr-1/apple-touch-icon-120x120.png" />
  <link rel="apple-touch-icon" sizes="144x144" href="/swift-org-website/pr-preview/pr-1/apple-touch-icon-144x144.png" />
  <link rel="apple-touch-icon" sizes="152x152" href="/swift-org-website/pr-preview/pr-1/apple-touch-icon-152x152.png" />
  <link rel="apple-touch-icon" sizes="180x180" href="/swift-org-website/pr-preview/pr-1/apple-touch-icon-180x180.png" />
  <link rel="mask-icon" href="/swift-org-website/pr-preview/pr-1/assets/images/icon-swift.svg" color="#F05339" />
  

  
  <link rel="canonical" href="https://shahmishal.github.io/swift-org-website/pr-preview/pr-1/swift-org-website/pr-preview/pr-1/documentation/server/guides/passkeys.html" />
  

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:site" content="@SwiftLang" />
  
  <meta name="twitter:title" content="Swift.org" />
  <meta name="twitter:description" content="Swift is a general-purpose programming language built using a modern approach to safety, performance, and software design patterns." />
  

  <meta property="og:site_name" content="Swift.org" />
  <meta property="og:image" content="https://shahmishal.github.io/swift-org-website/pr-preview/pr-1/apple-touch-icon-180x180.png" />
  
  
  <meta property="og:title" content="Swift.org" />
  <meta property="og:url" content="https://shahmishal.github.io/swift-org-website/pr-preview/pr-1" />
  <meta property="og:description" content="Swift is a general-purpose programming language built using a modern approach to safety, performance, and software design patterns." />
  
</head>

<body>

<script src="/swift-org-website/pr-preview/pr-1/assets/javascripts/color-scheme-toggle.js"></script>
<header class="site-navigation">
  <div class="wrapper">
    <h1 id="logo">
      <a href="/" title="Swift.org">
        <svg xmlns="http://www.w3.org/2000/svg" xml:space="preserve" viewBox="0 0 191.186 59.391"><path fill="#F05138" d="M59.387 16.45a82.463 82.463 0 0 0-.027-1.792c-.035-1.301-.112-2.614-.343-3.9-.234-1.307-.618-2.523-1.222-3.71a12.464 12.464 0 0 0-5.453-5.452C51.156.992 49.941.609 48.635.374c-1.288-.232-2.6-.308-3.902-.343a85.714 85.714 0 0 0-1.792-.027C42.23 0 41.52 0 40.813 0H18.578c-.71 0-1.419 0-2.128.004-.597.004-1.195.01-1.792.027-.325.009-.651.02-.978.036-.978.047-1.959.133-2.924.307-.98.176-1.908.436-2.811.81A12.503 12.503 0 0 0 3.89 3.89a12.46 12.46 0 0 0-2.294 3.158C.992 8.235.61 9.45.374 10.758c-.231 1.286-.308 2.599-.343 3.9a85.767 85.767 0 0 0-.027 1.792C-.001 17.16 0 17.869 0 18.578v22.235c0 .71 0 1.418.004 2.128.004.597.01 1.194.027 1.791.035 1.302.112 2.615.343 3.901.235 1.307.618 2.523 1.222 3.71a12.457 12.457 0 0 0 5.453 5.453c1.186.603 2.401.986 3.707 1.22 1.287.232 2.6.31 3.902.344.597.016 1.195.023 1.793.027.709.005 1.417.004 2.127.004h22.235c.709 0 1.418 0 2.128-.004.597-.004 1.194-.011 1.792-.027 1.302-.035 2.614-.112 3.902-.343 1.306-.235 2.521-.618 3.707-1.222a12.461 12.461 0 0 0 5.453-5.452c.604-1.187.987-2.403 1.222-3.71.231-1.286.308-2.6.343-3.9.016-.598.023-1.194.027-1.792.004-.71.004-1.419.004-2.129V18.578c0-.71 0-1.419-.004-2.128z"/><path fill="#FFF" d="m47.06 36.66-.004-.004c.066-.224.134-.446.191-.675 2.465-9.821-3.55-21.432-13.731-27.546 4.461 6.048 6.434 13.374 4.681 19.78-.156.571-.344 1.12-.552 1.653-.225-.148-.51-.316-.89-.527 0 0-10.127-6.252-21.103-17.312-.288-.29 5.852 8.777 12.822 16.14-3.284-1.843-12.434-8.5-18.227-13.802.712 1.187 1.558 2.33 2.489 3.43C17.573 23.932 23.882 31.5 31.44 37.314c-5.31 3.25-12.814 3.502-20.285.003a30.646 30.646 0 0 1-5.193-3.098c3.162 5.058 8.033 9.423 13.96 11.97 7.07 3.039 14.1 2.833 19.336.05l-.004.007c.024-.016.055-.032.08-.047.214-.116.428-.234.636-.358 2.516-1.306 7.485-2.63 10.152 2.559.654 1.27 2.041-5.46-3.061-11.74z"/><path id="logotype" d="M81.93 38.542c.465 4.12 4.394 6.822 9.852 6.822 5.185 0 8.924-2.701 8.924-6.44 0-3.22-2.265-5.185-7.478-6.495l-5.048-1.282c-7.26-1.801-10.534-5.077-10.534-10.48 0-6.658 5.813-11.27 14.082-11.27 8.022 0 13.726 4.639 13.917 11.325h-5.32c-.41-4.093-3.74-6.604-8.734-6.604-4.94 0-8.378 2.538-8.378 6.249 0 2.892 2.13 4.612 7.369 5.95l4.202 1.09c8.133 1.993 11.462 5.159 11.462 10.863 0 7.259-5.759 11.816-14.928 11.816-8.514 0-14.327-4.53-14.763-11.543h5.376zM140.049 49.43h-5.35l-6.249-21.776h-.109L122.12 49.43h-5.348l-7.914-28.518h5.184l5.513 22.896h.11l6.221-22.896h5.021l6.277 22.896h.11l5.512-22.896h5.13L140.05 49.43zM151.39 13.244c0-1.718 1.419-3.11 3.138-3.11 1.746 0 3.165 1.392 3.165 3.11 0 1.72-1.419 3.139-3.165 3.139a3.157 3.157 0 0 1-3.139-3.139zm.545 7.669h5.213V49.43h-5.213V20.913zM191.186 25.116v-4.204h-5.513v-6.821h-5.185v6.821h-9.964v-2.51c.027-2.538 1.01-3.603 3.357-3.603.764 0 1.528.083 2.156.192v-4.094a18.193 18.193 0 0 0-2.756-.218c-5.568 0-7.915 2.32-7.915 7.642v2.591h-3.983v4.204h3.983V49.43h5.185V25.116H180.488v16.838c0 5.512 2.101 7.64 7.559 7.64 1.174 0 2.51-.082 3.111-.218v-4.257c-.355.055-1.392.137-1.965.137-2.428 0-3.52-1.147-3.52-3.712V25.116h5.513z"/></svg>

      </a>
    </h1>

    <nav role="navigation">
      <ul class="navigation-links">
        
          <li class="nav-item">
            
              <span class="">
                
                  <a href="/getting-started/" data-text="Get Started">Get Started</a>
                
                
              </span>
            
            
          </li>
        
          <li class="nav-item">
            
              <span class="">
                
                  <a href="/blog/" data-text="Blog">Blog</a>
                
                
              </span>
            
            
          </li>
        
          <li class="nav-item">
            
              <span class="">
                
                  <a href="/documentation/" data-text="Documentation">Documentation</a>
                
                
              </span>
            
            
          </li>
        
          <li class="nav-item">
            
              <span class="">
                
                  <a href="/packages/" data-text="Packages">Packages</a>
                
                
              </span>
            
            
          </li>
        
          <li class="nav-item">
            
              <span class="">
                
                  <a href="/tools/" data-text="Tools">Tools</a>
                
                
              </span>
            
            
          </li>
        
          <li class="nav-item">
            
              <span class="">
                
                  <a href="/community/" data-text="Community">Community</a>
                
                
                  <i>&#9663;</i>
                
              </span>
            
            
              <ul class="nav-submenu" role="menu">
                
                  
                    
                    <li role="presentation">
                    
                      <a href="/community/" role="menuitem">Overview</a>
                    </li>
                  
                
                  
                    
                    <li role="presentation">
                    
                      <a href="/swift-evolution/" role="menuitem">Swift Evolution</a>
                    </li>
                  
                
                  
                    
                    <li role="presentation">
                    
                      <a href="/diversity/" role="menuitem">Diversity</a>
                    </li>
                  
                
                  
                    
                    <li role="presentation">
                    
                      <a href="/mentorship/" role="menuitem">Mentorship</a>
                    </li>
                  
                
                  
                    
                    <li role="presentation">
                    
                      <a href="/contributing/" role="menuitem">Contributing</a>
                    </li>
                  
                
                  
                  <li class="nav-section">Steering Groups</li>
                  
                
                  
                    
                    <li role="presentation">
                    
                      <a href="/language-steering-group/" role="menuitem">Language</a>
                    </li>
                  
                
                  
                    
                    <li role="presentation">
                    
                      <a href="/platform-steering-group/" role="menuitem">Platform</a>
                    </li>
                  
                
                  
                  <li class="nav-section">Workgroups</li>
                  
                
                  
                    
                    <li role="presentation">
                    
                      <a href="/contributor-experience-workgroup/" role="menuitem">Contributor Experience</a>
                    </li>
                  
                
                  
                    
                    <li role="presentation">
                    
                      <a href="/sswg/" role="menuitem">Server</a>
                    </li>
                  
                
                  
                    
                    <li role="presentation">
                    
                      <a href="/website/" role="menuitem">Website</a>
                    </li>
                  
                
                  
                    
                    <li role="presentation">
                    
                      <a href="/cxx-interop-workgroup/" role="menuitem">C++ Interoperability</a>
                    </li>
                  
                
                  
                    
                    <li role="presentation">
                    
                      <a href="/documentation-workgroup/" role="menuitem">Documentation</a>
                    </li>
                  
                
                  
                    
                    <li role="presentation">
                    
                      <a href="/foundation-workgroup/" role="menuitem">Foundation</a>
                    </li>
                  
                
                  
                  <li class="nav-section">Governance</li>
                  
                
                  
                    
                    <li role="presentation">
                    
                      <a href="/code-of-conduct/" role="menuitem">Code of Conduct</a>
                    </li>
                  
                
                  
                    
                    <li role="presentation">
                    
                      <a href="/legal/license.html" role="menuitem">License</a>
                    </li>
                  
                
                  
                    
                    <li role="presentation">
                    
                      <a href="/support/security.html" role="menuitem">Security</a>
                    </li>
                  
                
              </ul>
            
          </li>
        
          <li class="nav-item nav-cta">
            
              <a href="/install/" data-text="Install">Install</a>
            
            
          </li>
        
      </ul>
      <button id="menu-toggle" class="menu-item menu-toggle open" aria-expanded="false" aria-label="Toggle Navigation Menu"></button>
    </nav>
  </div>

  <nav class="mobile-navigation" role="navigation">
    <ul class="mobile-navigation-links">
      
        <li class="nav-item">
          <div class="link-container">
            
              <a href="/getting-started/">Get Started</a>
              

            
          </div>
          
        </li>
      
        <li class="nav-item">
          <div class="link-container">
            
              <a href="/blog/">Blog</a>
              

            
          </div>
          
        </li>
      
        <li class="nav-item">
          <div class="link-container">
            
              <a href="/documentation/">Documentation</a>
              

            
          </div>
          
        </li>
      
        <li class="nav-item">
          <div class="link-container">
            
              <a href="/packages/">Packages</a>
              

            
          </div>
          
        </li>
      
        <li class="nav-item">
          <div class="link-container">
            
              <a href="/tools/">Tools</a>
              

            
          </div>
          
        </li>
      
        <li class="nav-item">
          <div class="link-container">
            
              <a href="/community/">Community</a>
              

            
              <button class="section-toggle" aria-expanded="false" aria-label="Toggle Community Section">
                &#9663;
              </button>
            
          </div>
          
            <ul class="section-menu">
              
                
                  
                    <li>
                  
                    <a href="/community/">Overview</a>
                  </li>
                
              
                
                  
                    <li>
                  
                    <a href="/swift-evolution/">Swift Evolution</a>
                  </li>
                
              
                
                  
                    <li>
                  
                    <a href="/diversity/">Diversity</a>
                  </li>
                
              
                
                  
                    <li>
                  
                    <a href="/mentorship/">Mentorship</a>
                  </li>
                
              
                
                  
                    <li>
                  
                    <a href="/contributing/">Contributing</a>
                  </li>
                
              
                
                  <li class="nav-section">Steering Groups</li>
                
              
                
                  
                    <li>
                  
                    <a href="/language-steering-group/">Language</a>
                  </li>
                
              
                
                  
                    <li>
                  
                    <a href="/platform-steering-group/">Platform</a>
                  </li>
                
              
                
                  <li class="nav-section">Workgroups</li>
                
              
                
                  
                    <li>
                  
                    <a href="/contributor-experience-workgroup/">Contributor Experience</a>
                  </li>
                
              
                
                  
                    <li>
                  
                    <a href="/sswg/">Server</a>
                  </li>
                
              
                
                  
                    <li>
                  
                    <a href="/website/">Website</a>
                  </li>
                
              
                
                  
                    <li>
                  
                    <a href="/cxx-interop-workgroup/">C++ Interoperability</a>
                  </li>
                
              
                
                  
                    <li>
                  
                    <a href="/documentation-workgroup/">Documentation</a>
                  </li>
                
              
                
                  
                    <li>
                  
                    <a href="/foundation-workgroup/">Foundation</a>
                  </li>
                
              
                
                  <li class="nav-section">Governance</li>
                
              
                
                  
                    <li>
                  
                    <a href="/code-of-conduct/">Code of Conduct</a>
                  </li>
                
              
                
                  
                    <li>
                  
                    <a href="/legal/license.html">License</a>
                  </li>
                
              
                
                  
                    <li>
                  
                    <a href="/support/security.html">Security</a>
                  </li>
                
              
            </ul>
          
        </li>
      
        <li class="nav-item">
          <div class="link-container">
            
              <a href="/install/">Install</a>
              

            
          </div>
          
        </li>
      
    </ul>
  </nav>
 </header>

<main role="main">
  <article class="page">
  
    
      <header>
        <h1>Going passwordless with Passkeys</h1>
      </header>
    
  

  <p>In this tutorial we will explore Passkeys. To be more specific, we’ll explore how we can integrate the <a href="https://github.com/swift-server/webauthn-swift">Swift WebAuthn library</a> into a server-side Swift app. The process of registering and authenticating using Passkeys is pretty simple, but requires some back and forth between client and server. Therefore this tutorial is split into two separate parts: Passkey registration and Passkey authentication.</p>

<p>To avoid starting completely from scratch and turning this blog article into a whole book, I prepared a small starter project which you can <a href="https://github.com/brokenhandsio/swift-webauthn-guide">download here</a>.</p>

<p>Today I’ll show you an example implementation for a standalone Passkey login, however it is also possible to integrate webauthn-swift along an existing, password-based, login, for hardware based 2FA.</p>

<p>What are Passkeys? Others already did a good job at explaining this, so why reinvent the wheel? Here is a quote from <a href="https://passkeys.com">passkeys.com</a>:</p>

<blockquote>
  <p>Passkeys are the new standard to authenticate on the web.
Passkeys are a safer and easier replacement for passwords. With passkeys, users can sign in to apps and websites with a biometric sensor (such as a fingerprint or facial recognition), PIN, or pattern, freeing them from having to remember and manage passwords.</p>
</blockquote>

<p>To read more about Passkeys and how they work I recommend the following two resources:</p>

<ul>
  <li>Introduction: <a href="https://webauthn.guide/">https://webauthn.guide</a></li>
  <li>Details: <a href="https://w3c.github.io/webauthn/">https://w3c.github.io/webauthn</a></li>
  <li>Apple Developer Documentation: <a href="https://developer.apple.com/passkeys/">https://developer.apple.com/passkeys</a></li>
</ul>

<h2 id="fundamentals" class="header-with-anchor">Fundamentals <a title="Permalink for Fundamentals section" href="#fundamentals">
            <?xml version="1.0" encoding="utf-8"?> <svg width="24px" height="24px" viewBox="0 0 14 14" role="img" focusable="false" aria-hidden="true" xmlns="http://www.w3.org/2000/svg"><path d="m 11.58824,9.823529 q 0,-0.294117 -0.20589,-0.499999 L 9.85294,7.794118 q -0.20588,-0.205883 -0.5,-0.205883 -0.30882,0 -0.52941,0.235295 0.0221,0.02206 0.13971,0.136029 0.11764,0.113971 0.15808,0.158088 0.0404,0.04412 0.1103,0.139706 0.0698,0.09559 0.0956,0.1875 0.0257,0.09191 0.0257,0.202206 0,0.294117 -0.20588,0.5 -0.20588,0.205882 -0.5,0.205882 -0.1103,0 -0.20221,-0.02573 Q 8.35293,9.301471 8.25733,9.231621 8.16173,9.161771 8.11763,9.121327 8.07353,9.080887 7.95954,8.963238 7.84557,8.845591 7.82351,8.823533 7.58086,9.051474 7.58086,9.360297 q 0,0.294118 0.20588,0.5 l 1.51471,1.522059 q 0.19853,0.19853 0.5,0.19853 0.29412,0 0.5,-0.191177 l 1.08088,-1.073529 q 0.20589,-0.205883 0.20589,-0.492648 z M 6.41912,4.639706 q 0,-0.294118 -0.20588,-0.5 L 4.69853,2.617647 q -0.20588,-0.205882 -0.5,-0.205882 -0.28677,0 -0.5,0.198529 L 2.61765,3.683823 q -0.20589,0.205883 -0.20589,0.492648 0,0.294117 0.20589,0.499999 l 1.52941,1.529412 q 0.19853,0.19853 0.5,0.19853 0.30882,0 0.52941,-0.227942 Q 5.15437,6.15441 5.03676,6.040441 4.91912,5.92647 4.87868,5.882353 4.83828,5.838233 4.76838,5.742647 q -0.0698,-0.09559 -0.0956,-0.1875 -0.0257,-0.09191 -0.0257,-0.202206 0,-0.294117 0.20588,-0.5 0.20588,-0.205882 0.5,-0.205882 0.1103,0 0.20221,0.02573 0.0919,0.02573 0.1875,0.09559 0.0956,0.06985 0.1397,0.110294 0.0441,0.04044 0.15809,0.158089 Q 6.15443,5.154409 6.17649,5.176467 6.41914,4.948526 6.41914,4.639703 z M 13,9.823529 q 0,0.882353 -0.625,1.492647 l -1.08088,1.07353 Q 10.68382,13 9.80147,13 q -0.88971,0 -1.5,-0.625 L 6.78676,10.852941 Q 6.17647,10.242647 6.17647,9.360294 q 0,-0.904412 0.64706,-1.536764 L 6.17647,7.176471 Q 5.54412,7.82353 4.64706,7.82353 q -0.88235,0 -1.5,-0.617648 L 1.617647,5.676471 Q 1,5.058824 1,4.176471 1,3.294118 1.625,2.683824 L 2.70588,1.610294 Q 3.31618,1 4.19853,1 q 0.88971,0 1.5,0.625 l 1.51471,1.522059 q 0.61029,0.610294 0.61029,1.492647 0,0.904412 -0.64706,1.536764 L 7.82353,6.823529 Q 8.45588,6.17647 9.35294,6.17647 q 0.88235,0 1.5,0.617648 l 1.52941,1.529411 Q 13,8.941176 13,9.823529 z"/></svg>
          </a></h2>

<p>Passkeys are integrated into our browsers, which expose a JavaScript API that can be used to trigger the Passkey prompts.</p>

<p><em>Safari Passkey prompt:</em>
<img src="/assets/images/server-guides/safari_passkey_prompt.png" alt="Screenshot of Safari browser prompting for a Passkey" /></p>

<p><em>Another example - 1Password prompt:</em>
<img src="/assets/images/server-guides/1password_passkey_prompt.png" alt="Screenshot of Safari browser prompting for a Passkey through the 1Password extension" /></p>

<p>These two prompts are the result of calling <code class="language-plaintext highlighter-rouge">navigator.credentials.create(...)</code> and <code class="language-plaintext highlighter-rouge">navigator.credentials.get(...)</code>.</p>

<p>To get a better understanding let’s quickly play around with this API. Open <a href="https://swift.org">Swift.org</a> in a new tab, open the developer panel of your browser and switch to the JavaScript console. Create the following variable:</p>

<div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">const</span> <span class="nx">publicKeyCredentialCreationOptions</span> <span class="o">=</span> <span class="p">{</span>
    <span class="na">challenge</span><span class="p">:</span> <span class="nb">Uint8Array</span><span class="p">.</span><span class="k">from</span><span class="p">(</span>
        <span class="dl">"</span><span class="s2">randomStringFromServer</span><span class="dl">"</span><span class="p">,</span> <span class="nx">c</span> <span class="o">=&gt;</span> <span class="nx">c</span><span class="p">.</span><span class="nf">charCodeAt</span><span class="p">(</span><span class="mi">0</span><span class="p">)),</span>
    <span class="na">rp</span><span class="p">:</span> <span class="p">{</span>
        <span class="na">name</span><span class="p">:</span> <span class="dl">"</span><span class="s2">Swift</span><span class="dl">"</span><span class="p">,</span>
        <span class="na">id</span><span class="p">:</span> <span class="dl">"</span><span class="s2">swift.org</span><span class="dl">"</span><span class="p">,</span>
    <span class="p">},</span>
    <span class="na">user</span><span class="p">:</span> <span class="p">{</span>
        <span class="na">id</span><span class="p">:</span> <span class="nb">Uint8Array</span><span class="p">.</span><span class="k">from</span><span class="p">(</span>
            <span class="dl">"</span><span class="s2">UZSL85T9AFC</span><span class="dl">"</span><span class="p">,</span> <span class="nx">c</span> <span class="o">=&gt;</span> <span class="nx">c</span><span class="p">.</span><span class="nf">charCodeAt</span><span class="p">(</span><span class="mi">0</span><span class="p">)),</span>
        <span class="na">name</span><span class="p">:</span> <span class="dl">"</span><span class="s2">me@example.com</span><span class="dl">"</span><span class="p">,</span>
        <span class="na">displayName</span><span class="p">:</span> <span class="dl">"</span><span class="s2">FooBar</span><span class="dl">"</span><span class="p">,</span>
    <span class="p">},</span>
    <span class="na">pubKeyCredParams</span><span class="p">:</span> <span class="p">[{</span><span class="na">alg</span><span class="p">:</span> <span class="o">-</span><span class="mi">7</span><span class="p">,</span> <span class="na">type</span><span class="p">:</span> <span class="dl">"</span><span class="s2">public-key</span><span class="dl">"</span><span class="p">}],</span>
    <span class="na">authenticatorSelection</span><span class="p">:</span> <span class="p">{</span>
        <span class="na">authenticatorAttachment</span><span class="p">:</span> <span class="dl">"</span><span class="s2">cross-platform</span><span class="dl">"</span><span class="p">,</span>
    <span class="p">},</span>
    <span class="na">timeout</span><span class="p">:</span> <span class="mi">60000</span><span class="p">,</span>
    <span class="na">attestation</span><span class="p">:</span> <span class="dl">"</span><span class="s2">direct</span><span class="dl">"</span>
<span class="p">};</span>
</code></pre></div></div>

<p>Don’t worry, you don’t have to understand the content. In fact the Swift WebAuthn library will create this for you automatically. Now calling the Passkeys API with our newly created <code class="language-plaintext highlighter-rouge">publicKeyCredentialCreationOptions</code> will prompt you to create a new Passkey:</p>

<div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">const</span> <span class="nx">credential</span> <span class="o">=</span> <span class="k">await</span> <span class="nb">navigator</span><span class="p">.</span><span class="nx">credentials</span><span class="p">.</span><span class="nf">create</span><span class="p">({</span>
    <span class="na">publicKey</span><span class="p">:</span> <span class="nx">publicKeyCredentialCreationOptions</span>
<span class="p">});</span>
</code></pre></div></div>

<h2 id="act-1---setup" class="header-with-anchor">Act 1 - Setup <a title="Permalink for Act 1 - Setup section" href="#act-1---setup">
            <?xml version="1.0" encoding="utf-8"?> <svg width="24px" height="24px" viewBox="0 0 14 14" role="img" focusable="false" aria-hidden="true" xmlns="http://www.w3.org/2000/svg"><path d="m 11.58824,9.823529 q 0,-0.294117 -0.20589,-0.499999 L 9.85294,7.794118 q -0.20588,-0.205883 -0.5,-0.205883 -0.30882,0 -0.52941,0.235295 0.0221,0.02206 0.13971,0.136029 0.11764,0.113971 0.15808,0.158088 0.0404,0.04412 0.1103,0.139706 0.0698,0.09559 0.0956,0.1875 0.0257,0.09191 0.0257,0.202206 0,0.294117 -0.20588,0.5 -0.20588,0.205882 -0.5,0.205882 -0.1103,0 -0.20221,-0.02573 Q 8.35293,9.301471 8.25733,9.231621 8.16173,9.161771 8.11763,9.121327 8.07353,9.080887 7.95954,8.963238 7.84557,8.845591 7.82351,8.823533 7.58086,9.051474 7.58086,9.360297 q 0,0.294118 0.20588,0.5 l 1.51471,1.522059 q 0.19853,0.19853 0.5,0.19853 0.29412,0 0.5,-0.191177 l 1.08088,-1.073529 q 0.20589,-0.205883 0.20589,-0.492648 z M 6.41912,4.639706 q 0,-0.294118 -0.20588,-0.5 L 4.69853,2.617647 q -0.20588,-0.205882 -0.5,-0.205882 -0.28677,0 -0.5,0.198529 L 2.61765,3.683823 q -0.20589,0.205883 -0.20589,0.492648 0,0.294117 0.20589,0.499999 l 1.52941,1.529412 q 0.19853,0.19853 0.5,0.19853 0.30882,0 0.52941,-0.227942 Q 5.15437,6.15441 5.03676,6.040441 4.91912,5.92647 4.87868,5.882353 4.83828,5.838233 4.76838,5.742647 q -0.0698,-0.09559 -0.0956,-0.1875 -0.0257,-0.09191 -0.0257,-0.202206 0,-0.294117 0.20588,-0.5 0.20588,-0.205882 0.5,-0.205882 0.1103,0 0.20221,0.02573 0.0919,0.02573 0.1875,0.09559 0.0956,0.06985 0.1397,0.110294 0.0441,0.04044 0.15809,0.158089 Q 6.15443,5.154409 6.17649,5.176467 6.41914,4.948526 6.41914,4.639703 z M 13,9.823529 q 0,0.882353 -0.625,1.492647 l -1.08088,1.07353 Q 10.68382,13 9.80147,13 q -0.88971,0 -1.5,-0.625 L 6.78676,10.852941 Q 6.17647,10.242647 6.17647,9.360294 q 0,-0.904412 0.64706,-1.536764 L 6.17647,7.176471 Q 5.54412,7.82353 4.64706,7.82353 q -0.88235,0 -1.5,-0.617648 L 1.617647,5.676471 Q 1,5.058824 1,4.176471 1,3.294118 1.625,2.683824 L 2.70588,1.610294 Q 3.31618,1 4.19853,1 q 0.88971,0 1.5,0.625 l 1.51471,1.522059 q 0.61029,0.610294 0.61029,1.492647 0,0.904412 -0.64706,1.536764 L 7.82353,6.823529 Q 8.45588,6.17647 9.35294,6.17647 q 0.88235,0 1.5,0.617648 l 1.52941,1.529411 Q 13,8.941176 13,9.823529 z"/></svg>
          </a></h2>

<h3 id="setting-up-the-relying-party" class="header-with-anchor">Setting up the Relying Party <a title="Permalink for Setting up the Relying Party section" href="#setting-up-the-relying-party">
            <?xml version="1.0" encoding="utf-8"?> <svg width="24px" height="24px" viewBox="0 0 14 14" role="img" focusable="false" aria-hidden="true" xmlns="http://www.w3.org/2000/svg"><path d="m 11.58824,9.823529 q 0,-0.294117 -0.20589,-0.499999 L 9.85294,7.794118 q -0.20588,-0.205883 -0.5,-0.205883 -0.30882,0 -0.52941,0.235295 0.0221,0.02206 0.13971,0.136029 0.11764,0.113971 0.15808,0.158088 0.0404,0.04412 0.1103,0.139706 0.0698,0.09559 0.0956,0.1875 0.0257,0.09191 0.0257,0.202206 0,0.294117 -0.20588,0.5 -0.20588,0.205882 -0.5,0.205882 -0.1103,0 -0.20221,-0.02573 Q 8.35293,9.301471 8.25733,9.231621 8.16173,9.161771 8.11763,9.121327 8.07353,9.080887 7.95954,8.963238 7.84557,8.845591 7.82351,8.823533 7.58086,9.051474 7.58086,9.360297 q 0,0.294118 0.20588,0.5 l 1.51471,1.522059 q 0.19853,0.19853 0.5,0.19853 0.29412,0 0.5,-0.191177 l 1.08088,-1.073529 q 0.20589,-0.205883 0.20589,-0.492648 z M 6.41912,4.639706 q 0,-0.294118 -0.20588,-0.5 L 4.69853,2.617647 q -0.20588,-0.205882 -0.5,-0.205882 -0.28677,0 -0.5,0.198529 L 2.61765,3.683823 q -0.20589,0.205883 -0.20589,0.492648 0,0.294117 0.20589,0.499999 l 1.52941,1.529412 q 0.19853,0.19853 0.5,0.19853 0.30882,0 0.52941,-0.227942 Q 5.15437,6.15441 5.03676,6.040441 4.91912,5.92647 4.87868,5.882353 4.83828,5.838233 4.76838,5.742647 q -0.0698,-0.09559 -0.0956,-0.1875 -0.0257,-0.09191 -0.0257,-0.202206 0,-0.294117 0.20588,-0.5 0.20588,-0.205882 0.5,-0.205882 0.1103,0 0.20221,0.02573 0.0919,0.02573 0.1875,0.09559 0.0956,0.06985 0.1397,0.110294 0.0441,0.04044 0.15809,0.158089 Q 6.15443,5.154409 6.17649,5.176467 6.41914,4.948526 6.41914,4.639703 z M 13,9.823529 q 0,0.882353 -0.625,1.492647 l -1.08088,1.07353 Q 10.68382,13 9.80147,13 q -0.88971,0 -1.5,-0.625 L 6.78676,10.852941 Q 6.17647,10.242647 6.17647,9.360294 q 0,-0.904412 0.64706,-1.536764 L 6.17647,7.176471 Q 5.54412,7.82353 4.64706,7.82353 q -0.88235,0 -1.5,-0.617648 L 1.617647,5.676471 Q 1,5.058824 1,4.176471 1,3.294118 1.625,2.683824 L 2.70588,1.610294 Q 3.31618,1 4.19853,1 q 0.88971,0 1.5,0.625 l 1.51471,1.522059 q 0.61029,0.610294 0.61029,1.492647 0,0.904412 -0.64706,1.536764 L 7.82353,6.823529 Q 8.45588,6.17647 9.35294,6.17647 q 0.88235,0 1.5,0.617648 l 1.52941,1.529411 Q 13,8.941176 13,9.823529 z"/></svg>
          </a></h3>

<p>If you haven’t already downloaded the <a href="https://github.com/brokenhandsio/swift-webauthn-guide">demo project</a>, you should do so now. There’s a <code class="language-plaintext highlighter-rouge">starter</code> and <code class="language-plaintext highlighter-rouge">final</code> project. Open the starter project and add the Swift WebAuthn library to your <code class="language-plaintext highlighter-rouge">Package.swift</code>:</p>

<div class="language-swift highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">dependencies</span><span class="p">:</span> <span class="p">[</span>
    <span class="c1">// ...</span>
    <span class="o">.</span><span class="nf">package</span><span class="p">(</span><span class="nv">url</span><span class="p">:</span> <span class="s">"https://github.com/swift-server/webauthn-swift.git"</span><span class="p">,</span> <span class="nv">from</span><span class="p">:</span> <span class="s">"1.0.0-alpha"</span><span class="p">)</span>
<span class="p">],</span>

<span class="c1">// ...</span>

<span class="nv">targets</span><span class="p">:</span> <span class="p">[</span>
    <span class="o">.</span><span class="nf">target</span><span class="p">(</span>
        <span class="nv">name</span><span class="p">:</span> <span class="s">"App"</span><span class="p">,</span>
        <span class="nv">dependencies</span><span class="p">:</span> <span class="p">[</span>
            <span class="c1">// ...</span>
            <span class="o">.</span><span class="nf">product</span><span class="p">(</span><span class="nv">name</span><span class="p">:</span> <span class="s">"WebAuthn"</span><span class="p">,</span> <span class="nv">package</span><span class="p">:</span> <span class="s">"webauthn-swift"</span><span class="p">)</span>
<span class="c1">// ...</span>
<span class="p">]</span>
</code></pre></div></div>

<p>First, you need to create an instance of <code class="language-plaintext highlighter-rouge">WebAuthnManager</code>, the core of the Swift WebAuthn library. The WebAuthn library works with any server-side Swift framework, but we’ll use Vapor for this tutorial. With Vapor, you could extend <code class="language-plaintext highlighter-rouge">Request</code> with a <code class="language-plaintext highlighter-rouge">webAuthn</code> property which allows us to easily access it in the route handlers. Add this in a new file called <code class="language-plaintext highlighter-rouge">Request+webAuthn.swift</code>:</p>

<div class="language-swift highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">import</span> <span class="kt">Vapor</span>
<span class="kd">import</span> <span class="kt">WebAuthn</span>

<span class="kd">extension</span> <span class="kt">Request</span> <span class="p">{</span>
    <span class="k">var</span> <span class="nv">webAuthn</span><span class="p">:</span> <span class="kt">WebAuthnManager</span> <span class="p">{</span>
        <span class="kt">WebAuthnManager</span><span class="p">(</span>
            <span class="nv">config</span><span class="p">:</span> <span class="kt">WebAuthnManager</span><span class="o">.</span><span class="kt">Config</span><span class="p">(</span>
                <span class="c1">// 1</span>
                <span class="nv">relyingPartyID</span><span class="p">:</span> <span class="s">"localhost"</span><span class="p">,</span>
                <span class="c1">// 2</span>
                <span class="nv">relyingPartyName</span><span class="p">:</span> <span class="s">"Vapor Passkey Tutorial"</span><span class="p">,</span>
                <span class="c1">// 3</span>
                <span class="nv">relyingPartyOrigin</span><span class="p">:</span> <span class="s">"http://localhost:8080"</span>
            <span class="p">)</span>
        <span class="p">)</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div>

<p>Here we configure 3 things:</p>
<ol>
  <li>The <code class="language-plaintext highlighter-rouge">relyingPartyID</code> identifies your app based solely on the domain (not the scheme, port, or path) it can be accessed on. All created Passkeys will be scoped to this identifier. That means a Passkey created at <code class="language-plaintext highlighter-rouge">example.org</code> can only be used on the same domain. Specifying a subdomain like <code class="language-plaintext highlighter-rouge">auth.example.org</code> will also allow Passkeys from e.g. <code class="language-plaintext highlighter-rouge">dev.auth.example.org</code>, but not <code class="language-plaintext highlighter-rouge">login.example.org</code>. This prevents other websites from talking to random Passkeys. However this also means if you want to change your domain at some point all users need to re-create their Passkeys!</li>
  <li>The <code class="language-plaintext highlighter-rouge">relyingPartyName</code> is just a friendly name shown to the user when registering or logging in.</li>
  <li>The <code class="language-plaintext highlighter-rouge">relyingPartyOrigin</code> works similar to the relying party id, but <a href="https://w3c.github.io/webauthn/#sctn-validating-origin">serves as an additional layer of protection</a>. Here we need to specify the whole origin. In our case it’s the scheme <code class="language-plaintext highlighter-rouge">https://</code> + the relying party id + the port <code class="language-plaintext highlighter-rouge">:8080</code></li>
</ol>

<p>🚨 It is important that you run your app on <code class="language-plaintext highlighter-rouge">localhost</code> and not on <code class="language-plaintext highlighter-rouge">127.0.0.1</code> since <em>some</em> WebAuthn browser implementations, password managers and authenticators only work with “valid” domains. With Vapor you can achieve this by using <code class="language-plaintext highlighter-rouge">--hostname localhost</code>:</p>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>swift run App serve <span class="nt">--hostname</span> localhost
</code></pre></div></div>

<p>Great, that’s everything we need to get started.</p>

<h2 id="act-2---registration" class="header-with-anchor">Act 2 - Registration <a title="Permalink for Act 2 - Registration section" href="#act-2---registration">
            <?xml version="1.0" encoding="utf-8"?> <svg width="24px" height="24px" viewBox="0 0 14 14" role="img" focusable="false" aria-hidden="true" xmlns="http://www.w3.org/2000/svg"><path d="m 11.58824,9.823529 q 0,-0.294117 -0.20589,-0.499999 L 9.85294,7.794118 q -0.20588,-0.205883 -0.5,-0.205883 -0.30882,0 -0.52941,0.235295 0.0221,0.02206 0.13971,0.136029 0.11764,0.113971 0.15808,0.158088 0.0404,0.04412 0.1103,0.139706 0.0698,0.09559 0.0956,0.1875 0.0257,0.09191 0.0257,0.202206 0,0.294117 -0.20588,0.5 -0.20588,0.205882 -0.5,0.205882 -0.1103,0 -0.20221,-0.02573 Q 8.35293,9.301471 8.25733,9.231621 8.16173,9.161771 8.11763,9.121327 8.07353,9.080887 7.95954,8.963238 7.84557,8.845591 7.82351,8.823533 7.58086,9.051474 7.58086,9.360297 q 0,0.294118 0.20588,0.5 l 1.51471,1.522059 q 0.19853,0.19853 0.5,0.19853 0.29412,0 0.5,-0.191177 l 1.08088,-1.073529 q 0.20589,-0.205883 0.20589,-0.492648 z M 6.41912,4.639706 q 0,-0.294118 -0.20588,-0.5 L 4.69853,2.617647 q -0.20588,-0.205882 -0.5,-0.205882 -0.28677,0 -0.5,0.198529 L 2.61765,3.683823 q -0.20589,0.205883 -0.20589,0.492648 0,0.294117 0.20589,0.499999 l 1.52941,1.529412 q 0.19853,0.19853 0.5,0.19853 0.30882,0 0.52941,-0.227942 Q 5.15437,6.15441 5.03676,6.040441 4.91912,5.92647 4.87868,5.882353 4.83828,5.838233 4.76838,5.742647 q -0.0698,-0.09559 -0.0956,-0.1875 -0.0257,-0.09191 -0.0257,-0.202206 0,-0.294117 0.20588,-0.5 0.20588,-0.205882 0.5,-0.205882 0.1103,0 0.20221,0.02573 0.0919,0.02573 0.1875,0.09559 0.0956,0.06985 0.1397,0.110294 0.0441,0.04044 0.15809,0.158089 Q 6.15443,5.154409 6.17649,5.176467 6.41914,4.948526 6.41914,4.639703 z M 13,9.823529 q 0,0.882353 -0.625,1.492647 l -1.08088,1.07353 Q 10.68382,13 9.80147,13 q -0.88971,0 -1.5,-0.625 L 6.78676,10.852941 Q 6.17647,10.242647 6.17647,9.360294 q 0,-0.904412 0.64706,-1.536764 L 6.17647,7.176471 Q 5.54412,7.82353 4.64706,7.82353 q -0.88235,0 -1.5,-0.617648 L 1.617647,5.676471 Q 1,5.058824 1,4.176471 1,3.294118 1.625,2.683824 L 2.70588,1.610294 Q 3.31618,1 4.19853,1 q 0.88971,0 1.5,0.625 l 1.51471,1.522059 q 0.61029,0.610294 0.61029,1.492647 0,0.904412 -0.64706,1.536764 L 7.82353,6.823529 Q 8.45588,6.17647 9.35294,6.17647 q 0.88235,0 1.5,0.617648 l 1.52941,1.529411 Q 13,8.941176 13,9.823529 z"/></svg>
          </a></h2>

<p>From the UI perspective we only need three components: Two buttons and a text field for entering a username! No password field needed… that’s why we’re here after all! Let’s start with building a quick registration form in HTML. Insert the following form into <code class="language-plaintext highlighter-rouge">Resources/Views/index.leaf</code> just after <code class="language-plaintext highlighter-rouge">&lt;!-- Form --&gt;</code>:</p>

<div class="language-html highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nt">&lt;form</span> <span class="na">id=</span><span class="s">"registerForm"</span><span class="nt">&gt;</span>
    <span class="nt">&lt;input</span> <span class="na">id=</span><span class="s">"username"</span> <span class="na">type=</span><span class="s">"text"</span> <span class="nt">/&gt;</span>
    <span class="nt">&lt;button</span> <span class="na">type=</span><span class="s">"submit"</span><span class="nt">&gt;</span>Register<span class="nt">&lt;/button&gt;</span>
<span class="nt">&lt;/form&gt;</span>
</code></pre></div></div>

<p>The app should now return you a blank HTML form at http://localhost:8080/.</p>

<h3 id="planning-ahead" class="header-with-anchor">Planning ahead <a title="Permalink for Planning ahead section" href="#planning-ahead">
            <?xml version="1.0" encoding="utf-8"?> <svg width="24px" height="24px" viewBox="0 0 14 14" role="img" focusable="false" aria-hidden="true" xmlns="http://www.w3.org/2000/svg"><path d="m 11.58824,9.823529 q 0,-0.294117 -0.20589,-0.499999 L 9.85294,7.794118 q -0.20588,-0.205883 -0.5,-0.205883 -0.30882,0 -0.52941,0.235295 0.0221,0.02206 0.13971,0.136029 0.11764,0.113971 0.15808,0.158088 0.0404,0.04412 0.1103,0.139706 0.0698,0.09559 0.0956,0.1875 0.0257,0.09191 0.0257,0.202206 0,0.294117 -0.20588,0.5 -0.20588,0.205882 -0.5,0.205882 -0.1103,0 -0.20221,-0.02573 Q 8.35293,9.301471 8.25733,9.231621 8.16173,9.161771 8.11763,9.121327 8.07353,9.080887 7.95954,8.963238 7.84557,8.845591 7.82351,8.823533 7.58086,9.051474 7.58086,9.360297 q 0,0.294118 0.20588,0.5 l 1.51471,1.522059 q 0.19853,0.19853 0.5,0.19853 0.29412,0 0.5,-0.191177 l 1.08088,-1.073529 q 0.20589,-0.205883 0.20589,-0.492648 z M 6.41912,4.639706 q 0,-0.294118 -0.20588,-0.5 L 4.69853,2.617647 q -0.20588,-0.205882 -0.5,-0.205882 -0.28677,0 -0.5,0.198529 L 2.61765,3.683823 q -0.20589,0.205883 -0.20589,0.492648 0,0.294117 0.20589,0.499999 l 1.52941,1.529412 q 0.19853,0.19853 0.5,0.19853 0.30882,0 0.52941,-0.227942 Q 5.15437,6.15441 5.03676,6.040441 4.91912,5.92647 4.87868,5.882353 4.83828,5.838233 4.76838,5.742647 q -0.0698,-0.09559 -0.0956,-0.1875 -0.0257,-0.09191 -0.0257,-0.202206 0,-0.294117 0.20588,-0.5 0.20588,-0.205882 0.5,-0.205882 0.1103,0 0.20221,0.02573 0.0919,0.02573 0.1875,0.09559 0.0956,0.06985 0.1397,0.110294 0.0441,0.04044 0.15809,0.158089 Q 6.15443,5.154409 6.17649,5.176467 6.41914,4.948526 6.41914,4.639703 z M 13,9.823529 q 0,0.882353 -0.625,1.492647 l -1.08088,1.07353 Q 10.68382,13 9.80147,13 q -0.88971,0 -1.5,-0.625 L 6.78676,10.852941 Q 6.17647,10.242647 6.17647,9.360294 q 0,-0.904412 0.64706,-1.536764 L 6.17647,7.176471 Q 5.54412,7.82353 4.64706,7.82353 q -0.88235,0 -1.5,-0.617648 L 1.617647,5.676471 Q 1,5.058824 1,4.176471 1,3.294118 1.625,2.683824 L 2.70588,1.610294 Q 3.31618,1 4.19853,1 q 0.88971,0 1.5,0.625 l 1.51471,1.522059 q 0.61029,0.610294 0.61029,1.492647 0,0.904412 -0.64706,1.536764 L 7.82353,6.823529 Q 8.45588,6.17647 9.35294,6.17647 q 0.88235,0 1.5,0.617648 l 1.52941,1.529411 Q 13,8.941176 13,9.823529 z"/></svg>
          </a></h3>

<p>Before we jump into the business logic let’s write down what we need:</p>
<ol>
  <li>When a user clicks the “Register” button we will notify our server about a new registration attempt.</li>
  <li>The server will put together a few pieces of information and send these back to the client (the browser).</li>
  <li>The client will take this information and pass it into the <code class="language-plaintext highlighter-rouge">create(parseCreationOptionsFromJSON(...))</code> JavaScript function which will trigger the Passkey prompt. The returned value of this function is our brand new Passkey! Great!</li>
  <li>Finally we send our new Passkey back to the server, verify it and persist it in a database.</li>
</ol>

<p>It sounds like a lot of work, but it’s actually pretty simple.</p>

<h3 id="bringing-form-to-life" class="header-with-anchor">Bringing <code class="language-plaintext highlighter-rouge">&lt;form&gt;</code> to life <a title="Permalink for Bringing <code class="language-plaintext highlighter-rouge">&lt;form&gt;</code> to life section" href="#bringing-form-to-life">
            <?xml version="1.0" encoding="utf-8"?> <svg width="24px" height="24px" viewBox="0 0 14 14" role="img" focusable="false" aria-hidden="true" xmlns="http://www.w3.org/2000/svg"><path d="m 11.58824,9.823529 q 0,-0.294117 -0.20589,-0.499999 L 9.85294,7.794118 q -0.20588,-0.205883 -0.5,-0.205883 -0.30882,0 -0.52941,0.235295 0.0221,0.02206 0.13971,0.136029 0.11764,0.113971 0.15808,0.158088 0.0404,0.04412 0.1103,0.139706 0.0698,0.09559 0.0956,0.1875 0.0257,0.09191 0.0257,0.202206 0,0.294117 -0.20588,0.5 -0.20588,0.205882 -0.5,0.205882 -0.1103,0 -0.20221,-0.02573 Q 8.35293,9.301471 8.25733,9.231621 8.16173,9.161771 8.11763,9.121327 8.07353,9.080887 7.95954,8.963238 7.84557,8.845591 7.82351,8.823533 7.58086,9.051474 7.58086,9.360297 q 0,0.294118 0.20588,0.5 l 1.51471,1.522059 q 0.19853,0.19853 0.5,0.19853 0.29412,0 0.5,-0.191177 l 1.08088,-1.073529 q 0.20589,-0.205883 0.20589,-0.492648 z M 6.41912,4.639706 q 0,-0.294118 -0.20588,-0.5 L 4.69853,2.617647 q -0.20588,-0.205882 -0.5,-0.205882 -0.28677,0 -0.5,0.198529 L 2.61765,3.683823 q -0.20589,0.205883 -0.20589,0.492648 0,0.294117 0.20589,0.499999 l 1.52941,1.529412 q 0.19853,0.19853 0.5,0.19853 0.30882,0 0.52941,-0.227942 Q 5.15437,6.15441 5.03676,6.040441 4.91912,5.92647 4.87868,5.882353 4.83828,5.838233 4.76838,5.742647 q -0.0698,-0.09559 -0.0956,-0.1875 -0.0257,-0.09191 -0.0257,-0.202206 0,-0.294117 0.20588,-0.5 0.20588,-0.205882 0.5,-0.205882 0.1103,0 0.20221,0.02573 0.0919,0.02573 0.1875,0.09559 0.0956,0.06985 0.1397,0.110294 0.0441,0.04044 0.15809,0.158089 Q 6.15443,5.154409 6.17649,5.176467 6.41914,4.948526 6.41914,4.639703 z M 13,9.823529 q 0,0.882353 -0.625,1.492647 l -1.08088,1.07353 Q 10.68382,13 9.80147,13 q -0.88971,0 -1.5,-0.625 L 6.78676,10.852941 Q 6.17647,10.242647 6.17647,9.360294 q 0,-0.904412 0.64706,-1.536764 L 6.17647,7.176471 Q 5.54412,7.82353 4.64706,7.82353 q -0.88235,0 -1.5,-0.617648 L 1.617647,5.676471 Q 1,5.058824 1,4.176471 1,3.294118 1.625,2.683824 L 2.70588,1.610294 Q 3.31618,1 4.19853,1 q 0.88971,0 1.5,0.625 l 1.51471,1.522059 q 0.61029,0.610294 0.61029,1.492647 0,0.904412 -0.64706,1.536764 L 7.82353,6.823529 Q 8.45588,6.17647 9.35294,6.17647 q 0.88235,0 1.5,0.617648 l 1.52941,1.529411 Q 13,8.941176 13,9.823529 z"/></svg>
          </a></h3>

<p>Alright let’s start with step one. Add this after the closing <code class="language-plaintext highlighter-rouge">&lt;/form&gt;</code> tag from the previous step:</p>

<div class="language-html highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nt">&lt;script </span><span class="na">type=</span><span class="s">"module"</span><span class="nt">&gt;</span>
  <span class="c1">// import WebAuthn wrapper</span>
  <span class="k">import</span> <span class="p">{</span> <span class="nx">create</span><span class="p">,</span> <span class="nx">parseCreationOptionsFromJSON</span> <span class="p">}</span> <span class="k">from</span> <span class="dl">'</span><span class="s1">https://cdn.jsdelivr.net/npm/@github/webauthn-json@2.1.1/dist/esm/webauthn-json.browser-ponyfill.js</span><span class="dl">'</span><span class="p">;</span>

  <span class="c1">// Get a reference to our registration form</span>
  <span class="kd">const</span> <span class="nx">registerForm</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nf">getElementById</span><span class="p">(</span><span class="dl">"</span><span class="s2">registerForm</span><span class="dl">"</span><span class="p">);</span>

  <span class="c1">// Listen for the form's "submit" event</span>
  <span class="nx">registerForm</span><span class="p">.</span><span class="nf">addEventListener</span><span class="p">(</span><span class="dl">"</span><span class="s2">submit</span><span class="dl">"</span><span class="p">,</span> <span class="k">async</span> <span class="kd">function</span><span class="p">(</span><span class="nx">event</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">event</span><span class="p">.</span><span class="nf">preventDefault</span><span class="p">();</span>

    <span class="c1">// Get the username</span>
    <span class="kd">const</span> <span class="nx">username</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nf">getElementById</span><span class="p">(</span><span class="dl">"</span><span class="s2">username</span><span class="dl">"</span><span class="p">).</span><span class="nx">value</span><span class="p">;</span>

    <span class="c1">// Send request to server</span>
    <span class="kd">const</span> <span class="nx">registerResponse</span> <span class="o">=</span> <span class="k">await</span> <span class="nf">fetch</span><span class="p">(</span><span class="dl">'</span><span class="s1">/register?username=</span><span class="dl">'</span> <span class="o">+</span> <span class="nx">username</span><span class="p">);</span>

    <span class="c1">// Parse response as json and pass into wrapped WebAuthn API</span>
    <span class="kd">const</span> <span class="nx">registerResponseJSON</span> <span class="o">=</span> <span class="k">await</span> <span class="nx">registerResponse</span><span class="p">.</span><span class="nf">json</span><span class="p">();</span>
    <span class="kd">const</span> <span class="nx">passkey</span> <span class="o">=</span> <span class="k">await</span> <span class="nf">create</span><span class="p">(</span><span class="nf">parseCreationOptionsFromJSON</span><span class="p">(</span><span class="nx">registerResponseJSON</span><span class="p">));</span>
  <span class="p">});</span>
<span class="nt">&lt;/script&gt;</span>
</code></pre></div></div>

<p>First we add a third-party script developed by GitHub which adds user-friendly wrappers on top of the original WebAuthn APIs <code class="language-plaintext highlighter-rouge">navigator.credentials.create</code> and <code class="language-plaintext highlighter-rouge">navigator.credentials.get</code>. This is just for convenience and not mandatory! If you don’t want to use it you’ll have to deserialise some of the <code class="language-plaintext highlighter-rouge">registrationOptions</code> properties since the original API expects a few “raw” byte arrays. Using the wrapper we can simply pass in the JSON response from our server — neat! The official WebAuthn API will <a href="https://w3c.github.io/webauthn/#sctn-parseCreationOptionsFromJSON">support this out of the box at some point</a>, but for now we depend on GitHub’s “webauthn-json” library.</p>

<p>Our script will listen for the form’s <code class="language-plaintext highlighter-rouge">submit</code> event. On submit it sends a <code class="language-plaintext highlighter-rouge">/register</code> request to our backend and passes the JSON response to <code class="language-plaintext highlighter-rouge">create(parseCreationOptionsFromJSON(...))</code> thus triggering the browsers Passkey prompt.</p>

<p>If the user successfully responds to the prompt we’ll get a brand new passkey in <code class="language-plaintext highlighter-rouge">const passkey</code>. Later we will send this passkey to our server and verify it. On the server side of things we still need to add the endpoint we just called in the JavaScript code. In a Vapor app you’d have to register a new route in <code class="language-plaintext highlighter-rouge">routes.swift</code>:</p>

<div class="language-swift highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">app</span><span class="o">.</span><span class="nf">get</span><span class="p">(</span><span class="s">"register"</span><span class="p">)</span> <span class="p">{</span> <span class="n">req</span> <span class="k">in</span>
    <span class="c1">// Create and login user</span>
    <span class="k">let</span> <span class="nv">username</span> <span class="o">=</span> <span class="k">try</span> <span class="n">req</span><span class="o">.</span><span class="n">query</span><span class="o">.</span><span class="nf">get</span><span class="p">(</span><span class="kt">String</span><span class="o">.</span><span class="k">self</span><span class="p">,</span> <span class="nv">at</span><span class="p">:</span> <span class="s">"username"</span><span class="p">)</span>
    <span class="k">let</span> <span class="nv">user</span> <span class="o">=</span> <span class="kt">User</span><span class="p">(</span><span class="nv">username</span><span class="p">:</span> <span class="n">username</span><span class="p">)</span>
    <span class="k">try</span> <span class="k">await</span> <span class="n">user</span><span class="o">.</span><span class="nf">create</span><span class="p">(</span><span class="nv">on</span><span class="p">:</span> <span class="n">req</span><span class="o">.</span><span class="n">db</span><span class="p">)</span>
    <span class="n">req</span><span class="o">.</span><span class="n">auth</span><span class="o">.</span><span class="nf">login</span><span class="p">(</span><span class="n">user</span><span class="p">)</span>

    <span class="c1">// Generate registration options</span>
    <span class="k">let</span> <span class="nv">options</span> <span class="o">=</span> <span class="n">req</span><span class="o">.</span><span class="n">webAuthn</span><span class="o">.</span><span class="nf">beginRegistration</span><span class="p">(</span><span class="nv">user</span><span class="p">:</span>
        <span class="o">.</span><span class="nf">init</span><span class="p">(</span>
            <span class="nv">id</span><span class="p">:</span> <span class="k">try</span> <span class="p">[</span><span class="kt">UInt8</span><span class="p">](</span><span class="n">user</span><span class="o">.</span><span class="nf">requireID</span><span class="p">()</span><span class="o">.</span><span class="n">uuidString</span><span class="o">.</span><span class="n">utf8</span><span class="p">),</span>
            <span class="nv">name</span><span class="p">:</span> <span class="n">user</span><span class="o">.</span><span class="n">username</span><span class="p">,</span>
            <span class="nv">displayName</span><span class="p">:</span> <span class="n">user</span><span class="o">.</span><span class="n">username</span>
        <span class="p">)</span>
    <span class="p">)</span>

    <span class="c1">// Also pass along challenge because we need it later</span>
    <span class="n">req</span><span class="o">.</span><span class="n">session</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s">"registrationChallenge"</span><span class="p">]</span> <span class="o">=</span> <span class="kt">Data</span><span class="p">(</span><span class="n">options</span><span class="o">.</span><span class="n">challenge</span><span class="p">)</span><span class="o">.</span><span class="nf">base64EncodedString</span><span class="p">()</span>

    <span class="k">return</span> <span class="kt">CreateCredentialOptions</span><span class="p">(</span><span class="nv">publicKey</span><span class="p">:</span> <span class="n">options</span><span class="p">)</span>
<span class="p">}</span>
</code></pre></div></div>

<p>On <code class="language-plaintext highlighter-rouge">/register</code> this creates a new user and calls the <code class="language-plaintext highlighter-rouge">beginRegistration</code> function with the newly created user. This will give us a set of options which we send back to the client. Additionally we store the challenge in a cookie because we’ll need it later when verifying the new Passkey. If you inspect the returned options you’ll notice that these are the options you manually entered in your browser’s JavaScript console at the beginning of this blog post!</p>

<p>The WebAuthn API expects the options inside a property named <code class="language-plaintext highlighter-rouge">publicKey</code>. That’s why we return an instance of <code class="language-plaintext highlighter-rouge">CreateCredentialOptions</code> — a type which doesn’t exist yet. So let’s create and conform it to <code class="language-plaintext highlighter-rouge">AsyncResponseEncodable</code> so we can easily return it an a Vapor route handler:</p>

<div class="language-swift highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">struct</span> <span class="kt">CreateCredentialOptions</span><span class="p">:</span> <span class="kt">Encodable</span><span class="p">,</span> <span class="kt">AsyncResponseEncodable</span> <span class="p">{</span>
    <span class="k">let</span> <span class="nv">publicKey</span><span class="p">:</span> <span class="kt">PublicKeyCredentialCreationOptions</span>

    <span class="kd">func</span> <span class="nf">encodeResponse</span><span class="p">(</span><span class="k">for</span> <span class="nv">request</span><span class="p">:</span> <span class="kt">Request</span><span class="p">)</span> <span class="k">async</span> <span class="k">throws</span> <span class="o">-&gt;</span> <span class="kt">Response</span> <span class="p">{</span>
        <span class="k">var</span> <span class="nv">headers</span> <span class="o">=</span> <span class="kt">HTTPHeaders</span><span class="p">()</span>
        <span class="n">headers</span><span class="o">.</span><span class="n">contentType</span> <span class="o">=</span> <span class="o">.</span><span class="n">json</span>
        <span class="k">return</span> <span class="k">try</span> <span class="kt">Response</span><span class="p">(</span><span class="nv">status</span><span class="p">:</span> <span class="o">.</span><span class="n">ok</span><span class="p">,</span> <span class="nv">headers</span><span class="p">:</span> <span class="n">headers</span><span class="p">,</span> <span class="nv">body</span><span class="p">:</span> <span class="o">.</span><span class="nf">init</span><span class="p">(</span><span class="nv">data</span><span class="p">:</span> <span class="kt">JSONEncoder</span><span class="p">()</span><span class="o">.</span><span class="nf">encode</span><span class="p">(</span><span class="k">self</span><span class="p">)))</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div>

<p>Time to give it a try: Entering a username and clicking “Register” should trigger the prompt asking you to create a new Passkey! However nothing will happen afterwards. Let’s fix that!</p>

<h3 id="verifying-and-persisting-the-passkey" class="header-with-anchor">Verifying and persisting the Passkey <a title="Permalink for Verifying and persisting the Passkey section" href="#verifying-and-persisting-the-passkey">
            <?xml version="1.0" encoding="utf-8"?> <svg width="24px" height="24px" viewBox="0 0 14 14" role="img" focusable="false" aria-hidden="true" xmlns="http://www.w3.org/2000/svg"><path d="m 11.58824,9.823529 q 0,-0.294117 -0.20589,-0.499999 L 9.85294,7.794118 q -0.20588,-0.205883 -0.5,-0.205883 -0.30882,0 -0.52941,0.235295 0.0221,0.02206 0.13971,0.136029 0.11764,0.113971 0.15808,0.158088 0.0404,0.04412 0.1103,0.139706 0.0698,0.09559 0.0956,0.1875 0.0257,0.09191 0.0257,0.202206 0,0.294117 -0.20588,0.5 -0.20588,0.205882 -0.5,0.205882 -0.1103,0 -0.20221,-0.02573 Q 8.35293,9.301471 8.25733,9.231621 8.16173,9.161771 8.11763,9.121327 8.07353,9.080887 7.95954,8.963238 7.84557,8.845591 7.82351,8.823533 7.58086,9.051474 7.58086,9.360297 q 0,0.294118 0.20588,0.5 l 1.51471,1.522059 q 0.19853,0.19853 0.5,0.19853 0.29412,0 0.5,-0.191177 l 1.08088,-1.073529 q 0.20589,-0.205883 0.20589,-0.492648 z M 6.41912,4.639706 q 0,-0.294118 -0.20588,-0.5 L 4.69853,2.617647 q -0.20588,-0.205882 -0.5,-0.205882 -0.28677,0 -0.5,0.198529 L 2.61765,3.683823 q -0.20589,0.205883 -0.20589,0.492648 0,0.294117 0.20589,0.499999 l 1.52941,1.529412 q 0.19853,0.19853 0.5,0.19853 0.30882,0 0.52941,-0.227942 Q 5.15437,6.15441 5.03676,6.040441 4.91912,5.92647 4.87868,5.882353 4.83828,5.838233 4.76838,5.742647 q -0.0698,-0.09559 -0.0956,-0.1875 -0.0257,-0.09191 -0.0257,-0.202206 0,-0.294117 0.20588,-0.5 0.20588,-0.205882 0.5,-0.205882 0.1103,0 0.20221,0.02573 0.0919,0.02573 0.1875,0.09559 0.0956,0.06985 0.1397,0.110294 0.0441,0.04044 0.15809,0.158089 Q 6.15443,5.154409 6.17649,5.176467 6.41914,4.948526 6.41914,4.639703 z M 13,9.823529 q 0,0.882353 -0.625,1.492647 l -1.08088,1.07353 Q 10.68382,13 9.80147,13 q -0.88971,0 -1.5,-0.625 L 6.78676,10.852941 Q 6.17647,10.242647 6.17647,9.360294 q 0,-0.904412 0.64706,-1.536764 L 6.17647,7.176471 Q 5.54412,7.82353 4.64706,7.82353 q -0.88235,0 -1.5,-0.617648 L 1.617647,5.676471 Q 1,5.058824 1,4.176471 1,3.294118 1.625,2.683824 L 2.70588,1.610294 Q 3.31618,1 4.19853,1 q 0.88971,0 1.5,0.625 l 1.51471,1.522059 q 0.61029,0.610294 0.61029,1.492647 0,0.904412 -0.64706,1.536764 L 7.82353,6.823529 Q 8.45588,6.17647 9.35294,6.17647 q 0.88235,0 1.5,0.617648 l 1.52941,1.529411 Q 13,8.941176 13,9.823529 z"/></svg>
          </a></h3>

<p>After the browser creates the Passkey we need to send it to our server, verify everything went smoothly and persist it somewhere.</p>

<p>First, let’s send the Passkey to our server. In our JavaScript code add this just below <code class="language-plaintext highlighter-rouge">const passkey = await create(parseCreationOptionsFromJSON(registerResponseJSON));</code> in the <code class="language-plaintext highlighter-rouge">registerForm</code> event listener:</p>

<div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">const</span> <span class="nx">createPasskeyResponse</span> <span class="o">=</span> <span class="k">await</span> <span class="nf">fetch</span><span class="p">(</span><span class="dl">'</span><span class="s1">/passkeys</span><span class="dl">'</span><span class="p">,</span> <span class="p">{</span>
    <span class="na">method</span><span class="p">:</span> <span class="dl">'</span><span class="s1">POST</span><span class="dl">'</span><span class="p">,</span>
    <span class="na">headers</span><span class="p">:</span> <span class="p">{</span>
      <span class="dl">'</span><span class="s1">Content-Type</span><span class="dl">'</span><span class="p">:</span> <span class="dl">'</span><span class="s1">application/json</span><span class="dl">'</span>
    <span class="p">},</span>
    <span class="na">body</span><span class="p">:</span> <span class="nx">JSON</span><span class="p">.</span><span class="nf">stringify</span><span class="p">(</span><span class="nx">passkey</span><span class="p">)</span>
<span class="p">});</span>
</code></pre></div></div>

<p>On the server we first obtain the user we want to register a Passkey for. Then we decode the Passkey from the request body and verify it. If everything went well we can persist the Passkey in our database. Add this logic in a new <code class="language-plaintext highlighter-rouge">POST /register</code> endpoint:</p>

<div class="language-swift highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">// Example implementation for a Vapor app</span>
<span class="n">app</span><span class="o">.</span><span class="nf">post</span><span class="p">(</span><span class="s">"register"</span><span class="p">,</span> <span class="nv">use</span><span class="p">:</span> <span class="p">{</span> <span class="n">req</span> <span class="k">in</span>
    <span class="c1">// Obtain the user we're registering a credential for</span>
    <span class="k">let</span> <span class="nv">user</span> <span class="o">=</span> <span class="k">try</span> <span class="n">req</span><span class="o">.</span><span class="n">auth</span><span class="o">.</span><span class="nf">require</span><span class="p">(</span><span class="kt">User</span><span class="o">.</span><span class="k">self</span><span class="p">)</span>

    <span class="c1">// Obtain the challenge we stored for this session</span>
    <span class="k">guard</span> <span class="k">let</span> <span class="nv">challengeEncoded</span> <span class="o">=</span> <span class="n">req</span><span class="o">.</span><span class="n">session</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s">"registrationChallenge"</span><span class="p">],</span>
        <span class="k">let</span> <span class="nv">challenge</span> <span class="o">=</span> <span class="kt">Data</span><span class="p">(</span><span class="nv">base64Encoded</span><span class="p">:</span> <span class="n">challengeEncoded</span><span class="p">)</span> <span class="k">else</span> <span class="p">{</span>
        <span class="k">throw</span> <span class="kt">Abort</span><span class="p">(</span><span class="o">.</span><span class="n">badRequest</span><span class="p">,</span> <span class="nv">reason</span><span class="p">:</span> <span class="s">"Missing registration challenge"</span><span class="p">)</span>
    <span class="p">}</span>

    <span class="c1">// Delete the challenge to prevent attackers from reusing it</span>
    <span class="n">req</span><span class="o">.</span><span class="n">session</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s">"registrationChallenge"</span><span class="p">]</span> <span class="o">=</span> <span class="kc">nil</span>

    <span class="c1">// Verify the credential the client sent us</span>
    <span class="k">let</span> <span class="nv">credential</span> <span class="o">=</span> <span class="k">try</span> <span class="k">await</span> <span class="n">req</span><span class="o">.</span><span class="n">webAuthn</span><span class="o">.</span><span class="nf">finishRegistration</span><span class="p">(</span>
        <span class="nv">challenge</span><span class="p">:</span> <span class="p">[</span><span class="kt">UInt8</span><span class="p">](</span><span class="n">challenge</span><span class="p">),</span>
        <span class="nv">credentialCreationData</span><span class="p">:</span> <span class="n">req</span><span class="o">.</span><span class="n">content</span><span class="o">.</span><span class="nf">decode</span><span class="p">(</span><span class="kt">RegistrationCredential</span><span class="o">.</span><span class="k">self</span><span class="p">),</span>
        <span class="nv">confirmCredentialIDNotRegisteredYet</span><span class="p">:</span> <span class="p">{</span> <span class="n">_</span> <span class="k">in</span> <span class="kc">true</span><span class="p">}</span>
    <span class="p">)</span>

    <span class="k">try</span> <span class="k">await</span> <span class="kt">Passkey</span><span class="p">(</span>
        <span class="nv">id</span><span class="p">:</span> <span class="n">credential</span><span class="o">.</span><span class="n">id</span><span class="p">,</span>
        <span class="nv">publicKey</span><span class="p">:</span> <span class="n">credential</span><span class="o">.</span><span class="n">publicKey</span><span class="o">.</span><span class="nf">base64URLEncodedString</span><span class="p">()</span><span class="o">.</span><span class="nf">asString</span><span class="p">(),</span>
        <span class="nv">currentSignCount</span><span class="p">:</span> <span class="n">credential</span><span class="o">.</span><span class="n">signCount</span><span class="p">,</span>
        <span class="nv">userID</span><span class="p">:</span> <span class="n">user</span><span class="o">.</span><span class="nf">requireID</span><span class="p">()</span>
    <span class="p">)</span><span class="o">.</span><span class="nf">save</span><span class="p">(</span><span class="nv">on</span><span class="p">:</span> <span class="n">req</span><span class="o">.</span><span class="n">db</span><span class="p">)</span>

    <span class="k">return</span> <span class="kt">HTTPStatus</span><span class="o">.</span><span class="n">ok</span>
<span class="p">})</span>
</code></pre></div></div>

<p>Congratulations, you just built a Passkey registration! Entering a username and hitting “Register” should now redirect you to a private page. The passkey should also appear in your database (in the passkeys table) now.</p>

<h2 id="act-2---log-in" class="header-with-anchor">Act 2 - Log in <a title="Permalink for Act 2 - Log in section" href="#act-2---log-in">
            <?xml version="1.0" encoding="utf-8"?> <svg width="24px" height="24px" viewBox="0 0 14 14" role="img" focusable="false" aria-hidden="true" xmlns="http://www.w3.org/2000/svg"><path d="m 11.58824,9.823529 q 0,-0.294117 -0.20589,-0.499999 L 9.85294,7.794118 q -0.20588,-0.205883 -0.5,-0.205883 -0.30882,0 -0.52941,0.235295 0.0221,0.02206 0.13971,0.136029 0.11764,0.113971 0.15808,0.158088 0.0404,0.04412 0.1103,0.139706 0.0698,0.09559 0.0956,0.1875 0.0257,0.09191 0.0257,0.202206 0,0.294117 -0.20588,0.5 -0.20588,0.205882 -0.5,0.205882 -0.1103,0 -0.20221,-0.02573 Q 8.35293,9.301471 8.25733,9.231621 8.16173,9.161771 8.11763,9.121327 8.07353,9.080887 7.95954,8.963238 7.84557,8.845591 7.82351,8.823533 7.58086,9.051474 7.58086,9.360297 q 0,0.294118 0.20588,0.5 l 1.51471,1.522059 q 0.19853,0.19853 0.5,0.19853 0.29412,0 0.5,-0.191177 l 1.08088,-1.073529 q 0.20589,-0.205883 0.20589,-0.492648 z M 6.41912,4.639706 q 0,-0.294118 -0.20588,-0.5 L 4.69853,2.617647 q -0.20588,-0.205882 -0.5,-0.205882 -0.28677,0 -0.5,0.198529 L 2.61765,3.683823 q -0.20589,0.205883 -0.20589,0.492648 0,0.294117 0.20589,0.499999 l 1.52941,1.529412 q 0.19853,0.19853 0.5,0.19853 0.30882,0 0.52941,-0.227942 Q 5.15437,6.15441 5.03676,6.040441 4.91912,5.92647 4.87868,5.882353 4.83828,5.838233 4.76838,5.742647 q -0.0698,-0.09559 -0.0956,-0.1875 -0.0257,-0.09191 -0.0257,-0.202206 0,-0.294117 0.20588,-0.5 0.20588,-0.205882 0.5,-0.205882 0.1103,0 0.20221,0.02573 0.0919,0.02573 0.1875,0.09559 0.0956,0.06985 0.1397,0.110294 0.0441,0.04044 0.15809,0.158089 Q 6.15443,5.154409 6.17649,5.176467 6.41914,4.948526 6.41914,4.639703 z M 13,9.823529 q 0,0.882353 -0.625,1.492647 l -1.08088,1.07353 Q 10.68382,13 9.80147,13 q -0.88971,0 -1.5,-0.625 L 6.78676,10.852941 Q 6.17647,10.242647 6.17647,9.360294 q 0,-0.904412 0.64706,-1.536764 L 6.17647,7.176471 Q 5.54412,7.82353 4.64706,7.82353 q -0.88235,0 -1.5,-0.617648 L 1.617647,5.676471 Q 1,5.058824 1,4.176471 1,3.294118 1.625,2.683824 L 2.70588,1.610294 Q 3.31618,1 4.19853,1 q 0.88971,0 1.5,0.625 l 1.51471,1.522059 q 0.61029,0.610294 0.61029,1.492647 0,0.904412 -0.64706,1.536764 L 7.82353,6.823529 Q 8.45588,6.17647 9.35294,6.17647 q 0.88235,0 1.5,0.617648 l 1.52941,1.529411 Q 13,8.941176 13,9.823529 z"/></svg>
          </a></h2>

<p>Now that we have a Passkey we can use it to log in. The process is very similar to the registration process, except we don’t need an input field for the username.
Let’s start with the frontend. Add a new HTML form below the registration in <code class="language-plaintext highlighter-rouge">Resources/Views/index.leaf</code>:</p>

<div class="language-html highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nt">&lt;/form&gt;</span>
<span class="c">&lt;!-- End of registration form --&gt;</span>

<span class="nt">&lt;form</span> <span class="na">id=</span><span class="s">"loginForm"</span><span class="nt">&gt;</span>
    <span class="nt">&lt;button</span> <span class="na">type=</span><span class="s">"submit"</span><span class="nt">&gt;</span>Login<span class="nt">&lt;/button&gt;</span>
<span class="nt">&lt;/form&gt;</span>
</code></pre></div></div>

<p>Next we need to import two additional helper from the GitHub WebAuthn wrapper. Update the import statement in the <code class="language-plaintext highlighter-rouge">&lt;script&gt;</code> tag to include <code class="language-plaintext highlighter-rouge">get</code> and <code class="language-plaintext highlighter-rouge">parseRequestOptionsFromJSON</code>:</p>

<div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">import</span> <span class="p">{</span> <span class="nx">create</span><span class="p">,</span> <span class="kd">get</span><span class="p">,</span> <span class="nx">parseCreationOptionsFromJSON</span><span class="p">,</span> <span class="nx">parseRequestOptionsFromJSON</span> <span class="p">}</span> <span class="k">from</span> <span class="dl">'</span><span class="s1">https://cdn.jsdelivr.net.....
</span></code></pre></div></div>

<p>At the end of the script add the following code:</p>
<div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">// ...</span>
<span class="c1">//     location.href = "/private";</span>
<span class="c1">// });</span>

<span class="c1">// Get a reference to our login form</span>
<span class="kd">const</span> <span class="nx">loginForm</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nf">getElementById</span><span class="p">(</span><span class="dl">"</span><span class="s2">loginForm</span><span class="dl">"</span><span class="p">);</span>

<span class="c1">// Listen for the form's "submit" event</span>
<span class="nx">loginForm</span><span class="p">.</span><span class="nf">addEventListener</span><span class="p">(</span><span class="dl">"</span><span class="s2">submit</span><span class="dl">"</span><span class="p">,</span> <span class="k">async</span> <span class="kd">function</span><span class="p">(</span><span class="nx">event</span><span class="p">)</span> <span class="p">{</span>
  <span class="nx">event</span><span class="p">.</span><span class="nf">preventDefault</span><span class="p">();</span>
  <span class="c1">// Send request to Vapor app</span>
  <span class="kd">const</span> <span class="nx">loginResponse</span> <span class="o">=</span> <span class="k">await</span> <span class="nf">fetch</span><span class="p">(</span><span class="dl">'</span><span class="s1">/login</span><span class="dl">'</span><span class="p">);</span>
  <span class="c1">// Parse response as json and pass into wrapped WebAuthn API</span>
  <span class="kd">const</span> <span class="nx">loginResponseJSON</span> <span class="o">=</span> <span class="k">await</span> <span class="nx">loginResponse</span><span class="p">.</span><span class="nf">json</span><span class="p">();</span>
  <span class="kd">const</span> <span class="nx">loginAttempt</span> <span class="o">=</span> <span class="k">await</span> <span class="nf">get</span><span class="p">(</span><span class="nf">parseRequestOptionsFromJSON</span><span class="p">(</span><span class="nx">loginResponseJSON</span><span class="p">));</span>
<span class="p">});</span>
</code></pre></div></div>

<p>Similar to the registration we listen for the form’s <code class="language-plaintext highlighter-rouge">submit</code> event. On submit we send a <code class="language-plaintext highlighter-rouge">/login</code> request to our backend. The response contains a handful of options and a randomly generated challenge. When passing this data to <code class="language-plaintext highlighter-rouge">get(parseRequestOptionsFromJSON(...))</code> the browser will prompt the user to log in using a Passkey. On success the challenge will be signed by the Passkey. This signed challenge is what we send back to the server in a second request. Add this just after <code class="language-plaintext highlighter-rouge">const loginAttempt = await get(parseRequestOptionsFromJSON(loginResponseJSON));</code>:</p>

<div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">// Send passkey to Vapor app</span>
<span class="kd">const</span> <span class="nx">loginAttemptResponse</span> <span class="o">=</span> <span class="k">await</span> <span class="nf">fetch</span><span class="p">(</span><span class="dl">'</span><span class="s1">/login</span><span class="dl">'</span><span class="p">,</span> <span class="p">{</span>
    <span class="na">method</span><span class="p">:</span> <span class="dl">'</span><span class="s1">POST</span><span class="dl">'</span><span class="p">,</span>
    <span class="na">headers</span><span class="p">:</span> <span class="p">{</span>
        <span class="dl">'</span><span class="s1">Content-Type</span><span class="dl">'</span><span class="p">:</span> <span class="dl">'</span><span class="s1">application/json</span><span class="dl">'</span>
    <span class="p">},</span>
    <span class="na">body</span><span class="p">:</span> <span class="nx">JSON</span><span class="p">.</span><span class="nf">stringify</span><span class="p">(</span><span class="nx">loginAttempt</span><span class="p">)</span>
<span class="p">});</span>

<span class="c1">// Redirect to private page</span>
<span class="nx">location</span><span class="p">.</span><span class="nx">href</span> <span class="o">=</span> <span class="dl">"</span><span class="s2">/private</span><span class="dl">"</span><span class="p">;</span>
</code></pre></div></div>

<p>This will send the login attempt with the signed challenge to our server and redirect the user to the private page if everything went well. Let’s implement the server side of things. First add the endpoint that handles the <code class="language-plaintext highlighter-rouge">GET /login</code> request returning the options and a randomly generated challenge:</p>

<div class="language-swift highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">app</span><span class="o">.</span><span class="nf">get</span><span class="p">(</span><span class="s">"login"</span><span class="p">)</span> <span class="p">{</span> <span class="n">req</span> <span class="k">in</span>
    <span class="c1">// Generate registration options</span>
    <span class="k">let</span> <span class="nv">options</span> <span class="o">=</span> <span class="k">try</span> <span class="n">req</span><span class="o">.</span><span class="n">webAuthn</span><span class="o">.</span><span class="nf">beginAuthentication</span><span class="p">()</span>
    <span class="c1">// Also pass along challenge because we need it later</span>
    <span class="n">req</span><span class="o">.</span><span class="n">session</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s">"authChallenge"</span><span class="p">]</span> <span class="o">=</span> <span class="kt">Data</span><span class="p">(</span><span class="n">options</span><span class="o">.</span><span class="n">challenge</span><span class="p">)</span><span class="o">.</span><span class="nf">base64EncodedString</span><span class="p">()</span>
    <span class="k">return</span> <span class="kt">RequestCredentialOptions</span><span class="p">(</span><span class="nv">publicKey</span><span class="p">:</span> <span class="n">options</span><span class="p">)</span>
<span class="p">}</span>
</code></pre></div></div>

<p>Additionally we store the challenge in a cookie because we’ll need it later when verifying the Passkey. Running the server and pressing “Login” should now trigger the Passkey prompt. If you previously registered it should also show you the username (or a list of usernames if you registered more than one account). However if you try to confirm the prompt you’ll notice that nothing happens.</p>

<p>The last step will be to verify login attempts in the <code class="language-plaintext highlighter-rouge">POST /login</code> endpoint. Start by adding the endpoint and retrieving the challenge from the users session:</p>

<div class="language-swift highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">app</span><span class="o">.</span><span class="nf">post</span><span class="p">(</span><span class="s">"login"</span><span class="p">)</span> <span class="p">{</span> <span class="n">req</span> <span class="k">in</span>
    <span class="c1">// Obtain the challenge we stored on the server for this session</span>
    <span class="k">guard</span> <span class="k">let</span> <span class="nv">challengeEncoded</span> <span class="o">=</span> <span class="n">req</span><span class="o">.</span><span class="n">session</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s">"authChallenge"</span><span class="p">],</span>
        <span class="k">let</span> <span class="nv">challenge</span> <span class="o">=</span> <span class="kt">Data</span><span class="p">(</span><span class="nv">base64Encoded</span><span class="p">:</span> <span class="n">challengeEncoded</span><span class="p">)</span> <span class="k">else</span> <span class="p">{</span>
        <span class="k">throw</span> <span class="kt">Abort</span><span class="p">(</span><span class="o">.</span><span class="n">badRequest</span><span class="p">,</span> <span class="nv">reason</span><span class="p">:</span> <span class="s">"Missing authentication challenge"</span><span class="p">)</span>
    <span class="p">}</span>

    <span class="n">req</span><span class="o">.</span><span class="n">session</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s">"authChallenge"</span><span class="p">]</span> <span class="o">=</span> <span class="kc">nil</span>
<span class="p">}</span>
</code></pre></div></div>

<p>To prevent attackers from reusing the challenge, using a so-called <a href="https://en.wikipedia.org/wiki/Replay_attack">Replay attack</a>, we delete it from the session right away. To verify the login attempt we first decode it from the request body and try to find the corresponding Passkey in our database. If we find a Passkey we can continue and verify the login attempt. Add this below <code class="language-plaintext highlighter-rouge">req.session.data["authChallenge"] = nil</code>:</p>

<div class="language-swift highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">let</span> <span class="nv">authenticationCredential</span> <span class="o">=</span> <span class="k">try</span> <span class="n">req</span><span class="o">.</span><span class="n">content</span><span class="o">.</span><span class="nf">decode</span><span class="p">(</span><span class="kt">AuthenticationCredential</span><span class="o">.</span><span class="k">self</span><span class="p">)</span>

<span class="k">guard</span> <span class="k">let</span> <span class="nv">credential</span> <span class="o">=</span> <span class="k">try</span> <span class="k">await</span> <span class="kt">Passkey</span><span class="o">.</span><span class="nf">query</span><span class="p">(</span><span class="nv">on</span><span class="p">:</span> <span class="n">req</span><span class="o">.</span><span class="n">db</span><span class="p">)</span>
    <span class="o">.</span><span class="nf">filter</span><span class="p">(\</span><span class="o">.</span><span class="n">$id</span> <span class="o">==</span> <span class="n">authenticationCredential</span><span class="o">.</span><span class="n">id</span><span class="o">.</span><span class="n">urlDecoded</span><span class="o">.</span><span class="nf">asString</span><span class="p">())</span>
    <span class="o">.</span><span class="nf">with</span><span class="p">(\</span><span class="o">.</span><span class="n">$user</span><span class="p">)</span>
    <span class="o">.</span><span class="nf">first</span><span class="p">()</span> <span class="k">else</span> <span class="p">{</span>
    <span class="k">throw</span> <span class="kt">Abort</span><span class="p">(</span><span class="o">.</span><span class="n">unauthorized</span><span class="p">)</span>
<span class="p">}</span>

<span class="k">let</span> <span class="nv">verifiedAuthentication</span> <span class="o">=</span> <span class="k">try</span> <span class="n">req</span><span class="o">.</span><span class="n">webAuthn</span><span class="o">.</span><span class="nf">finishAuthentication</span><span class="p">(</span>
    <span class="nv">credential</span><span class="p">:</span> <span class="n">authenticationCredential</span><span class="p">,</span>
    <span class="nv">expectedChallenge</span><span class="p">:</span> <span class="p">[</span><span class="kt">UInt8</span><span class="p">](</span><span class="n">challenge</span><span class="p">),</span>
    <span class="nv">credentialPublicKey</span><span class="p">:</span> <span class="p">[</span><span class="kt">UInt8</span><span class="p">](</span><span class="kt">URLEncodedBase64</span><span class="p">(</span><span class="n">credential</span><span class="o">.</span><span class="n">publicKey</span><span class="p">)</span><span class="o">.</span><span class="n">urlDecoded</span><span class="o">.</span><span class="n">decoded</span><span class="o">!</span><span class="p">),</span>
    <span class="nv">credentialCurrentSignCount</span><span class="p">:</span> <span class="n">credential</span><span class="o">.</span><span class="n">currentSignCount</span>
<span class="p">)</span>
</code></pre></div></div>

<p>Finally if <code class="language-plaintext highlighter-rouge">webAuthn.finishAuthentication</code> returns without throwing an error we know the login attempt was successful. We can now update the Passkey’s <code class="language-plaintext highlighter-rouge">currentSignCount</code>, sign in the user and return a response just after the call to <code class="language-plaintext highlighter-rouge">req.webAuthn.finishAuthentication</code>:</p>

<div class="language-swift highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">credential</span><span class="o">.</span><span class="n">currentSignCount</span> <span class="o">=</span> <span class="n">verifiedAuthentication</span><span class="o">.</span><span class="n">newSignCount</span>
<span class="k">try</span> <span class="k">await</span> <span class="n">credential</span><span class="o">.</span><span class="nf">save</span><span class="p">(</span><span class="nv">on</span><span class="p">:</span> <span class="n">req</span><span class="o">.</span><span class="n">db</span><span class="p">)</span>

<span class="n">req</span><span class="o">.</span><span class="n">auth</span><span class="o">.</span><span class="nf">login</span><span class="p">(</span><span class="n">credential</span><span class="o">.</span><span class="n">user</span><span class="p">)</span>
<span class="k">return</span> <span class="kt">HTTPStatus</span><span class="o">.</span><span class="n">ok</span>
</code></pre></div></div>

<p>Congratulations, you just built a Passkey login! Pressing the login button and confirming the Passkey prompt should redirect you to a private page. If you want to see the whole implementation you can find it in the “final” directory of the <a href="https://github.com/brokenhandsio/swift-webauthn-guide">demo project</a>.</p>


  
</article>

</main>

<footer role="contentinfo">
  <div class="footer-content">
    
    <p class="copyright">Copyright © 2025 Apple Inc. All rights reserved.</p>
    <p class="trademark">Swift and the Swift logo are trademarks of Apple Inc.</p>
    <p class="privacy">
      <a href="//www.apple.com/privacy/privacy-policy/">Privacy Policy</a>
      <a href="//www.apple.com/legal/privacy/en-ww/cookies/">Cookies</a>
      <a href="/openapi">API</a>
    </p>
  </div>
  <div class="footer-other">
    <form
      class="color-scheme-toggle"
      role="radiogroup"
      tabindex="0"
      id="color-scheme-toggle"
    >
      <legend class="visuallyhidden">Color scheme preference</legend>
      <label for="scheme-light">
        <input id="scheme-light" type="radio" name="color-scheme-preference" value="light">
        <span class="color-scheme-toggle-label">Light</span>
      </label>
      <label for="scheme-dark">
        <input id="scheme-dark" type="radio" name="color-scheme-preference" value="dark">
        <span class="color-scheme-toggle-label">Dark</span>
      </label>
      <label for="scheme-auto" id="scheme-auto-wrapper">
        <input id="scheme-auto" type="radio" name="color-scheme-preference" value="auto">
        <span class="color-scheme-toggle-label">Auto</span>
      </label>
    </form>
    <aside>
      <a href="https://x.com/swiftlang" rel="me" title="Follow @SwiftLang on X"><i class="x"></i></a>
      <a href="https://bsky.app/profile/swift.org" rel="me" title="Follow @swift.org on Bluesky"><i class="bluesky"></i></a>
      <a href="https://mastodon.social/@swiftlang" rel="me" title="Follow @swiftLang on Mastodon"><i class="mastodon"></i></a>
      <a href="/atom.xml" title="Subscribe to Site Updates"><i class="feed"></i></a>
    </aside>
  </div>
</footer>


<script src="/swift-org-website/pr-preview/pr-1/assets/javascripts/application.js"></script>
<!-- metrics -->
<script>
    /* RSID: */
    var s_account="awdswiftorg"
</script>

<!-- /metrics -->
</body>
</html>
