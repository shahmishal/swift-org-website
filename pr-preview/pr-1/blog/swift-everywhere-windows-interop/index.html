<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="utf-8" />
  <title>Swift.org - Swift Everywhere: Using Interoperability to Build on Windows</title>
  
  <meta name="robots" content="noindex" />
  
  <meta name="author" content="Apple Inc." />
  <meta name="viewport" content="width=device-width initial-scale=1" />
  
  <meta name="description" content="This post was originally published at Speaking in Swift by The Browser Company under the title “Interoperability: Swift’s Super Power”.
">
  
  <link rel="license" href="/swift-org-website/pr-preview/pr-1/LICENSE.txt" />
  <link rel="stylesheet" media="all" href="/swift-org-website/pr-preview/pr-1/assets/stylesheets/application.css" />
  <link rel="shortcut icon" sizes="16x16 24x24 32x32 48x48 64x64" type="image/vnd.microsoft.icon" href="/swift-org-website/pr-preview/pr-1/favicon.ico" />
  <link rel="apple-touch-icon" href="/swift-org-website/pr-preview/pr-1/apple-touch-icon.png" />
  <link rel="apple-touch-icon" sizes="57x57" href="/swift-org-website/pr-preview/pr-1/apple-touch-icon-57x57.png" />
  <link rel="apple-touch-icon" sizes="72x72" href="/swift-org-website/pr-preview/pr-1/apple-touch-icon-72x72.png" />
  <link rel="apple-touch-icon" sizes="76x76" href="/swift-org-website/pr-preview/pr-1/apple-touch-icon-76x76.png" />
  <link rel="apple-touch-icon" sizes="114x114" href="/swift-org-website/pr-preview/pr-1/apple-touch-icon-114x114.png" />
  <link rel="apple-touch-icon" sizes="120x120" href="/swift-org-website/pr-preview/pr-1/apple-touch-icon-120x120.png" />
  <link rel="apple-touch-icon" sizes="144x144" href="/swift-org-website/pr-preview/pr-1/apple-touch-icon-144x144.png" />
  <link rel="apple-touch-icon" sizes="152x152" href="/swift-org-website/pr-preview/pr-1/apple-touch-icon-152x152.png" />
  <link rel="apple-touch-icon" sizes="180x180" href="/swift-org-website/pr-preview/pr-1/apple-touch-icon-180x180.png" />
  <link rel="mask-icon" href="/swift-org-website/pr-preview/pr-1/assets/images/icon-swift.svg" color="#F05339" />
  

  
  <link rel="canonical" href="https://shahmishal.github.io/swift-org-website/pr-preview/pr-1/swift-org-website/pr-preview/pr-1/blog/swift-everywhere-windows-interop/" />
  

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:site" content="@SwiftLang" />
  
  <meta name="twitter:title" content="Swift Everywhere: Using Interoperability to Build on Windows" />
  <meta name="twitter:description" content="This post was originally published at Speaking in Swift by The Browser Company under the title “Interoperability: Swift’s Super Power”.
" />
  

  <meta property="og:site_name" content="Swift.org" />
  <meta property="og:image" content="https://shahmishal.github.io/swift-org-website/pr-preview/pr-1/apple-touch-icon-180x180.png" />
  
  
  <meta property="og:type" content="article" />
  <meta property="og:title" content="Swift Everywhere: Using Interoperability to Build on Windows" />
  <meta property="og:url" content="https://shahmishal.github.io/swift-org-website/pr-preview/pr-1/blog/swift-everywhere-windows-interop/" />
  <meta property="og:description" content="This post was originally published at Speaking in Swift by The Browser Company under the title “Interoperability: Swift’s Super Power”.
" />
  <meta property="article:published_time" content="2023-10-13T06:00:00-04:00" />
  <meta property="article:modified_time" content="2025-03-08T02:00:49-04:00" />
  
</head>

<body>

<p class="stage">
  ⚠️ STAGING WEBSITE ⚠️<br>
    Visit <a href="https://www.swift.org">swift.org</a> for production website.
  </a>
</p>

<script src="/swift-org-website/pr-preview/pr-1/assets/javascripts/color-scheme-toggle.js"></script>
<header class="site-navigation">
  <div class="wrapper">
    <h1 id="logo">
      <a href="/" title="Swift.org">
        <svg xmlns="http://www.w3.org/2000/svg" xml:space="preserve" viewBox="0 0 191.186 59.391"><path fill="#F05138" d="M59.387 16.45a82.463 82.463 0 0 0-.027-1.792c-.035-1.301-.112-2.614-.343-3.9-.234-1.307-.618-2.523-1.222-3.71a12.464 12.464 0 0 0-5.453-5.452C51.156.992 49.941.609 48.635.374c-1.288-.232-2.6-.308-3.902-.343a85.714 85.714 0 0 0-1.792-.027C42.23 0 41.52 0 40.813 0H18.578c-.71 0-1.419 0-2.128.004-.597.004-1.195.01-1.792.027-.325.009-.651.02-.978.036-.978.047-1.959.133-2.924.307-.98.176-1.908.436-2.811.81A12.503 12.503 0 0 0 3.89 3.89a12.46 12.46 0 0 0-2.294 3.158C.992 8.235.61 9.45.374 10.758c-.231 1.286-.308 2.599-.343 3.9a85.767 85.767 0 0 0-.027 1.792C-.001 17.16 0 17.869 0 18.578v22.235c0 .71 0 1.418.004 2.128.004.597.01 1.194.027 1.791.035 1.302.112 2.615.343 3.901.235 1.307.618 2.523 1.222 3.71a12.457 12.457 0 0 0 5.453 5.453c1.186.603 2.401.986 3.707 1.22 1.287.232 2.6.31 3.902.344.597.016 1.195.023 1.793.027.709.005 1.417.004 2.127.004h22.235c.709 0 1.418 0 2.128-.004.597-.004 1.194-.011 1.792-.027 1.302-.035 2.614-.112 3.902-.343 1.306-.235 2.521-.618 3.707-1.222a12.461 12.461 0 0 0 5.453-5.452c.604-1.187.987-2.403 1.222-3.71.231-1.286.308-2.6.343-3.9.016-.598.023-1.194.027-1.792.004-.71.004-1.419.004-2.129V18.578c0-.71 0-1.419-.004-2.128z"/><path fill="#FFF" d="m47.06 36.66-.004-.004c.066-.224.134-.446.191-.675 2.465-9.821-3.55-21.432-13.731-27.546 4.461 6.048 6.434 13.374 4.681 19.78-.156.571-.344 1.12-.552 1.653-.225-.148-.51-.316-.89-.527 0 0-10.127-6.252-21.103-17.312-.288-.29 5.852 8.777 12.822 16.14-3.284-1.843-12.434-8.5-18.227-13.802.712 1.187 1.558 2.33 2.489 3.43C17.573 23.932 23.882 31.5 31.44 37.314c-5.31 3.25-12.814 3.502-20.285.003a30.646 30.646 0 0 1-5.193-3.098c3.162 5.058 8.033 9.423 13.96 11.97 7.07 3.039 14.1 2.833 19.336.05l-.004.007c.024-.016.055-.032.08-.047.214-.116.428-.234.636-.358 2.516-1.306 7.485-2.63 10.152 2.559.654 1.27 2.041-5.46-3.061-11.74z"/><path id="logotype" d="M81.93 38.542c.465 4.12 4.394 6.822 9.852 6.822 5.185 0 8.924-2.701 8.924-6.44 0-3.22-2.265-5.185-7.478-6.495l-5.048-1.282c-7.26-1.801-10.534-5.077-10.534-10.48 0-6.658 5.813-11.27 14.082-11.27 8.022 0 13.726 4.639 13.917 11.325h-5.32c-.41-4.093-3.74-6.604-8.734-6.604-4.94 0-8.378 2.538-8.378 6.249 0 2.892 2.13 4.612 7.369 5.95l4.202 1.09c8.133 1.993 11.462 5.159 11.462 10.863 0 7.259-5.759 11.816-14.928 11.816-8.514 0-14.327-4.53-14.763-11.543h5.376zM140.049 49.43h-5.35l-6.249-21.776h-.109L122.12 49.43h-5.348l-7.914-28.518h5.184l5.513 22.896h.11l6.221-22.896h5.021l6.277 22.896h.11l5.512-22.896h5.13L140.05 49.43zM151.39 13.244c0-1.718 1.419-3.11 3.138-3.11 1.746 0 3.165 1.392 3.165 3.11 0 1.72-1.419 3.139-3.165 3.139a3.157 3.157 0 0 1-3.139-3.139zm.545 7.669h5.213V49.43h-5.213V20.913zM191.186 25.116v-4.204h-5.513v-6.821h-5.185v6.821h-9.964v-2.51c.027-2.538 1.01-3.603 3.357-3.603.764 0 1.528.083 2.156.192v-4.094a18.193 18.193 0 0 0-2.756-.218c-5.568 0-7.915 2.32-7.915 7.642v2.591h-3.983v4.204h3.983V49.43h5.185V25.116H180.488v16.838c0 5.512 2.101 7.64 7.559 7.64 1.174 0 2.51-.082 3.111-.218v-4.257c-.355.055-1.392.137-1.965.137-2.428 0-3.52-1.147-3.52-3.712V25.116h5.513z"/></svg>

      </a>
    </h1>

    <nav role="navigation">
      <ul class="navigation-links">
        
          <li class="nav-item">
            
              <span class="">
                
                  <a href="/getting-started/" data-text="Get Started">Get Started</a>
                
                
              </span>
            
            
          </li>
        
          <li class="nav-item">
            
              <span class="">
                
                  <a href="/blog/" data-text="Blog">Blog</a>
                
                
              </span>
            
            
          </li>
        
          <li class="nav-item">
            
              <span class="">
                
                  <a href="/documentation/" data-text="Documentation">Documentation</a>
                
                
              </span>
            
            
          </li>
        
          <li class="nav-item">
            
              <span class="">
                
                  <a href="/packages/" data-text="Packages">Packages</a>
                
                
              </span>
            
            
          </li>
        
          <li class="nav-item">
            
              <span class="">
                
                  <a href="/tools/" data-text="Tools">Tools</a>
                
                
              </span>
            
            
          </li>
        
          <li class="nav-item">
            
              <span class="">
                
                  <a href="/community/" data-text="Community">Community</a>
                
                
                  <i>&#9663;</i>
                
              </span>
            
            
              <ul class="nav-submenu" role="menu">
                
                  
                    
                    <li role="presentation">
                    
                      <a href="/community/" role="menuitem">Overview</a>
                    </li>
                  
                
                  
                    
                    <li role="presentation">
                    
                      <a href="/swift-evolution/" role="menuitem">Swift Evolution</a>
                    </li>
                  
                
                  
                    
                    <li role="presentation">
                    
                      <a href="/diversity/" role="menuitem">Diversity</a>
                    </li>
                  
                
                  
                    
                    <li role="presentation">
                    
                      <a href="/mentorship/" role="menuitem">Mentorship</a>
                    </li>
                  
                
                  
                    
                    <li role="presentation">
                    
                      <a href="/contributing/" role="menuitem">Contributing</a>
                    </li>
                  
                
                  
                  <li class="nav-section">Steering Groups</li>
                  
                
                  
                    
                    <li role="presentation">
                    
                      <a href="/language-steering-group/" role="menuitem">Language</a>
                    </li>
                  
                
                  
                    
                    <li role="presentation">
                    
                      <a href="/platform-steering-group/" role="menuitem">Platform</a>
                    </li>
                  
                
                  
                  <li class="nav-section">Workgroups</li>
                  
                
                  
                    
                    <li role="presentation">
                    
                      <a href="/contributor-experience-workgroup/" role="menuitem">Contributor Experience</a>
                    </li>
                  
                
                  
                    
                    <li role="presentation">
                    
                      <a href="/sswg/" role="menuitem">Server</a>
                    </li>
                  
                
                  
                    
                    <li role="presentation">
                    
                      <a href="/website/" role="menuitem">Website</a>
                    </li>
                  
                
                  
                    
                    <li role="presentation">
                    
                      <a href="/cxx-interop-workgroup/" role="menuitem">C++ Interoperability</a>
                    </li>
                  
                
                  
                    
                    <li role="presentation">
                    
                      <a href="/documentation-workgroup/" role="menuitem">Documentation</a>
                    </li>
                  
                
                  
                    
                    <li role="presentation">
                    
                      <a href="/foundation-workgroup/" role="menuitem">Foundation</a>
                    </li>
                  
                
                  
                  <li class="nav-section">Governance</li>
                  
                
                  
                    
                    <li role="presentation">
                    
                      <a href="/code-of-conduct/" role="menuitem">Code of Conduct</a>
                    </li>
                  
                
                  
                    
                    <li role="presentation">
                    
                      <a href="/legal/license.html" role="menuitem">License</a>
                    </li>
                  
                
                  
                    
                    <li role="presentation">
                    
                      <a href="/support/security.html" role="menuitem">Security</a>
                    </li>
                  
                
              </ul>
            
          </li>
        
          <li class="nav-item nav-cta">
            
              <a href="/install/" data-text="Install">Install</a>
            
            
          </li>
        
      </ul>
      <button id="menu-toggle" class="menu-item menu-toggle open" aria-expanded="false" aria-label="Toggle Navigation Menu"></button>
    </nav>
  </div>

  <nav class="mobile-navigation" role="navigation">
    <ul class="mobile-navigation-links">
      
        <li class="nav-item">
          <div class="link-container">
            
              <a href="/getting-started/">Get Started</a>
              

            
          </div>
          
        </li>
      
        <li class="nav-item">
          <div class="link-container">
            
              <a href="/blog/">Blog</a>
              

            
          </div>
          
        </li>
      
        <li class="nav-item">
          <div class="link-container">
            
              <a href="/documentation/">Documentation</a>
              

            
          </div>
          
        </li>
      
        <li class="nav-item">
          <div class="link-container">
            
              <a href="/packages/">Packages</a>
              

            
          </div>
          
        </li>
      
        <li class="nav-item">
          <div class="link-container">
            
              <a href="/tools/">Tools</a>
              

            
          </div>
          
        </li>
      
        <li class="nav-item">
          <div class="link-container">
            
              <a href="/community/">Community</a>
              

            
              <button class="section-toggle" aria-expanded="false" aria-label="Toggle Community Section">
                &#9663;
              </button>
            
          </div>
          
            <ul class="section-menu">
              
                
                  
                    <li>
                  
                    <a href="/community/">Overview</a>
                  </li>
                
              
                
                  
                    <li>
                  
                    <a href="/swift-evolution/">Swift Evolution</a>
                  </li>
                
              
                
                  
                    <li>
                  
                    <a href="/diversity/">Diversity</a>
                  </li>
                
              
                
                  
                    <li>
                  
                    <a href="/mentorship/">Mentorship</a>
                  </li>
                
              
                
                  
                    <li>
                  
                    <a href="/contributing/">Contributing</a>
                  </li>
                
              
                
                  <li class="nav-section">Steering Groups</li>
                
              
                
                  
                    <li>
                  
                    <a href="/language-steering-group/">Language</a>
                  </li>
                
              
                
                  
                    <li>
                  
                    <a href="/platform-steering-group/">Platform</a>
                  </li>
                
              
                
                  <li class="nav-section">Workgroups</li>
                
              
                
                  
                    <li>
                  
                    <a href="/contributor-experience-workgroup/">Contributor Experience</a>
                  </li>
                
              
                
                  
                    <li>
                  
                    <a href="/sswg/">Server</a>
                  </li>
                
              
                
                  
                    <li>
                  
                    <a href="/website/">Website</a>
                  </li>
                
              
                
                  
                    <li>
                  
                    <a href="/cxx-interop-workgroup/">C++ Interoperability</a>
                  </li>
                
              
                
                  
                    <li>
                  
                    <a href="/documentation-workgroup/">Documentation</a>
                  </li>
                
              
                
                  
                    <li>
                  
                    <a href="/foundation-workgroup/">Foundation</a>
                  </li>
                
              
                
                  <li class="nav-section">Governance</li>
                
              
                
                  
                    <li>
                  
                    <a href="/code-of-conduct/">Code of Conduct</a>
                  </li>
                
              
                
                  
                    <li>
                  
                    <a href="/legal/license.html">License</a>
                  </li>
                
              
                
                  
                    <li>
                  
                    <a href="/support/security.html">Security</a>
                  </li>
                
              
            </ul>
          
        </li>
      
        <li class="nav-item">
          <div class="link-container">
            
              <a href="/install/">Install</a>
              

            
          </div>
          
        </li>
      
    </ul>
  </nav>
 </header>

<main role="main">
<article class="post">
  <header>
    <h1>Swift Everywhere: Using Interoperability to Build on Windows</h1>

    <time pubdate datetime="2023-10-13T06:00:00-04:00">October 13, 2023</time>
    <div class="authors compact">
  
    
    
      <div class="author">
        <div class="byline">
          <img
            
              src="https://www.github.com/compnerd.png?size=64"
            
            alt="Saleem Abdulrasool"
            title="Saleem Abdulrasool is a member of the Swift Core Team and a Software Engineer at The Browser Company, and previously worked at Google Brain, Facebook, and Microsoft, and currently focuses on cross-platform and embedded Swift."
            />
          <span class="author">
            
              <a href="https://github.com/compnerd/" rel="nofollow" title="Saleem Abdulrasool (@compnerd) on GitHub">Saleem Abdulrasool</a>
            
          </span>
        </div>
        
      </div>
    
  
</div>
  </header>

  <p><em>This post was originally published at <a href="https://speakinginswift.substack.com/p/interoperability-swifts-super-power">Speaking in Swift by The Browser Company</a> under the title “Interoperability: Swift’s Super Power”.</em></p>

<hr />

<p>Swift’s deliberate design choices over the years has resulted in a language that showcases how flexibility and compatibility does not need to come at the cost of usability. One of these design choices was Swift’s focus on native interoperability with other languages. The flexibility that this enables makes it a joy to build rich, native experiences in Swift across a variety of environments.</p>

<p>Traditionally when two languages need to interoperate, the function calls at the boundary between the two languages, also known as the Foreign Function Interface (FFI), will go through C using a library like libffi. This approach has some drawbacks such as incurred runtime performance costs and possibly extra boilerplate code. Instead, Swift embeds a copy of clang, the C and C++ compiler, which is able to directly translate between the languages avoiding penalties in code size and runtime performance. This level of interoperability composes wonderfully with existing systems and enables building complex software atop existing C libraries.</p>

<h2 id="the-windows-api" class="header-with-anchor">The Windows API <a title="Permalink for The Windows API section" href="#the-windows-api">
            <?xml version="1.0" encoding="utf-8"?> <svg width="24px" height="24px" viewBox="0 0 14 14" role="img" focusable="false" aria-hidden="true" xmlns="http://www.w3.org/2000/svg"><path d="m 11.58824,9.823529 q 0,-0.294117 -0.20589,-0.499999 L 9.85294,7.794118 q -0.20588,-0.205883 -0.5,-0.205883 -0.30882,0 -0.52941,0.235295 0.0221,0.02206 0.13971,0.136029 0.11764,0.113971 0.15808,0.158088 0.0404,0.04412 0.1103,0.139706 0.0698,0.09559 0.0956,0.1875 0.0257,0.09191 0.0257,0.202206 0,0.294117 -0.20588,0.5 -0.20588,0.205882 -0.5,0.205882 -0.1103,0 -0.20221,-0.02573 Q 8.35293,9.301471 8.25733,9.231621 8.16173,9.161771 8.11763,9.121327 8.07353,9.080887 7.95954,8.963238 7.84557,8.845591 7.82351,8.823533 7.58086,9.051474 7.58086,9.360297 q 0,0.294118 0.20588,0.5 l 1.51471,1.522059 q 0.19853,0.19853 0.5,0.19853 0.29412,0 0.5,-0.191177 l 1.08088,-1.073529 q 0.20589,-0.205883 0.20589,-0.492648 z M 6.41912,4.639706 q 0,-0.294118 -0.20588,-0.5 L 4.69853,2.617647 q -0.20588,-0.205882 -0.5,-0.205882 -0.28677,0 -0.5,0.198529 L 2.61765,3.683823 q -0.20589,0.205883 -0.20589,0.492648 0,0.294117 0.20589,0.499999 l 1.52941,1.529412 q 0.19853,0.19853 0.5,0.19853 0.30882,0 0.52941,-0.227942 Q 5.15437,6.15441 5.03676,6.040441 4.91912,5.92647 4.87868,5.882353 4.83828,5.838233 4.76838,5.742647 q -0.0698,-0.09559 -0.0956,-0.1875 -0.0257,-0.09191 -0.0257,-0.202206 0,-0.294117 0.20588,-0.5 0.20588,-0.205882 0.5,-0.205882 0.1103,0 0.20221,0.02573 0.0919,0.02573 0.1875,0.09559 0.0956,0.06985 0.1397,0.110294 0.0441,0.04044 0.15809,0.158089 Q 6.15443,5.154409 6.17649,5.176467 6.41914,4.948526 6.41914,4.639703 z M 13,9.823529 q 0,0.882353 -0.625,1.492647 l -1.08088,1.07353 Q 10.68382,13 9.80147,13 q -0.88971,0 -1.5,-0.625 L 6.78676,10.852941 Q 6.17647,10.242647 6.17647,9.360294 q 0,-0.904412 0.64706,-1.536764 L 6.17647,7.176471 Q 5.54412,7.82353 4.64706,7.82353 q -0.88235,0 -1.5,-0.617648 L 1.617647,5.676471 Q 1,5.058824 1,4.176471 1,3.294118 1.625,2.683824 L 2.70588,1.610294 Q 3.31618,1 4.19853,1 q 0.88971,0 1.5,0.625 l 1.51471,1.522059 q 0.61029,0.610294 0.61029,1.492647 0,0.904412 -0.64706,1.536764 L 7.82353,6.823529 Q 8.45588,6.17647 9.35294,6.17647 q 0.88235,0 1.5,0.617648 l 1.52941,1.529411 Q 13,8.941176 13,9.823529 z"/></svg>
          </a></h2>

<p>When building native rich, native applications, one important use-case of interoperability is the ability to invoke platform-specific APIs. The Windows API surface reflects its extensive history; the requirement to maintain backwards compatibility has resulted in the accretion of APIs of different shapes. As such, a significant portion of the API is old and low-level enough to be defined in C.</p>

<p>Since Swift uses clang rather than libffi to access C functions and data types, the Swift compiler uses a feature of clang known as (header) modules. Clang modules bundle a set of declarations together, identifying which declarations belong to a particular library, what other modules it may depend on, and what language the declarations are for. This is done by introducing an auxiliary file named <code class="language-plaintext highlighter-rouge">module.modulemap</code> which contains the definition of the module.</p>

<p>As such, to access the Windows APIs, we must modularize the Windows SDK into one or more clang modules. Fortunately this is not just a theoretical idea. The Swift toolchain contains a module definition for the Windows SDK in the form of the <code class="language-plaintext highlighter-rouge">WinSDK</code> clang module. To further refine these definitions, a Swift module overlays the clang definitions to provide more Swift friendly definitions in some cases. This exposes the C API surface area of the Windows SDK, and although does not contain all the more modern APIs, enables us to build a variety of command line and GUI apps on Windows.</p>

<p><img src="/assets/images/windows-interoperability-blog/swift-win32-gui-app.webp" alt="A screenshot of a GUI application written using Swift/Win32, showing various standard controls" style="max-width: 100%; height: auto; width: unset; margin: auto auto; display: block;" />
<em>A GUI application using Swift/Win32, which provides a layer of Swift syntactic conveniences for older, C-based Windows UI APIs.</em></p>

<p>Modern APIs aren’t exposed using just C, however, and there are large portions of the Windows SDK which are exposed as C++. Realising there is a vast software ecosystem of C++ code that Swift developers may want access to, Swift 5.9 has introduced support for extending its language level interoperability to C++. Although virtual methods and copyable types are not yet available, as Swift’s C++ interoperability matures, the native platform API surface available to Swift will also grow to include the majority of the C++ APIs in the Windows SDK.</p>

<p>This C++ Interop enables a new set of libraries, beyond just the platform APIs, to become available to Swift.  This allows Swift code to also take advantage of a variety of high-performance, cross-platform libraries written over decades by the C++ community. Firebase, for example, is a commonly used cloud computing service and is used in many modern products, including The Browser Company’s browser, Arc. Although there is a Swift SDK for Firebase, it is limited to the Apple platforms and is based on Objective-C. However, there is also a cross-platform C++ SDK available. Now with C++ Interop, it is possible to expose this C++ SDK to Swift clients. Such a bridge is being built up with <a href="https://github.com/compnerd/swift-firebase">swift-firebase</a>. Taking advantage of these C++ libraries cross-platform Swift software that would be difficult to build otherwise.</p>

<h2 id="component-object-model-com" class="header-with-anchor">Component Object Model (COM) <a title="Permalink for Component Object Model (COM) section" href="#component-object-model-com">
            <?xml version="1.0" encoding="utf-8"?> <svg width="24px" height="24px" viewBox="0 0 14 14" role="img" focusable="false" aria-hidden="true" xmlns="http://www.w3.org/2000/svg"><path d="m 11.58824,9.823529 q 0,-0.294117 -0.20589,-0.499999 L 9.85294,7.794118 q -0.20588,-0.205883 -0.5,-0.205883 -0.30882,0 -0.52941,0.235295 0.0221,0.02206 0.13971,0.136029 0.11764,0.113971 0.15808,0.158088 0.0404,0.04412 0.1103,0.139706 0.0698,0.09559 0.0956,0.1875 0.0257,0.09191 0.0257,0.202206 0,0.294117 -0.20588,0.5 -0.20588,0.205882 -0.5,0.205882 -0.1103,0 -0.20221,-0.02573 Q 8.35293,9.301471 8.25733,9.231621 8.16173,9.161771 8.11763,9.121327 8.07353,9.080887 7.95954,8.963238 7.84557,8.845591 7.82351,8.823533 7.58086,9.051474 7.58086,9.360297 q 0,0.294118 0.20588,0.5 l 1.51471,1.522059 q 0.19853,0.19853 0.5,0.19853 0.29412,0 0.5,-0.191177 l 1.08088,-1.073529 q 0.20589,-0.205883 0.20589,-0.492648 z M 6.41912,4.639706 q 0,-0.294118 -0.20588,-0.5 L 4.69853,2.617647 q -0.20588,-0.205882 -0.5,-0.205882 -0.28677,0 -0.5,0.198529 L 2.61765,3.683823 q -0.20589,0.205883 -0.20589,0.492648 0,0.294117 0.20589,0.499999 l 1.52941,1.529412 q 0.19853,0.19853 0.5,0.19853 0.30882,0 0.52941,-0.227942 Q 5.15437,6.15441 5.03676,6.040441 4.91912,5.92647 4.87868,5.882353 4.83828,5.838233 4.76838,5.742647 q -0.0698,-0.09559 -0.0956,-0.1875 -0.0257,-0.09191 -0.0257,-0.202206 0,-0.294117 0.20588,-0.5 0.20588,-0.205882 0.5,-0.205882 0.1103,0 0.20221,0.02573 0.0919,0.02573 0.1875,0.09559 0.0956,0.06985 0.1397,0.110294 0.0441,0.04044 0.15809,0.158089 Q 6.15443,5.154409 6.17649,5.176467 6.41914,4.948526 6.41914,4.639703 z M 13,9.823529 q 0,0.882353 -0.625,1.492647 l -1.08088,1.07353 Q 10.68382,13 9.80147,13 q -0.88971,0 -1.5,-0.625 L 6.78676,10.852941 Q 6.17647,10.242647 6.17647,9.360294 q 0,-0.904412 0.64706,-1.536764 L 6.17647,7.176471 Q 5.54412,7.82353 4.64706,7.82353 q -0.88235,0 -1.5,-0.617648 L 1.617647,5.676471 Q 1,5.058824 1,4.176471 1,3.294118 1.625,2.683824 L 2.70588,1.610294 Q 3.31618,1 4.19853,1 q 0.88971,0 1.5,0.625 l 1.51471,1.522059 q 0.61029,0.610294 0.61029,1.492647 0,0.904412 -0.64706,1.536764 L 7.82353,6.823529 Q 8.45588,6.17647 9.35294,6.17647 q 0.88235,0 1.5,0.617648 l 1.52941,1.529411 Q 13,8.941176 13,9.823529 z"/></svg>
          </a></h2>

<p>While libraries are one mechanism for sharing code, they are not the only approach. Another style of code sharing is possible via inter-process communication (IPC), which allows two separate applications to communicate with each other and expose functionality to each other. One implementation of this technique that is prevalent on Windows is known as COM (Component Object Model).</p>

<p>Microsoft explored this idea at a higher level in 1990, evolving DDE (Dynamic Data Exchange) into “Object Linking and Embedding” or OLE. The approach was to enable sharing of custom document handlers which could be embedded into new applications without having to rewrite parsers and renders for the formats. To share the implementation of applications across processes, an application could implement well-defined interfaces (e.g. <code class="language-plaintext highlighter-rouge">IOleObject</code>) that could be consumed by other processes. Eventually, OLE would evolve into what would become to be known as the Component Object Model, or COM.</p>

<p>COM’s design was flexible and powerful, and resulted in it being adopted as a common design pattern across a multitude of environments. CoreFoundation adopted it for its plugin model. CFLite, and various forks thereof, brought an implementation of COM to Linux. XPCOM (Cross-Platform Component Object Model) is similar to COM and would gain popularity through Mozilla’s extensive usage, as would Open Office’s UNO technology. The model even found its way into driver development with the IOKit framework using a COM based model for kernel drivers.</p>

<p>At COM’s core is the idea of defining interfaces (which is normally done in the Interface Definition Language or IDL) that expose functionality to either through a library in the same address space or another process through IPC. Interfaces are identified by globally unique Interface IDs, and all inherit from a base interface called <code class="language-plaintext highlighter-rouge">IUnknown</code>. <code class="language-plaintext highlighter-rouge">IUnknown</code> exposes the two fundamental operations of COM:</p>

<ol>
  <li>object lifetime management</li>
  <li>access to the object’s functionality</li>
</ol>

<p>Similar to Swift, object lifetime management is implemented through reference counting, exposed in COM via the <code class="language-plaintext highlighter-rouge">AddRef</code> and <code class="language-plaintext highlighter-rouge">Release</code> methods. Access to the object’s functionality is implemented via the <code class="language-plaintext highlighter-rouge">QueryInterface</code> method, allowing consumers to dynamically request for the object’s functionality. Because consumers dynamically query for a specific COM interface, we cannot statically identify the operations at build time. But the cost is limited to a couple of pointer indirections, similar to C++’s virtual methods, which gives COM a negligible performance overhead.</p>

<h2 id="com-support-in-swift-with-c-interop" class="header-with-anchor">COM Support in Swift with C Interop <a title="Permalink for COM Support in Swift with C Interop section" href="#com-support-in-swift-with-c-interop">
            <?xml version="1.0" encoding="utf-8"?> <svg width="24px" height="24px" viewBox="0 0 14 14" role="img" focusable="false" aria-hidden="true" xmlns="http://www.w3.org/2000/svg"><path d="m 11.58824,9.823529 q 0,-0.294117 -0.20589,-0.499999 L 9.85294,7.794118 q -0.20588,-0.205883 -0.5,-0.205883 -0.30882,0 -0.52941,0.235295 0.0221,0.02206 0.13971,0.136029 0.11764,0.113971 0.15808,0.158088 0.0404,0.04412 0.1103,0.139706 0.0698,0.09559 0.0956,0.1875 0.0257,0.09191 0.0257,0.202206 0,0.294117 -0.20588,0.5 -0.20588,0.205882 -0.5,0.205882 -0.1103,0 -0.20221,-0.02573 Q 8.35293,9.301471 8.25733,9.231621 8.16173,9.161771 8.11763,9.121327 8.07353,9.080887 7.95954,8.963238 7.84557,8.845591 7.82351,8.823533 7.58086,9.051474 7.58086,9.360297 q 0,0.294118 0.20588,0.5 l 1.51471,1.522059 q 0.19853,0.19853 0.5,0.19853 0.29412,0 0.5,-0.191177 l 1.08088,-1.073529 q 0.20589,-0.205883 0.20589,-0.492648 z M 6.41912,4.639706 q 0,-0.294118 -0.20588,-0.5 L 4.69853,2.617647 q -0.20588,-0.205882 -0.5,-0.205882 -0.28677,0 -0.5,0.198529 L 2.61765,3.683823 q -0.20589,0.205883 -0.20589,0.492648 0,0.294117 0.20589,0.499999 l 1.52941,1.529412 q 0.19853,0.19853 0.5,0.19853 0.30882,0 0.52941,-0.227942 Q 5.15437,6.15441 5.03676,6.040441 4.91912,5.92647 4.87868,5.882353 4.83828,5.838233 4.76838,5.742647 q -0.0698,-0.09559 -0.0956,-0.1875 -0.0257,-0.09191 -0.0257,-0.202206 0,-0.294117 0.20588,-0.5 0.20588,-0.205882 0.5,-0.205882 0.1103,0 0.20221,0.02573 0.0919,0.02573 0.1875,0.09559 0.0956,0.06985 0.1397,0.110294 0.0441,0.04044 0.15809,0.158089 Q 6.15443,5.154409 6.17649,5.176467 6.41914,4.948526 6.41914,4.639703 z M 13,9.823529 q 0,0.882353 -0.625,1.492647 l -1.08088,1.07353 Q 10.68382,13 9.80147,13 q -0.88971,0 -1.5,-0.625 L 6.78676,10.852941 Q 6.17647,10.242647 6.17647,9.360294 q 0,-0.904412 0.64706,-1.536764 L 6.17647,7.176471 Q 5.54412,7.82353 4.64706,7.82353 q -0.88235,0 -1.5,-0.617648 L 1.617647,5.676471 Q 1,5.058824 1,4.176471 1,3.294118 1.625,2.683824 L 2.70588,1.610294 Q 3.31618,1 4.19853,1 q 0.88971,0 1.5,0.625 l 1.51471,1.522059 q 0.61029,0.610294 0.61029,1.492647 0,0.904412 -0.64706,1.536764 L 7.82353,6.823529 Q 8.45588,6.17647 9.35294,6.17647 q 0.88235,0 1.5,0.617648 l 1.52941,1.529411 Q 13,8.941176 13,9.823529 z"/></svg>
          </a></h2>

<p>COM provides not only an interface for working with software dynamically but is also an Application Binary Interface, or ABI, which means it defines how parameters are passed and function calls are arranged. If we want to communicate with COM interfaces from Swift, we need to ensure that we conform to these ABI requirements. Given that the lingua franca for FFI is C, the ABI for COM can be expressed in C. So, as a first step, what does <code class="language-plaintext highlighter-rouge">IUnknown</code> look like in C?</p>

<div class="language-c highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">typedef</span> <span class="k">struct</span> <span class="n">IUnknownVtbl</span> <span class="p">{</span>
  <span class="n">ULONG</span> <span class="p">(</span><span class="n">STDMETHODCALLTYPE</span> <span class="o">*</span><span class="n">AddRef</span><span class="p">)(</span><span class="n">IUnknown</span> <span class="o">*</span><span class="n">pUnk</span><span class="p">);</span>
  <span class="n">ULONG</span> <span class="p">(</span><span class="n">STDMETHODCALLTYPE</span> <span class="o">*</span><span class="n">Release</span><span class="p">)(</span><span class="n">IUnknown</span> <span class="o">*</span><span class="n">pUnk</span><span class="p">);</span>
  <span class="n">HRESULT</span> <span class="p">(</span><span class="n">STDMETHODCALLTYPE</span> <span class="o">*</span><span class="n">QueryInterface</span><span class="p">)(</span><span class="n">IUnknown</span> <span class="o">*</span><span class="n">pUnk</span><span class="p">,</span> <span class="n">REFIID</span> <span class="n">riid</span><span class="p">,</span> <span class="kt">void</span> <span class="o">**</span><span class="n">ppvObject</span><span class="p">);</span>
<span class="p">}</span> <span class="n">IUnknownVtbl</span><span class="p">;</span>

<span class="k">struct</span> <span class="n">IUnknown</span> <span class="p">{</span>
    <span class="k">const</span> <span class="k">struct</span> <span class="n">IUnknownVtbl</span> <span class="o">*</span><span class="n">lpVtbl</span><span class="p">;</span>
<span class="p">}</span> <span class="n">IUnknown</span><span class="p">;</span>
</code></pre></div></div>

<p>If we were to describe this in Swift, we would expect this to be a protocol with a few constraints:</p>

<div class="language-swift highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">// typealias IID = WinSDK._GUID</span>

<span class="kd">public</span> <span class="kd">typealias</span> <span class="kt">REFIID</span> <span class="o">=</span> <span class="kt">UnsafePointer</span><span class="o">&lt;</span><span class="kt">IID</span><span class="o">&gt;</span>

<span class="kd">public</span> <span class="kd">protocol</span> <span class="kt">IUnknown</span><span class="p">:</span> <span class="kd">class</span> <span class="p">{</span>
  <span class="kd">class</span> <span class="k">var</span> <span class="nv">IID</span><span class="p">:</span> <span class="kt">IID</span> <span class="p">{</span> <span class="k">get</span> <span class="p">}</span>

  <span class="kd">func</span> <span class="kt">AddRef</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="kt">ULONG</span>
  <span class="kd">func</span> <span class="kt">Release</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="kt">ULONG</span>
  <span class="kd">func</span> <span class="kt">QueryInterface</span><span class="p">(</span><span class="n">_</span> <span class="nv">riid</span><span class="p">:</span> <span class="kt">REFIID</span><span class="p">,</span> <span class="n">_</span> <span class="nv">ppvObject</span><span class="p">:</span> <span class="kt">UnsafeMutablePointer</span><span class="o">&lt;</span><span class="kt">UnsafeMutableRawPointer</span><span class="p">?</span><span class="o">&gt;</span><span class="p">?)</span> <span class="o">-&gt;</span> <span class="kt">HRESULT</span>
<span class="p">}</span>

<span class="kd">extension</span> <span class="kt">IUnknown</span> <span class="p">{</span>
  <span class="kd">func</span> <span class="kt">QueryInterface</span><span class="o">&lt;</span><span class="kt">Interface</span><span class="p">:</span> <span class="kt">IUnknown</span><span class="o">&gt;</span><span class="p">()</span> <span class="k">throws</span> <span class="o">-&gt;</span> <span class="kt">Interface</span><span class="p">?</span> <span class="p">{</span> <span class="err">…</span> <span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div>

<p>The <code class="language-plaintext highlighter-rouge">: class</code> on the protocol declaration adds a class-constraint on the protocol, indicating that any conforming type must be a class in Swift. The astute reader would spot the semantic parallels between <code class="language-plaintext highlighter-rouge">IUnknown</code> and class-constrained types in Swift. <code class="language-plaintext highlighter-rouge">class</code> types in Swift employ reference counting through ARC, and COM does the same through MRC (manual reference counting), which explains the <code class="language-plaintext highlighter-rouge">AddRef</code> and <code class="language-plaintext highlighter-rouge">Release</code> methods. That leaves the <code class="language-plaintext highlighter-rouge">QueryInterface</code> method which is responsible for dynamically querying the COM Interface, which maps to Swift’s casting operation. As it is not possible to provide a custom cast operation for a type in Swift, the <code class="language-plaintext highlighter-rouge">QueryInterface()</code> method is a funny spelling for the as keyword. This shows that, conceptually, <code class="language-plaintext highlighter-rouge">IUnknown</code> is just another way to say “I have a class type in Swift that is implemented somewhere else”!</p>

<p>Since COM concepts bridge so neatly to Swift, we can now build a bridge between COM and Swift. The associated code is available at <a href="https://github.com/compnerd/swift-com">Swift/COM</a> and demonstrates the viability of interfacing with COM interfaces. As an example, Windows provides 3D acceleration through the DirectX APIs, which are exposed as a set of C++ and COM interfaces. <a href="https://github.com/compnerd/DXSample">DXSample</a> uses the COM bridged interfaces to implement a 3D accelerated cube replete with shaders to demonstrate that this bridging is possible to accomplish and use in real world scenarios.</p>

<p>Interfaces provide a definition of how you interact with some foreign type, one that may even be implemented in a different language. When using an interface implemented by someone else, such as a DirectX type, we receive a raw pointer to <code class="language-plaintext highlighter-rouge">IUnknown</code>. The raw pointer representation of the COM interface is cumbersome to use. Wrapping the pointer to abstract the indirection makes COM more approachable.</p>

<div class="language-swift highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">open</span> <span class="kd">class</span> <span class="kt">ID3D12Object</span><span class="p">:</span> <span class="kt">IUnknown</span> <span class="p">{</span>
  <span class="kd">public</span> <span class="k">override</span> <span class="kd">class</span> <span class="k">var</span> <span class="nv">IID</span><span class="p">:</span> <span class="kt">IID</span> <span class="p">{</span> <span class="kt">IID_ID3D12Object</span> <span class="p">}</span>

  <span class="kd">public</span> <span class="kd">func</span> <span class="kt">SetName</span><span class="p">(</span><span class="n">_</span> <span class="kt">Name</span><span class="p">:</span> <span class="kt">String</span><span class="p">)</span> <span class="k">throws</span> <span class="p">{</span>
    <span class="n">_</span> <span class="o">=</span> <span class="k">try</span> <span class="nf">perform</span><span class="p">(</span><span class="nv">as</span><span class="p">:</span> <span class="kt">WinSDK</span><span class="o">.</span><span class="kt">ID3D12Object</span><span class="o">.</span><span class="k">self</span><span class="p">)</span> <span class="p">{</span> <span class="n">pThis</span> <span class="k">in</span>
      <span class="k">try</span> <span class="kt">CHECKED</span><span class="p">(</span><span class="n">pThis</span><span class="o">.</span><span class="n">pointee</span><span class="o">.</span><span class="n">lpVtbl</span><span class="o">.</span><span class="n">pointee</span><span class="o">.</span><span class="kt">SetName</span><span class="p">(</span><span class="n">pThis</span><span class="p">,</span> <span class="nv">$0</span><span class="p">))</span>
    <span class="p">}</span>
  <span class="p">}</span>
  <span class="err">…</span>
<span class="p">}</span>
</code></pre></div></div>

<p>It is also possible to implement a COM interface in Swift, providing a Swift implementation that can be called from C/C++ code even, although this support is nascent and will evolve with Swift’s C++ interoperability support. As COM has a strict ABI, once the object is constructed properly, it can easily be passed across the language boundary and, as such, a Swift type can easily be passed to any COM client.</p>

<h2 id="com-support-in-swift-with-c-interop-1" class="header-with-anchor">COM Support in Swift with C++ Interop <a title="Permalink for COM Support in Swift with C++ Interop section" href="#com-support-in-swift-with-c-interop-1">
            <?xml version="1.0" encoding="utf-8"?> <svg width="24px" height="24px" viewBox="0 0 14 14" role="img" focusable="false" aria-hidden="true" xmlns="http://www.w3.org/2000/svg"><path d="m 11.58824,9.823529 q 0,-0.294117 -0.20589,-0.499999 L 9.85294,7.794118 q -0.20588,-0.205883 -0.5,-0.205883 -0.30882,0 -0.52941,0.235295 0.0221,0.02206 0.13971,0.136029 0.11764,0.113971 0.15808,0.158088 0.0404,0.04412 0.1103,0.139706 0.0698,0.09559 0.0956,0.1875 0.0257,0.09191 0.0257,0.202206 0,0.294117 -0.20588,0.5 -0.20588,0.205882 -0.5,0.205882 -0.1103,0 -0.20221,-0.02573 Q 8.35293,9.301471 8.25733,9.231621 8.16173,9.161771 8.11763,9.121327 8.07353,9.080887 7.95954,8.963238 7.84557,8.845591 7.82351,8.823533 7.58086,9.051474 7.58086,9.360297 q 0,0.294118 0.20588,0.5 l 1.51471,1.522059 q 0.19853,0.19853 0.5,0.19853 0.29412,0 0.5,-0.191177 l 1.08088,-1.073529 q 0.20589,-0.205883 0.20589,-0.492648 z M 6.41912,4.639706 q 0,-0.294118 -0.20588,-0.5 L 4.69853,2.617647 q -0.20588,-0.205882 -0.5,-0.205882 -0.28677,0 -0.5,0.198529 L 2.61765,3.683823 q -0.20589,0.205883 -0.20589,0.492648 0,0.294117 0.20589,0.499999 l 1.52941,1.529412 q 0.19853,0.19853 0.5,0.19853 0.30882,0 0.52941,-0.227942 Q 5.15437,6.15441 5.03676,6.040441 4.91912,5.92647 4.87868,5.882353 4.83828,5.838233 4.76838,5.742647 q -0.0698,-0.09559 -0.0956,-0.1875 -0.0257,-0.09191 -0.0257,-0.202206 0,-0.294117 0.20588,-0.5 0.20588,-0.205882 0.5,-0.205882 0.1103,0 0.20221,0.02573 0.0919,0.02573 0.1875,0.09559 0.0956,0.06985 0.1397,0.110294 0.0441,0.04044 0.15809,0.158089 Q 6.15443,5.154409 6.17649,5.176467 6.41914,4.948526 6.41914,4.639703 z M 13,9.823529 q 0,0.882353 -0.625,1.492647 l -1.08088,1.07353 Q 10.68382,13 9.80147,13 q -0.88971,0 -1.5,-0.625 L 6.78676,10.852941 Q 6.17647,10.242647 6.17647,9.360294 q 0,-0.904412 0.64706,-1.536764 L 6.17647,7.176471 Q 5.54412,7.82353 4.64706,7.82353 q -0.88235,0 -1.5,-0.617648 L 1.617647,5.676471 Q 1,5.058824 1,4.176471 1,3.294118 1.625,2.683824 L 2.70588,1.610294 Q 3.31618,1 4.19853,1 q 0.88971,0 1.5,0.625 l 1.51471,1.522059 q 0.61029,0.610294 0.61029,1.492647 0,0.904412 -0.64706,1.536764 L 7.82353,6.823529 Q 8.45588,6.17647 9.35294,6.17647 q 0.88235,0 1.5,0.617648 l 1.52941,1.529411 Q 13,8.941176 13,9.823529 z"/></svg>
          </a></h2>

<p>The evolving C++ interop in Swift makes bridging COM to Swift simpler. The interface model in COM is very similar to classes in C++. A COM interface maps directly to a C++ class, and each function on a COM interface maps to a virtual method on the C++ type. For Windows APIs exposed as COM types, such as the DirectX APIs, the COM interfaces are primarily exposed as C++ classes with some optionality to get a C representation of the interface for bridging into other languages. As Swift’s C++ interoperability support improves, it will be possible to import COM interfaces as C++ classes which bridge naturally to Swift types. This reduces the boilerplate we saw above when bridging to COM through C. As of this writing, Swift’s C++ interop support for virtual method dispatch is under development and will soon be able to simplify COM access.</p>

<p>Swift’s work on C++ interoperability has helped our efforts to bridge Swift with COM in other ways as well, adding support for reference-counted foreign types in Swift with the <code class="language-plaintext highlighter-rouge">SWIFT_SHARED_REFERENCE</code> annotation. Because COM provides a reference counted interface, we can attribute COM interfaces with <code class="language-plaintext highlighter-rouge">SWIFT_SHARED_REFERENCE</code> to take advantage of ARC while importing types and get memory management for free, avoiding a class of memory safety issues.</p>

<h2 id="improving-swift-language-support-for-com" class="header-with-anchor">Improving Swift Language Support for COM <a title="Permalink for Improving Swift Language Support for COM section" href="#improving-swift-language-support-for-com">
            <?xml version="1.0" encoding="utf-8"?> <svg width="24px" height="24px" viewBox="0 0 14 14" role="img" focusable="false" aria-hidden="true" xmlns="http://www.w3.org/2000/svg"><path d="m 11.58824,9.823529 q 0,-0.294117 -0.20589,-0.499999 L 9.85294,7.794118 q -0.20588,-0.205883 -0.5,-0.205883 -0.30882,0 -0.52941,0.235295 0.0221,0.02206 0.13971,0.136029 0.11764,0.113971 0.15808,0.158088 0.0404,0.04412 0.1103,0.139706 0.0698,0.09559 0.0956,0.1875 0.0257,0.09191 0.0257,0.202206 0,0.294117 -0.20588,0.5 -0.20588,0.205882 -0.5,0.205882 -0.1103,0 -0.20221,-0.02573 Q 8.35293,9.301471 8.25733,9.231621 8.16173,9.161771 8.11763,9.121327 8.07353,9.080887 7.95954,8.963238 7.84557,8.845591 7.82351,8.823533 7.58086,9.051474 7.58086,9.360297 q 0,0.294118 0.20588,0.5 l 1.51471,1.522059 q 0.19853,0.19853 0.5,0.19853 0.29412,0 0.5,-0.191177 l 1.08088,-1.073529 q 0.20589,-0.205883 0.20589,-0.492648 z M 6.41912,4.639706 q 0,-0.294118 -0.20588,-0.5 L 4.69853,2.617647 q -0.20588,-0.205882 -0.5,-0.205882 -0.28677,0 -0.5,0.198529 L 2.61765,3.683823 q -0.20589,0.205883 -0.20589,0.492648 0,0.294117 0.20589,0.499999 l 1.52941,1.529412 q 0.19853,0.19853 0.5,0.19853 0.30882,0 0.52941,-0.227942 Q 5.15437,6.15441 5.03676,6.040441 4.91912,5.92647 4.87868,5.882353 4.83828,5.838233 4.76838,5.742647 q -0.0698,-0.09559 -0.0956,-0.1875 -0.0257,-0.09191 -0.0257,-0.202206 0,-0.294117 0.20588,-0.5 0.20588,-0.205882 0.5,-0.205882 0.1103,0 0.20221,0.02573 0.0919,0.02573 0.1875,0.09559 0.0956,0.06985 0.1397,0.110294 0.0441,0.04044 0.15809,0.158089 Q 6.15443,5.154409 6.17649,5.176467 6.41914,4.948526 6.41914,4.639703 z M 13,9.823529 q 0,0.882353 -0.625,1.492647 l -1.08088,1.07353 Q 10.68382,13 9.80147,13 q -0.88971,0 -1.5,-0.625 L 6.78676,10.852941 Q 6.17647,10.242647 6.17647,9.360294 q 0,-0.904412 0.64706,-1.536764 L 6.17647,7.176471 Q 5.54412,7.82353 4.64706,7.82353 q -0.88235,0 -1.5,-0.617648 L 1.617647,5.676471 Q 1,5.058824 1,4.176471 1,3.294118 1.625,2.683824 L 2.70588,1.610294 Q 3.31618,1 4.19853,1 q 0.88971,0 1.5,0.625 l 1.51471,1.522059 q 0.61029,0.610294 0.61029,1.492647 0,0.904412 -0.64706,1.536764 L 7.82353,6.823529 Q 8.45588,6.17647 9.35294,6.17647 q 0.88235,0 1.5,0.617648 l 1.52941,1.529411 Q 13,8.941176 13,9.823529 z"/></svg>
          </a></h2>

<p>Due to the current limitations with C++ interop, we must fallback to the common denominator for interop - C - when trying to bridge COM interfaces. When implementing wrapper types to work with COM interfaces, we notice that it requires a significant amount of boilerplate code. One of Swift’s goals is to have clear, expressive code and this certainly takes away from that. An idea that merits a proper evolution proposal is extending the Swift language to support COM better through annotations. Imagine being able to declare a type as being accessible to COM by simply annotating it with an attribute as the follows:</p>

<div class="language-swift highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">@COM</span><span class="p">(</span><span class="kt">IID</span><span class="p">:</span> <span class="kt">IID_ICustomInterface</span><span class="p">,</span> <span class="kt">CLSID</span><span class="p">:</span> <span class="kt">CLSID_CustomInterface</span><span class="p">)</span>
<span class="kd">open</span> <span class="kd">class</span> <span class="kt">CCustomInterface</span><span class="p">:</span> <span class="kt">ICustomInterface</span> <span class="p">{</span>
  <span class="k">override</span> <span class="kd">open</span> <span class="kd">func</span> <span class="kt">QueryInterface</span><span class="o">&lt;</span><span class="kt">Interface</span><span class="p">:</span> <span class="kt">IUnknown</span><span class="o">&gt;</span><span class="p">()</span> <span class="k">throws</span> <span class="o">-&gt;</span> <span class="kt">Interface</span><span class="p">?</span> <span class="p">{</span>
    <span class="k">switch</span> <span class="n">riid</span><span class="o">.</span><span class="n">pointee</span> <span class="p">{</span>
    <span class="k">case</span> <span class="kt">IID_ICustomInterface</span><span class="p">,</span> <span class="kt">IID_IUnknown</span><span class="p">:</span>
      <span class="k">return</span> <span class="kt">Unmanaged</span><span class="o">&lt;</span><span class="k">Self</span><span class="o">&gt;.</span><span class="nf">passRetained</span><span class="p">(</span><span class="k">self</span><span class="p">)</span>
    <span class="k">default</span><span class="p">:</span>
      <span class="k">return</span> <span class="kc">nil</span>
    <span class="p">}</span>
  <span class="p">}</span>
  <span class="err">…</span>
<span class="p">}</span>
</code></pre></div></div>

<p>Swift macros could help alleviate some of this boilerplate, but in order to truly bridge the Swift type into COM, the object layout needs to be considered. Because COM is an ABI, how the object is represented in memory must be identical to that dictated by COM. Controlling the object layout impacts ABI and is not something that would be possible with macros alone. One way we could implement this COM attribute at the language level would be to add a tear-off entry to the object that would conform to the ABI requirements for COM as part of the Swift object layout (with an opt-in) enabling more transparent bridging to the system without having to manually re-construct the vtable.</p>

<p>Swift’s ongoing distributed actors work also aligns well with COM. Distributed COM (DCOM) allows for network transparency with COM objects and enables building robust distributed systems. Distributed actors do not mandate the wire format, which means that we could even re-use the standard wire protocol for DCOM (DCE/RPC). This would allow for native Swift applications on Windows to easily scale from command line applications to large scale distributed systems.</p>

<h2 id="interoperability-on-windows" class="header-with-anchor">Interoperability on Windows <a title="Permalink for Interoperability on Windows section" href="#interoperability-on-windows">
            <?xml version="1.0" encoding="utf-8"?> <svg width="24px" height="24px" viewBox="0 0 14 14" role="img" focusable="false" aria-hidden="true" xmlns="http://www.w3.org/2000/svg"><path d="m 11.58824,9.823529 q 0,-0.294117 -0.20589,-0.499999 L 9.85294,7.794118 q -0.20588,-0.205883 -0.5,-0.205883 -0.30882,0 -0.52941,0.235295 0.0221,0.02206 0.13971,0.136029 0.11764,0.113971 0.15808,0.158088 0.0404,0.04412 0.1103,0.139706 0.0698,0.09559 0.0956,0.1875 0.0257,0.09191 0.0257,0.202206 0,0.294117 -0.20588,0.5 -0.20588,0.205882 -0.5,0.205882 -0.1103,0 -0.20221,-0.02573 Q 8.35293,9.301471 8.25733,9.231621 8.16173,9.161771 8.11763,9.121327 8.07353,9.080887 7.95954,8.963238 7.84557,8.845591 7.82351,8.823533 7.58086,9.051474 7.58086,9.360297 q 0,0.294118 0.20588,0.5 l 1.51471,1.522059 q 0.19853,0.19853 0.5,0.19853 0.29412,0 0.5,-0.191177 l 1.08088,-1.073529 q 0.20589,-0.205883 0.20589,-0.492648 z M 6.41912,4.639706 q 0,-0.294118 -0.20588,-0.5 L 4.69853,2.617647 q -0.20588,-0.205882 -0.5,-0.205882 -0.28677,0 -0.5,0.198529 L 2.61765,3.683823 q -0.20589,0.205883 -0.20589,0.492648 0,0.294117 0.20589,0.499999 l 1.52941,1.529412 q 0.19853,0.19853 0.5,0.19853 0.30882,0 0.52941,-0.227942 Q 5.15437,6.15441 5.03676,6.040441 4.91912,5.92647 4.87868,5.882353 4.83828,5.838233 4.76838,5.742647 q -0.0698,-0.09559 -0.0956,-0.1875 -0.0257,-0.09191 -0.0257,-0.202206 0,-0.294117 0.20588,-0.5 0.20588,-0.205882 0.5,-0.205882 0.1103,0 0.20221,0.02573 0.0919,0.02573 0.1875,0.09559 0.0956,0.06985 0.1397,0.110294 0.0441,0.04044 0.15809,0.158089 Q 6.15443,5.154409 6.17649,5.176467 6.41914,4.948526 6.41914,4.639703 z M 13,9.823529 q 0,0.882353 -0.625,1.492647 l -1.08088,1.07353 Q 10.68382,13 9.80147,13 q -0.88971,0 -1.5,-0.625 L 6.78676,10.852941 Q 6.17647,10.242647 6.17647,9.360294 q 0,-0.904412 0.64706,-1.536764 L 6.17647,7.176471 Q 5.54412,7.82353 4.64706,7.82353 q -0.88235,0 -1.5,-0.617648 L 1.617647,5.676471 Q 1,5.058824 1,4.176471 1,3.294118 1.625,2.683824 L 2.70588,1.610294 Q 3.31618,1 4.19853,1 q 0.88971,0 1.5,0.625 l 1.51471,1.522059 q 0.61029,0.610294 0.61029,1.492647 0,0.904412 -0.64706,1.536764 L 7.82353,6.823529 Q 8.45588,6.17647 9.35294,6.17647 q 0.88235,0 1.5,0.617648 l 1.52941,1.529411 Q 13,8.941176 13,9.823529 z"/></svg>
          </a></h2>

<p>Swift’s arsenal of interoperability tools makes it a potent language for building rich, native applications and libraries on existing platforms, and provides a great alternative to C and C++ with its improved memory safety and ergonomics. On Windows particularly, the interoperability features allow us to gain access to a very large set of the system’s API. Best of all, since COM is used outside of the Windows ecosystem, improvements to Swift’s integration with Windows system APIs, such as the native COM bridging described above, would also help other platforms! New features such as C++ Interoperability, macros, and distributed actors are opening up a whole new set of opportunities for applications to be written in a more portable fashion.</p>

<p>This foray into Windows and our exploration of Swift’s approach to interoperability has given us a good foundation on how Swift’s interoperability tools allow us to build cross-platform applications that can access platform APIs.</p>


  <footer>
    
      <p>Written by</p>
      <div class="authors">
  
    
    
      <div class="author">
        <div class="byline">
          <img
            
              src="https://www.github.com/compnerd.png?size=64"
            
            alt="Saleem Abdulrasool"
            title=""
            />
          <span class="author">
            
              <a href="https://github.com/compnerd/" rel="nofollow" title="Saleem Abdulrasool (@compnerd) on GitHub">Saleem Abdulrasool</a>
            
          </span>
        </div>
        
          
          
            <div class="about">Saleem Abdulrasool is a member of the Swift Core Team and a Software Engineer at The Browser Company, and previously worked at Google Brain, Facebook, and Microsoft, and currently focuses on cross-platform and embedded Swift.</div>
          
        
      </div>
    
  
</div>
    

    
    <nav>
      
      <a href="/blog/whats-new-swift-debugging-5.9/" rel="prev" title="Previous: Debugging Improvements in Swift 5.9">Debugging Improvements in Swift 5.9</a>
      

      
      <a href="/blog/packages-page/" rel="next" title="Next: Introducing Packages on Swift.org">Introducing Packages on Swift.org</a>
      
    </nav>
    
  </footer>
</article>
</main>



<footer role="contentinfo">
  <div class="footer-content">
    
  <p>Except where otherwise noted, all content on this blog is licensed under a <a href="https://creativecommons.org/licenses/by/4.0/">Creative Commons Attribution 4.0 International license</a>.</p>

    <p class="copyright">Copyright © 2025 Apple Inc. All rights reserved.</p>
    <p class="trademark">Swift and the Swift logo are trademarks of Apple Inc.</p>
    <p class="privacy">
      <a href="//www.apple.com/privacy/privacy-policy/">Privacy Policy</a>
      <a href="//www.apple.com/legal/privacy/en-ww/cookies/">Cookies</a>
      <a href="/openapi">API</a>
    </p>
  </div>
  <div class="footer-other">
    <form
      class="color-scheme-toggle"
      role="radiogroup"
      tabindex="0"
      id="color-scheme-toggle"
    >
      <legend class="visuallyhidden">Color scheme preference</legend>
      <label for="scheme-light">
        <input id="scheme-light" type="radio" name="color-scheme-preference" value="light">
        <span class="color-scheme-toggle-label">Light</span>
      </label>
      <label for="scheme-dark">
        <input id="scheme-dark" type="radio" name="color-scheme-preference" value="dark">
        <span class="color-scheme-toggle-label">Dark</span>
      </label>
      <label for="scheme-auto" id="scheme-auto-wrapper">
        <input id="scheme-auto" type="radio" name="color-scheme-preference" value="auto">
        <span class="color-scheme-toggle-label">Auto</span>
      </label>
    </form>
    <aside>
      <a href="https://x.com/swiftlang" rel="me" title="Follow @SwiftLang on X"><i class="x"></i></a>
      <a href="https://bsky.app/profile/swift.org" rel="me" title="Follow @swift.org on Bluesky"><i class="bluesky"></i></a>
      <a href="https://mastodon.social/@swiftlang" rel="me" title="Follow @swiftLang on Mastodon"><i class="mastodon"></i></a>
      <a href="/atom.xml" title="Subscribe to Site Updates"><i class="feed"></i></a>
    </aside>
  </div>
</footer>


<script src="/swift-org-website/pr-preview/pr-1/assets/javascripts/application.js"></script>
<!-- metrics -->
<script>
    /* RSID: */
    var s_account="awdswiftorg"
</script>

<script src="https://developer.apple.com/assets/metrics/scripts/analytics.js"></script>
<script>
    s.pageName= AC && AC.Tracking && AC.Tracking.pageName();

    /************* DO NOT ALTER ANYTHING BELOW THIS LINE ! **************/
    var s_code=s.t();if(s_code)document.write(s_code)
</script>

<!-- /metrics -->
</body>
</html>
